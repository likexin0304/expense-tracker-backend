# æ›´æ”¹æ—¥å¿—

## 2025-10-28 - POST /api/expenseä¸­æ–‡å­—æ®µæ˜ å°„æ”¯æŒ

### ğŸ“± é—®é¢˜æŠ¥å‘Š

ç”¨æˆ·ä½¿ç”¨OCRç¡®è®¤åŠŸèƒ½ï¼ˆæ¨èæ–¹æ¡ˆï¼‰è°ƒç”¨`POST /api/expense`æ—¶é‡åˆ°é”™è¯¯ï¼š

```
STATUS: 500
ERROR: "æ”¯å‡ºåˆ†ç±»å¿…é¡»æ˜¯æœ‰æ•ˆå€¼: food, transport, entertainment, shopping, bills, healthcare, education, travel, other"
```

**è¯·æ±‚æ•°æ®**:
```json
{
  "category": "å…¶ä»–",
  "amount": 100,
  "paymentMethod": "å…¶ä»–",
  "description": "æ‰“è½¦",
  "date": "2025-10-28T03:06:42Z"
}
```

### ğŸ” é—®é¢˜åˆ†æ

#### 1. æ ¹æœ¬åŸå› 
`POST /api/expense` ç«¯ç‚¹ç¼ºå°‘ä¸­æ–‡å­—æ®µæ˜ å°„ï¼š
- OCRæ§åˆ¶å™¨ä¸­æœ‰ä¸­æ–‡æ˜ å°„ï¼ˆåœ¨`/api/ocr/confirm`ä¸­ï¼‰
- Expenseæ§åˆ¶å™¨ä¸­**æ²¡æœ‰**ä¸­æ–‡æ˜ å°„ï¼ˆåœ¨`/api/expense`ä¸­ï¼‰
- ç”¨æˆ·ä½¿ç”¨æ¨èæ–¹æ¡ˆæ—¶ï¼Œç›´æ¥è°ƒç”¨`/api/expense`ï¼Œé‡åˆ°ä¸­æ–‡å­—æ®µéªŒè¯å¤±è´¥

#### 2. ä¸ºä»€ä¹ˆæ¨èæ–¹æ¡ˆéœ€è¦æ˜ å°„
- ç”¨æˆ·é‡‡ç”¨äº†æ¨èæ–¹æ¡ˆï¼š`OCRè§£æ â†’ ç¡®è®¤å¼¹çª— â†’ ç›´æ¥è°ƒç”¨ /api/expense`
- ç»•è¿‡äº†æœ‰æ˜ å°„çš„`/api/ocr/confirm`ç«¯ç‚¹
- ç›´æ¥è°ƒç”¨äº†æ²¡æœ‰æ˜ å°„çš„`/api/expense`ç«¯ç‚¹
- å¯¼è‡´ä¸­æ–‡å­—æ®µæ— æ³•è¯†åˆ«

### ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

#### åœ¨expenseController.jsä¸­æ·»åŠ ä¸­æ–‡æ˜ å°„

**ä¿®æ”¹ä½ç½®**: `src/controllers/expenseController.js`

**æ·»åŠ çš„æ˜ å°„**:
```javascript
// åˆ†ç±»æ˜ å°„ï¼šä¸­æ–‡ â†’ è‹±æ–‡
const CATEGORY_MAPPING = {
    'é¤é¥®': 'food',
    'äº¤é€š': 'transport',
    'å¨±ä¹': 'entertainment',
    'è´­ç‰©': 'shopping',
    'æœè£…': 'shopping',
    'è¡£æœ': 'shopping',
    'è´¦å•': 'bills',
    'åŒ»ç–—': 'healthcare',
    'æ•™è‚²': 'education',
    'æ—…è¡Œ': 'travel',
    'å…¶ä»–': 'other',
    // æ”¯æŒè‹±æ–‡ç›´æ¥é€šè¿‡
    'food': 'food',
    'transport': 'transport',
    'entertainment': 'entertainment',
    'shopping': 'shopping',
    'bills': 'bills',
    'healthcare': 'healthcare',
    'education': 'education',
    'travel': 'travel',
    'other': 'other'
};

// æ”¯ä»˜æ–¹å¼æ˜ å°„ï¼šä¸­æ–‡ â†’ è‹±æ–‡
const PAYMENT_METHOD_MAPPING = {
    'ç°é‡‘': 'cash',
    'é“¶è¡Œå¡': 'card',
    'ä¿¡ç”¨å¡': 'card',
    'å€Ÿè®°å¡': 'card',
    'æ”¯ä»˜å®': 'online',
    'å¾®ä¿¡æ”¯ä»˜': 'online',
    'å¾®ä¿¡': 'online',
    'ç½‘ä¸Šæ”¯ä»˜': 'online',
    'åœ¨çº¿æ”¯ä»˜': 'online',
    'å…¶ä»–': 'other',
    // æ”¯æŒè‹±æ–‡ç›´æ¥é€šè¿‡
    'cash': 'cash',
    'card': 'card',
    'online': 'online',
    'other': 'other'
};
```

**åº”ç”¨æ˜ å°„**ï¼ˆåœ¨`createExpense`æ–¹æ³•ä¸­ï¼‰:
```javascript
// è½¬æ¢ä¸­æ–‡åˆ†ç±»å’Œæ”¯ä»˜æ–¹å¼ä¸ºè‹±æ–‡
const mappedCategory = CATEGORY_MAPPING[category] || category || 'other';
const mappedPaymentMethod = PAYMENT_METHOD_MAPPING[paymentMethod] || paymentMethod || 'cash';

console.log('ğŸ”„ å­—æ®µæ˜ å°„è½¬æ¢:', {
    åŸå§‹category: category,
    æ˜ å°„åcategory: mappedCategory,
    åŸå§‹paymentMethod: paymentMethod,
    æ˜ å°„åpaymentMethod: mappedPaymentMethod
});

const expenseData = {
  userId: req.userId,
  amount: parseFloat(amount),
  category: mappedCategory,  // ä½¿ç”¨æ˜ å°„åçš„å€¼
  description: description.trim(),
  date: date ? new Date(date) : new Date(),
  location: location || null,
  paymentMethod: mappedPaymentMethod,  // ä½¿ç”¨æ˜ å°„åçš„å€¼
  tags: tags || []
};
```

### âœ… æœ¬åœ°æµ‹è¯•ç»“æœ

**æµ‹è¯•æ—¶é—´**: 2025-10-28 10:57

**æµ‹è¯•ç”¨ä¾‹**:
```bash
curl -X POST http://localhost:3000/api/expense \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{"amount":100,"category":"å…¶ä»–","description":"æµ‹è¯•æ”¯å‡º","date":"2025-10-28T02:53:02Z","paymentMethod":"å…¶ä»–"}'
```

**æµ‹è¯•ç»“æœ**: âœ… **å®Œå…¨æˆåŠŸ**

```json
{
  "success": true,
  "message": "æ”¯å‡ºè®°å½•åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": "dc0c3da3-6b29-49e2-aed8-a1bbe619719a",
    "amount": 100,
    "category": "other",       // âœ… ä¸­æ–‡"å…¶ä»–" â†’ è‹±æ–‡"other"
    "paymentMethod": "other",  // âœ… ä¸­æ–‡"å…¶ä»–" â†’ è‹±æ–‡"other"
    "description": "æµ‹è¯•æ”¯å‡º"
  }
}
```

**æ§åˆ¶å°æ—¥å¿—**:
```
ğŸ”„ å­—æ®µæ˜ å°„è½¬æ¢: {
  'åŸå§‹category': 'å…¶ä»–',
  'æ˜ å°„åcategory': 'other',
  'åŸå§‹paymentMethod': 'å…¶ä»–',
  'æ˜ å°„åpaymentMethod': 'other'
}
âœ… æ”¯å‡ºè®°å½•åˆ›å»ºæˆåŠŸ: dc0c3da3-6b29-49e2-aed8-a1bbe619719a
```

### âš ï¸ Vercelç”Ÿäº§ç¯å¢ƒçŠ¶æ€

**å½“å‰çŠ¶æ€**: âŒ **ä»è¿”å›æ—§é”™è¯¯**

**é—®é¢˜**: Verceléƒ¨ç½²å»¶è¿Ÿï¼ˆå·²æ¨é€ä»£ç ï¼Œä½†ç”Ÿäº§ç¯å¢ƒæœªæ›´æ–°ï¼‰

**è¯æ®**:
```bash
# ç”Ÿäº§ç¯å¢ƒæµ‹è¯•ï¼ˆ2025-10-28 11:03ï¼‰
curl -X POST "https://expense-tracker-backend-1mnvyo1le-likexin0304s-projects.vercel.app/api/expense" \
  -d '{"category":"å…¶ä»–",...}'

# è¿”å›
{
  "error": "æ”¯å‡ºåˆ†ç±»å¿…é¡»æ˜¯æœ‰æ•ˆå€¼: food, transport..."  # â† æ—§ç‰ˆæœ¬é”™è¯¯
}

# Vercelå“åº”å¤´
x-vercel-cache: MISS  # â† è§¦å‘äº†æ–°éƒ¨ç½²
x-vercel-id: hnd1::iad1::22zpt-1761621009226-82be20ec4659  # â† æ–°çš„éƒ¨ç½²ID
```

**åˆ†æ**: Vercelè§¦å‘äº†æ–°éƒ¨ç½²ï¼Œä½†éƒ¨ç½²çš„ä»ç„¶æ˜¯æ—§ä»£ç ï¼ˆå¯èƒ½çš„ç¼“å­˜/æ„å»ºé—®é¢˜ï¼‰

### ğŸ’¡ ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆ1: å‰ç«¯ä¸´æ—¶æ˜ å°„ï¼ˆç«‹å³å¯ç”¨â­æ¨èï¼‰

**å®ç°**: å‰ç«¯åœ¨è°ƒç”¨APIå‰å…ˆè½¬æ¢ä¸­æ–‡ä¸ºè‹±æ–‡

**Swiftä»£ç **:
```swift
extension OCRConfirmationService {
    private func mapCategoryToEnglish(_ category: String) -> String {
        let mapping: [String: String] = [
            "å…¶ä»–": "other",
            "é¤é¥®": "food",
            "äº¤é€š": "transport",
            // ... å…¶ä»–æ˜ å°„
        ]
        return mapping[category] ?? "other"
    }
    
    private func mapPaymentMethodToEnglish(_ method: String) -> String {
        let mapping: [String: String] = [
            "å…¶ä»–": "other",
            "ç°é‡‘": "cash",
            "æ”¯ä»˜å®": "online",
            // ... å…¶ä»–æ˜ å°„
        ]
        return mapping[method] ?? "other"
    }
    
    func createExpenseWithMapping(...) async throws -> Expense {
        let englishCategory = mapCategoryToEnglish(category)
        let englishPaymentMethod = mapPaymentMethodToEnglish(paymentMethod)
        // ä½¿ç”¨è‹±æ–‡å€¼è°ƒç”¨API
    }
}
```

**ä¼˜åŠ¿**:
- âœ… ç«‹å³å¯ç”¨ï¼Œä¸éœ€è¦ç­‰å¾…Vercel
- âœ… å‘åå…¼å®¹ï¼ˆVercelæ›´æ–°åä»ç„¶æœ‰æ•ˆï¼‰
- âœ… åŒè¯­æ”¯æŒï¼ˆä¸­æ–‡+è‹±æ–‡ï¼‰

#### æ–¹æ¡ˆ2: ç­‰å¾…Verceléƒ¨ç½²ï¼ˆ2-4å°æ—¶ï¼‰

**è¯´æ˜**: ä»£ç å·²æ¨é€ï¼Œç­‰å¾…Vercelè‡ªåŠ¨æ›´æ–°

### ğŸ“Š æµ‹è¯•å¯¹æ¯”

| ç¯å¢ƒ | çŠ¶æ€ | è¾“å…¥ | è¾“å‡º | å¤‡æ³¨ |
|------|------|------|------|------|
| æœ¬åœ°å¼€å‘ | âœ… æˆåŠŸ | category:"å…¶ä»–" | category:"other" | æ˜ å°„æ­£å¸¸ |
| Vercelç”Ÿäº§ | âŒ å¤±è´¥ | category:"å…¶ä»–" | é”™è¯¯ | æœªéƒ¨ç½² |

### ğŸ“ æäº¤è®°å½•

- `41e5c7c` - âœ¨ æ·»åŠ POST /api/expenseçš„ä¸­æ–‡å­—æ®µæ˜ å°„æ”¯æŒ
  - æ·»åŠ CATEGORY_MAPPINGå’ŒPAYMENT_METHOD_MAPPING
  - åœ¨createExpenseä¸­åº”ç”¨æ˜ å°„
  - æ·»åŠ æ˜ å°„è½¬æ¢è°ƒè¯•æ—¥å¿—

### ğŸ¯ æœ€ç»ˆçŠ¶æ€

- âœ… **ä»£ç ä¿®å¤å®Œæˆ** - æœ¬åœ°æµ‹è¯•100%æˆåŠŸ
- âœ… **æ¨èæ–¹æ¡ˆå®Œå–„** - æ”¯æŒä¸­æ–‡å­—æ®µ
- âœ… **æ–‡æ¡£æ›´æ–°** - `API.md`åŒ…å«å‰ç«¯ä¸´æ—¶æ˜ å°„æ–¹æ¡ˆ
- â³ **ç­‰å¾…Vercel** - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ä¸­

### ğŸ“‹ åç»­è¡ŒåŠ¨

#### å¯¹ç”¨æˆ·
1. **ç«‹å³å¯ç”¨æ–¹æ¡ˆ** - ä½¿ç”¨å‰ç«¯ä¸´æ—¶æ˜ å°„ï¼ˆè§`API.md`ï¼‰
2. **ç­‰å¾…ç”Ÿäº§éƒ¨ç½²** - 2-4å°æ—¶åæµ‹è¯•ç”Ÿäº§ç¯å¢ƒ
3. **å¯é€‰ä¿ç•™æ˜ å°„** - å³ä½¿åç«¯æ”¯æŒï¼Œå‰ç«¯ä¿ç•™æ˜ å°„æ›´å®‰å…¨

#### å¯¹å¼€å‘
1. **ç›‘æ§Verceléƒ¨ç½²** - ç­‰å¾…ç¼“å­˜æ¸…é™¤
2. **éªŒè¯ç”Ÿäº§ç¯å¢ƒ** - éƒ¨ç½²å®Œæˆåæµ‹è¯•ä¸­æ–‡å­—æ®µ
3. **æ›´æ–°æ–‡æ¡£** - æ ‡è®°ä¸´æ—¶æ–¹æ¡ˆçŠ¶æ€

---

## 2025-06-28 ä¿®å¤DNSè§£æå¤±è´¥é—®é¢˜ï¼ˆENOTFOUNDï¼‰

### ğŸ› é—®é¢˜æè¿°
- **é”™è¯¯ç±»å‹**: `TypeError: fetch failed`
- **å…·ä½“é”™è¯¯**: `getaddrinfo ENOTFOUND nlrtjnvwgsaavtpfccxg.supabase.co`
- **é”™è¯¯ä½ç½®**: `/var/task/src/controllers/authController.js:103:60`
- **å½±å“**: ç”¨æˆ·æ— æ³•ç™»å½•ï¼Œæ‰€æœ‰Supabaseç›¸å…³åŠŸèƒ½ä¸å¯ç”¨

### ğŸ” é—®é¢˜åˆ†æ
**é—®é¢˜æ€§è´¨**: åç«¯é—®é¢˜
**æ ¹æœ¬åŸå› **: Supabaseé¡¹ç›®å¤„äº `INACTIVE` çŠ¶æ€
- é¡¹ç›®ID: `nlrtjnvwgsaavtpfccxg`
- é¡¹ç›®åç§°: `likexin0304's Project`
- çŠ¶æ€: ä» `INACTIVE` æ¢å¤åˆ° `COMING_UP`
- åŒºåŸŸ: `us-east-2`

### ğŸ”§ ä¿®å¤æªæ–½
1. **é¡¹ç›®çŠ¶æ€æ£€æŸ¥**:
   ```bash
   # é€šè¿‡Supabase CLIæ£€æŸ¥é¡¹ç›®çŠ¶æ€
   supabase projects list  # å‘ç°é¡¹ç›®çŠ¶æ€ä¸ºINACTIVE
   ```

2. **é¡¹ç›®æ¢å¤**:
   ```bash
   # æ¢å¤æš‚åœçš„é¡¹ç›®
   supabase projects restore nlrtjnvwgsaavtpfccxg
   ```

3. **æ¢å¤çŠ¶æ€ç›‘æ§**:
   - åˆå§‹çŠ¶æ€: `INACTIVE`
   - æ¢å¤åçŠ¶æ€: `COMING_UP`
   - æœ€ç»ˆçŠ¶æ€: `ACTIVE_HEALTHY`

4. **å®Œæ•´ä¿®å¤æ—¶é—´çº¿**:
   - 08:45 - å‘ç°DNSè§£æå¤±è´¥é—®é¢˜
   - 08:46 - è¯Šæ–­ç¡®è®¤ä¸ºSupabaseé¡¹ç›®INACTIVEçŠ¶æ€
   - 08:47 - æ‰§è¡Œé¡¹ç›®æ¢å¤å‘½ä»¤
   - 08:48 - é¡¹ç›®çŠ¶æ€å˜æ›´ä¸ºCOMING_UP
   - 08:52 - é¡¹ç›®å®Œå…¨æ¢å¤åˆ°ACTIVE_HEALTHYçŠ¶æ€
   - 08:53 - APIåŠŸèƒ½æµ‹è¯•éªŒè¯å®Œæˆ

### ğŸ“Š æŠ€æœ¯åˆ†æ
- **DNSè§£æå¤±è´¥åŸå› **: é¡¹ç›®æš‚åœæ—¶ï¼ŒSupabaseä¼šåœæ­¢DNSè§£ææœåŠ¡
- **é¡¹ç›®æš‚åœæœºåˆ¶**: é•¿æ—¶é—´ä¸æ´»è·ƒçš„é¡¹ç›®ä¼šè‡ªåŠ¨æš‚åœä»¥èŠ‚çœèµ„æº
- **æ¢å¤è¿‡ç¨‹**: é¡¹ç›®æ¢å¤é€šå¸¸éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´å®Œæˆ

### âœ… ä¿®å¤éªŒè¯
- âœ… é¡¹ç›®æ¢å¤å‘½ä»¤æ‰§è¡ŒæˆåŠŸ
- âœ… é¡¹ç›®çŠ¶æ€ä» `INACTIVE` å˜ä¸º `COMING_UP`
- âœ… é¡¹ç›®å·²å®Œå…¨æ¢å¤åˆ° `ACTIVE_HEALTHY` çŠ¶æ€
- âœ… DNSè§£æé—®é¢˜å·²è§£å†³ï¼Œå¯ä»¥æ­£å¸¸è®¿é—®SupabaseæœåŠ¡
- âœ… APIåŠŸèƒ½æµ‹è¯•æˆåŠŸï¼š
  - å¥åº·æ£€æŸ¥ç«¯ç‚¹æ­£å¸¸ï¼š`/health` è¿”å›200çŠ¶æ€
  - ç™»å½•ç«¯ç‚¹æ­£å¸¸ï¼š`/api/auth/login` è¿”å›æˆåŠŸå“åº”å’ŒJWT token
  - Supabaseæ•°æ®åº“è¿æ¥æ­£å¸¸

### ğŸ›¡ï¸ é¢„é˜²æªæ–½
1. **å®šæœŸæ´»åŠ¨**: å®šæœŸä½¿ç”¨é¡¹ç›®ä»¥é¿å…è‡ªåŠ¨æš‚åœ
2. **ç›‘æ§è„šæœ¬**: å¯ä»¥è®¾ç½®å®šæœŸæ£€æŸ¥é¡¹ç›®çŠ¶æ€çš„è„šæœ¬
3. **å‘Šè­¦æœºåˆ¶**: é¡¹ç›®çŠ¶æ€å˜åŒ–æ—¶åŠæ—¶é€šçŸ¥

### ğŸ“ æ‰§è¡Œçš„å…·ä½“å‘½ä»¤
**è¯Šæ–­å‘½ä»¤**:
```bash
# æ£€æŸ¥é¡¹ç›®çŠ¶æ€
mcp_supabase_list_projects
mcp_supabase_get_project nlrtjnvwgsaavtpfccxg
```

**ä¿®å¤å‘½ä»¤**:
```bash
# æ¢å¤é¡¹ç›®
mcp_supabase_restore_project nlrtjnvwgsaavtpfccxg
```

**éªŒè¯å‘½ä»¤**:
```bash
# å¥åº·æ£€æŸ¥
curl -X GET "https://expense-tracker-backend-likexin0304s-projects.vercel.app/health" -H "Content-Type: application/json"

# ç™»å½•æµ‹è¯•
curl -X POST "https://expense-tracker-backend-likexin0304s-projects.vercel.app/api/auth/login" -H "Content-Type: application/json" -d '{"email":"test@example.com","password":"123456"}'
```

### ğŸ”„ ç³»ç»Ÿå˜æ›´è®°å½•
**é…ç½®æ–‡ä»¶**: æ— å˜æ›´ï¼ˆé—®é¢˜ä¸ºæœåŠ¡çŠ¶æ€ï¼Œéä»£ç é—®é¢˜ï¼‰
**æ•°æ®åº“**: æ— å˜æ›´ï¼ˆé¡¹ç›®æ¢å¤åæ•°æ®å®Œæ•´ä¿ç•™ï¼‰
**ç¯å¢ƒå˜é‡**: æ— å˜æ›´ï¼ˆSupabaseé…ç½®ä¿æŒä¸å˜ï¼‰
**ä»£ç åº“**: æ— å˜æ›´ï¼ˆé—®é¢˜ä¸ºåŸºç¡€è®¾æ–½å±‚é¢ï¼‰
**éƒ¨ç½²**: æ— éœ€é‡æ–°éƒ¨ç½²ï¼ˆåç«¯ä»£ç æœªæ”¹å˜ï¼‰

### ğŸ“Š æ€§èƒ½å½±å“åˆ†æ
- **åœæœºæ—¶é—´**: çº¦7åˆ†é’Ÿï¼ˆä»INACTIVEåˆ°ACTIVE_HEALTHYï¼‰
- **æ•°æ®ä¸¢å¤±**: 0ï¼ˆé¡¹ç›®æš‚åœæœŸé—´æ•°æ®å®Œæ•´ä¿ç•™ï¼‰
- **åŠŸèƒ½å½±å“**: æ¢å¤åæ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼Œæ— é—ç•™é—®é¢˜
- **ç”¨æˆ·ä½“éªŒ**: é—®é¢˜è§£å†³åç”¨æˆ·å¯æ­£å¸¸ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½

### ğŸ“ ç»´æŠ¤å»ºè®®
```bash
# æ£€æŸ¥é¡¹ç›®çŠ¶æ€
supabase projects list

# æ¢å¤é¡¹ç›®ï¼ˆå¦‚æœéœ€è¦ï¼‰
supabase projects restore PROJECT_ID

# ç›‘æ§é¡¹ç›®å¥åº·çŠ¶æ€
curl -f https://nlrtjnvwgsaavtpfccxg.supabase.co/rest/v1/ || echo "é¡¹ç›®å¯èƒ½å·²æš‚åœ"
```

### ğŸ“‹ é—®é¢˜è§£å†³æ€»ç»“
- **é—®é¢˜ç±»å‹**: åŸºç¡€è®¾æ–½å±‚é¢çš„æœåŠ¡æš‚åœé—®é¢˜
- **è§£å†³æ–¹æ³•**: æœåŠ¡æ¢å¤ï¼Œæ— éœ€ä»£ç ä¿®æ”¹
- **è§£å†³æ—¶é—´**: çº¦7åˆ†é’Ÿå®Œæˆå®Œæ•´æ¢å¤
- **æœ€ç»ˆçŠ¶æ€**: âœ… å®Œå…¨è§£å†³ï¼Œæ‰€æœ‰åŠŸèƒ½æ­£å¸¸
- **æ—¥å¿—è®°å½•**: âœ… å®Œæ•´è®°å½•æ‰€æœ‰å˜æ›´å’Œæ‰§è¡Œè¿‡ç¨‹
- **éªŒè¯ç»“æœ**: âœ… APIåŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼Œç”¨æˆ·å¯æ­£å¸¸ä½¿ç”¨

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-07-18T08:53:21.571Z

---

## 2025-10-15 - OCRè‡ªåŠ¨è®°è´¦åŠŸèƒ½å®Œå–„å’ŒAPIæ–‡æ¡£æ›´æ–°

### ğŸ“‹ éœ€æ±‚èƒŒæ™¯
å‰ç«¯å¼€å‘è€…åé¦ˆéœ€è¦æ”¯æŒ"æ‰‹æœºç‚¹å‡»èƒŒå3æ¬¡ï¼Œè‡ªåŠ¨æˆªå›¾å¹¶è¯†åˆ«å›¾ç‰‡ä¸­çš„è´¦å•ä¿¡æ¯ï¼Œç„¶åè®°å½•æˆä¸€é¡¹æ”¯å‡ºè®°å½•"åŠŸèƒ½ï¼Œä½†å‘ç°åç«¯APIç¼ºå¤±ç›¸å…³å†…å®¹ã€‚

### ğŸ” é—®é¢˜æ’æŸ¥ç»“æœ

#### âœ… åç«¯APIçŠ¶æ€æ£€æŸ¥
ç»è¿‡è¯¦ç»†æ£€æŸ¥ï¼Œå‘ç°**åç«¯APIå®é™…ä¸Šæ˜¯å®Œæ•´çš„**ï¼š

1. **è·¯ç”±é…ç½®å®Œæ•´** âœ…
   - `POST /api/ocr/parse` - åŸºç¡€OCRè§£æ
   - `POST /api/ocr/parse-auto` - æ™ºèƒ½è§£æå¹¶è‡ªåŠ¨åˆ›å»º
   - `POST /api/ocr/confirm/:recordId` - ç¡®è®¤å¹¶åˆ›å»ºæ”¯å‡ºè®°å½•
   - æ‰€æœ‰10ä¸ªOCRç›¸å…³ç«¯ç‚¹éƒ½å·²æ­£ç¡®é…ç½®

2. **æ§åˆ¶å™¨å®ç°å®Œæ•´** âœ…
   - `OCRController.parseText()` - åŸºç¡€è§£æåŠŸèƒ½
   - `OCRController.parseTextAndAutoCreate()` - è‡ªåŠ¨åˆ›å»ºåŠŸèƒ½
   - `OCRController.confirmAndCreateExpense()` - ç¡®è®¤åˆ›å»ºåŠŸèƒ½
   - æ‰€æœ‰æ–¹æ³•éƒ½æœ‰å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

3. **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ­£å¸¸** âœ…
   - æ‰€æœ‰OCR APIç«¯ç‚¹åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ½å¯ç”¨
   - APIè¿”å›æ ¼å¼æ­£ç¡®ï¼ŒåŠŸèƒ½æ­£å¸¸

### ğŸš€ éƒ¨ç½²çŠ¶æ€æ›´æ–°

#### ä»£ç åŒæ­¥åˆ°GitHub
- **æäº¤å“ˆå¸Œ**: `9f9106e`
- **æäº¤æ—¶é—´**: 2025-10-15 17:43
- **æ¨é€çŠ¶æ€**: âœ… æˆåŠŸæ¨é€åˆ° `origin/main`
- **æ–‡ä»¶å˜æ›´**: 
  - `docs/API.md`: +445è¡Œæ–°å¢å†…å®¹
  - `log.md`: æ›´æ–°é¡¹ç›®æ—¥å¿—

#### Vercelç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- **éƒ¨ç½²çŠ¶æ€**: âœ… è‡ªåŠ¨éƒ¨ç½²æˆåŠŸ
- **ç”Ÿäº§URL**: https://expense-tracker-backend-likexin0304s-projects.vercel.app
- **å¥åº·æ£€æŸ¥**: âœ… æ­£å¸¸ (çŠ¶æ€ç : 200)
- **APIç«¯ç‚¹éªŒè¯**: 
  - OCRç›¸å…³ç«¯ç‚¹: âœ… 10ä¸ªç«¯ç‚¹å…¨éƒ¨å¯ç”¨
  - ç¡®è®¤åˆ›å»ºAPI: âœ… `POST /api/ocr/confirm/:recordId` æ­£å¸¸
  - è®¤è¯ä¿æŠ¤: âœ… æœªè®¤è¯è¯·æ±‚æ­£ç¡®è¿”å›401

#### å‰ç«¯å¼€å‘è€…å¯ç”¨èµ„æº
- **APIæ–‡æ¡£**: `docs/API.md` å·²æ›´æ–°å®Œæ•´çš„OCRè‡ªåŠ¨è®°è´¦æµç¨‹
- **Swiftä»£ç ç¤ºä¾‹**: åŒ…å«å®Œæ•´çš„ `AutoExpenseService` å®ç°
- **ç”Ÿäº§ç¯å¢ƒ**: æ‰€æœ‰APIç«¯ç‚¹å·²éƒ¨ç½²å¹¶å¯æ­£å¸¸ä½¿ç”¨

---

## 2025-10-17 - OCRè‡ªåŠ¨è®°è´¦åŠŸèƒ½Bugä¿®å¤

### ğŸ› é—®é¢˜æŠ¥å‘Š
ç”¨æˆ·åé¦ˆåœ¨ä½¿ç”¨"æ‰‹æœºç‚¹å‡»èƒŒå3æ¬¡è‡ªåŠ¨è®°è´¦"åŠŸèƒ½æ—¶ï¼Œåç«¯APIè¿”å›500é”™è¯¯ï¼š
```
âŒ åç«¯å­˜åœ¨é—®é¢˜
é”™è¯¯ç±»å‹ï¼šJavaScriptè¿è¡Œæ—¶é”™è¯¯
å…·ä½“é”™è¯¯ï¼šCannot read properties of undefined (reading 'id')
HTTPçŠ¶æ€ï¼š500æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
```

### ğŸ” é—®é¢˜æ’æŸ¥è¿‡ç¨‹

#### 1. åˆæ­¥é”™è¯¯åˆ†æ
- **é”™è¯¯ä½ç½®**: `/api/ocr/parse-auto` ç«¯ç‚¹
- **é”™è¯¯ä¿¡æ¯**: `Cannot read properties of undefined (reading 'id')`
- **HTTPçŠ¶æ€**: 500æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 2. ä»£ç å®¡æŸ¥å‘ç°çš„é—®é¢˜

**é—®é¢˜1: Expense.createæ–¹æ³•è°ƒç”¨é”™è¯¯**
```javascript
// âŒ é”™è¯¯çš„è°ƒç”¨æ–¹å¼
const expense = await Expense.create(userId, expenseData);

// âœ… æ­£ç¡®çš„è°ƒç”¨æ–¹å¼  
const expense = await Expense.create(expenseData);
```

**é—®é¢˜2: ç¼ºå°‘userIdå­—æ®µ**
```javascript
// âŒ ç¼ºå°‘userId
const expenseData = {
    amount: parseResult.data.amount || 0,
    category: parseResult.data.category || 'other',
    // ...
};

// âœ… æ·»åŠ userId
const expenseData = {
    userId: userId,
    amount: parseResult.data.amount || 0,
    // ...
};
```

**é—®é¢˜3: åˆ†ç±»å’Œæ”¯ä»˜æ–¹å¼æ˜ å°„ç¼ºå¤±**
OCRè§£æå™¨è¿”å›ä¸­æ–‡åˆ†ç±»å’Œæ”¯ä»˜æ–¹å¼ï¼Œä½†Expenseæ¨¡å‹æœŸæœ›è‹±æ–‡å€¼ï¼š
```javascript
// OCRè¿”å›: "é¤é¥®", "æ”¯ä»˜å®"
// ExpenseæœŸæœ›: "food", "online"
```

#### 3. ä¿®å¤æ–¹æ¡ˆå®æ–½

**ä¿®å¤1: æ·»åŠ åˆ†ç±»æ˜ å°„**
```javascript
const CATEGORY_MAPPING = {
    'é¤é¥®': 'food',
    'äº¤é€š': 'transport',
    'å¨±ä¹': 'entertainment',
    'è´­ç‰©': 'shopping',
    'è´¦å•': 'bills',
    'åŒ»ç–—': 'healthcare',
    'æ•™è‚²': 'education',
    'æ—…è¡Œ': 'travel',
    'å…¶ä»–': 'other'
};
```

**ä¿®å¤2: æ·»åŠ æ”¯ä»˜æ–¹å¼æ˜ å°„**
```javascript
const PAYMENT_METHOD_MAPPING = {
    'ç°é‡‘': 'cash',
    'é“¶è¡Œå¡': 'card',
    'ä¿¡ç”¨å¡': 'card',
    'å€Ÿè®°å¡': 'card',
    'æ”¯ä»˜å®': 'online',
    'å¾®ä¿¡æ”¯ä»˜': 'online',
    'å¾®ä¿¡': 'online',
    'ç½‘ä¸Šæ”¯ä»˜': 'online',
    'åœ¨çº¿æ”¯ä»˜': 'online',
    'å…¶ä»–': 'other'
};
```

**ä¿®å¤3: æ›´æ–°expenseDataæ„å»º**
```javascript
const expenseData = {
    userId: userId,
    amount: parseResult.data.amount || 0,
    category: CATEGORY_MAPPING[parseResult.data.category] || 'other',
    description: parseResult.data.merchant || parseResult.data.description || 'è‡ªåŠ¨è¯†åˆ«è®°å½•',
    date: parseResult.data.date || new Date().toISOString(),
    location: parseResult.data.location || '',
    paymentMethod: PAYMENT_METHOD_MAPPING[parseResult.data.paymentMethod] || 'cash',
    tags: ['è‡ªåŠ¨åˆ›å»º', 'OCRè¯†åˆ«']
};
```

**ä¿®å¤4: ä¿®æ­£Expenseæ¨¡å—å¯¼å…¥**
```javascript
// âŒ é”™è¯¯å¯¼å…¥
const Expense = require('../models/Expense');

// âœ… æ­£ç¡®å¯¼å…¥
const { Expense } = require('../models/Expense');
```

### âœ… ä¿®å¤éªŒè¯

#### æµ‹è¯•ç”¨ä¾‹1: éº¦å½“åŠ³æ”¯ä»˜å®
```bash
curl -X POST /api/ocr/parse-auto \
  -H "Authorization: Bearer <token>" \
  -d '{"text":"éº¦å½“åŠ³ 2024-01-15 æ¶ˆè´¹é‡‘é¢ï¼šÂ¥25.80 æ”¯ä»˜æ–¹å¼ï¼šæ”¯ä»˜å®","autoCreateThreshold":0.8}'
```

**ç»“æœ**: âœ… è‡ªåŠ¨åˆ›å»ºæˆåŠŸ
```json
{
  "success": true,
  "message": "è‡ªåŠ¨è¯†åˆ«å¹¶åˆ›å»ºæ”¯å‡ºè®°å½•æˆåŠŸ",
  "data": {
    "autoCreated": true,
    "expense": {
      "id": "uuid",
      "amount": 25.8,
      "category": "food",
      "description": "éº¦å½“åŠ³",
      "paymentMethod": "online"
    }
  }
}
```

#### æµ‹è¯•ç”¨ä¾‹2: æ˜Ÿå·´å…‹å¾®ä¿¡æ”¯ä»˜
```bash
curl -X POST /api/ocr/parse-auto \
  -H "Authorization: Bearer <token>" \
  -d '{"text":"æ˜Ÿå·´å…‹ 2024-01-16 æ¶ˆè´¹é‡‘é¢ï¼šÂ¥38.50 æ”¯ä»˜æ–¹å¼ï¼šå¾®ä¿¡æ”¯ä»˜","autoCreateThreshold":0.8}'
```

**ç»“æœ**: âœ… è‡ªåŠ¨åˆ›å»ºæˆåŠŸ
```json
{
  "success": true,
  "message": "è‡ªåŠ¨è¯†åˆ«å¹¶åˆ›å»ºæ”¯å‡ºè®°å½•æˆåŠŸ",
  "data": {
    "autoCreated": true,
    "expense": {
      "id": "uuid",
      "amount": 38.5,
      "category": "food",
      "description": "æ˜Ÿå·´å…‹",
      "paymentMethod": "online"
    }
  }
}
```

### ğŸ“Š ä¿®å¤æ€»ç»“

| é—®é¢˜ç±»å‹ | ä¿®å¤çŠ¶æ€ | å½±å“ |
|---------|---------|------|
| Expense.createè°ƒç”¨é”™è¯¯ | âœ… å·²ä¿®å¤ | è§£å†³500é”™è¯¯ |
| ç¼ºå°‘userIdå­—æ®µ | âœ… å·²ä¿®å¤ | è§£å†³ç”¨æˆ·IDéªŒè¯å¤±è´¥ |
| åˆ†ç±»æ˜ å°„ç¼ºå¤± | âœ… å·²ä¿®å¤ | è§£å†³åˆ†ç±»éªŒè¯å¤±è´¥ |
| æ”¯ä»˜æ–¹å¼æ˜ å°„ç¼ºå¤± | âœ… å·²ä¿®å¤ | è§£å†³æ”¯ä»˜æ–¹å¼éªŒè¯å¤±è´¥ |
| æ¨¡å—å¯¼å…¥é”™è¯¯ | âœ… å·²ä¿®å¤ | è§£å†³æ¨¡å—å¼•ç”¨é—®é¢˜ |

### ğŸ¯ åŠŸèƒ½çŠ¶æ€
- âœ… **OCRæ–‡æœ¬è§£æ**: æ­£å¸¸å·¥ä½œ
- âœ… **æ™ºèƒ½å•†æˆ·åŒ¹é…**: æ­£å¸¸å·¥ä½œ  
- âœ… **ç½®ä¿¡åº¦è¯„ä¼°**: æ­£å¸¸å·¥ä½œ
- âœ… **è‡ªåŠ¨æ”¯å‡ºåˆ›å»º**: æ­£å¸¸å·¥ä½œ
- âœ… **åˆ†ç±»æ˜ å°„**: ä¸­æ–‡â†’è‹±æ–‡æ˜ å°„å®Œæ•´
- âœ… **æ”¯ä»˜æ–¹å¼æ˜ å°„**: ä¸­æ–‡â†’è‹±æ–‡æ˜ å°„å®Œæ•´

**ğŸš€ ç°åœ¨å‰ç«¯å¯ä»¥æ­£å¸¸ä½¿ç”¨"æ‰‹æœºç‚¹å‡»èƒŒå3æ¬¡è‡ªåŠ¨è®°è´¦"åŠŸèƒ½äº†ï¼**

### ğŸ”„ Verceléƒ¨ç½²å»¶è¿Ÿé—®é¢˜

#### â³ å½“å‰çŠ¶å†µ (2025-10-17 15:10)
- **é—®é¢˜**: é…ç½®ç«¯ç‚¹ `/api/config` åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¾ç¤º"è·¯ç”±ä¸å­˜åœ¨"
- **æ ¹æœ¬åŸå› **: Vercelæ„å»ºå¤±è´¥ - aliaså†²çª
- **å…·ä½“é”™è¯¯**: `The chosen alias "expense-tracker-api.vercel.app" is already in use`
- **å·²è§£å†³**: 
  - âœ… ç§»é™¤å†²çªçš„aliasé…ç½®
  - âœ… ç‰ˆæœ¬å·æ›´æ–° (1.0.12 â†’ 1.0.13)
  - âœ… æ·»åŠ FORCE_REBUILDç¯å¢ƒå˜é‡
- **çŠ¶æ€**: ç­‰å¾…Vercelé‡æ–°éƒ¨ç½²ï¼ˆaliaså†²çªå·²è§£å†³ï¼‰

#### ğŸš€ ç«‹å³è§£å†³æ–¹æ¡ˆ
ç”±äºéƒ¨ç½²å»¶è¿Ÿï¼Œæä¾›äº†**ä¸ä¾èµ–é…ç½®ç«¯ç‚¹çš„ç«‹å³ä¿®å¤æ–¹æ¡ˆ**ï¼š

1. **ç›´æ¥URLæ›¿æ¢**:
   ```swift
   // âŒ é”™è¯¯URL
   static let baseURL = "https://expense-tracker-backend-mocrhvaay-likexin0304s-projects.vercel.app"
   
   // âœ… æ­£ç¡®URL  
   static let baseURL = "https://expense-tracker-backend-1mnvyo1le-likexin0304s-projects.vercel.app"
   ```

2. **æ™ºèƒ½URLæ£€æµ‹**:
   - è‡ªåŠ¨æµ‹è¯•å¤šä¸ªå¯èƒ½çš„URL
   - æ‰¾åˆ°æœ‰æ•ˆçš„APIç«¯ç‚¹
   - æä¾›å®Œæ•´çš„fallbackæœºåˆ¶

3. **å®Œæ•´æ–‡æ¡£**: è¯¦è§ `docs/immediate-fix.md`

#### ğŸ’¡ ç»éªŒæ€»ç»“
- **Verceléƒ¨ç½²**: å¯èƒ½å­˜åœ¨æ˜¾è‘—å»¶è¿Ÿï¼Œç‰¹åˆ«æ˜¯è·¯ç”±å˜æ›´
- **åº”æ€¥æ–¹æ¡ˆ**: å§‹ç»ˆå‡†å¤‡ä¸ä¾èµ–æ–°åŠŸèƒ½çš„å¤‡ç”¨æ–¹æ¡ˆ
- **æ¸è¿›å‡çº§**: å…ˆè§£å†³ç´§æ€¥é—®é¢˜ï¼Œå†ç­‰å¾…ç†æƒ³æ–¹æ¡ˆéƒ¨ç½²

### ğŸš€ éƒ¨ç½²çŠ¶æ€

#### âœ… æœ¬åœ°ç¯å¢ƒ
- **çŠ¶æ€**: å®Œå…¨ä¿®å¤ï¼ŒåŠŸèƒ½æ­£å¸¸
- **æµ‹è¯•ç»“æœ**: OCRè‡ªåŠ¨è®°è´¦åŠŸèƒ½100%æ­£å¸¸å·¥ä½œ
- **ç‰ˆæœ¬**: v1.0.12

#### âœ… ç”Ÿäº§ç¯å¢ƒ 
- **çŠ¶æ€**: ä¿®å¤å®Œæˆï¼Œä½†å­˜åœ¨URLæ··æ·†é—®é¢˜
- **æ ¹æœ¬åŸå› **: ç”¨æˆ·ä½¿ç”¨äº†é”™è¯¯çš„éƒ¨ç½²URL
- **é—®é¢˜URL**: `https://expense-tracker-backend-mocrhvaay-likexin0304s-projects.vercel.app` âŒ
- **æ­£ç¡®URL**: `https://expense-tracker-backend-1mnvyo1le-likexin0304s-projects.vercel.app` âœ…
- **éªŒè¯ç»“æœ**: æ­£ç¡®URLçš„ä¿®å¤ç‰ˆæœ¬å·¥ä½œæ­£å¸¸

#### ğŸ“Š åŠŸèƒ½éªŒè¯
| ç¯å¢ƒ | OCRè§£æ | è‡ªåŠ¨åˆ›å»º | åˆ†ç±»æ˜ å°„ | æ”¯ä»˜æ–¹å¼æ˜ å°„ | çŠ¶æ€ |
|------|---------|----------|----------|-------------|------|
| æœ¬åœ° | âœ… | âœ… | âœ… | âœ… | å®Œå…¨æ­£å¸¸ |
| ç”Ÿäº§(æ­£ç¡®URL) | âœ… | âœ… | âœ… | âœ… | å®Œå…¨æ­£å¸¸ |
| ç”Ÿäº§(é”™è¯¯URL) | âŒ | âŒ | âŒ | âŒ | æ—§ç‰ˆæœ¬ |

### ğŸ”§ è§£å†³æ–¹æ¡ˆ

**é—®é¢˜æ ¹å› **: å‰ç«¯ä½¿ç”¨äº†é”™è¯¯çš„API URL

**ç«‹å³è§£å†³æ–¹æ¡ˆ**: 
1. **æ›´æ–°å‰ç«¯APIé…ç½®**ï¼Œå°†baseURLä»ï¼š
   ```
   âŒ https://expense-tracker-backend-mocrhvaay-likexin0304s-projects.vercel.app
   ```
   æ”¹ä¸ºï¼š
   ```
   âœ… https://expense-tracker-backend-1mnvyo1le-likexin0304s-projects.vercel.app
   ```

2. **éªŒè¯ä¿®å¤**: ä½¿ç”¨æ­£ç¡®URLæµ‹è¯•OCRè‡ªåŠ¨è®°è´¦åŠŸèƒ½

**æµ‹è¯•éªŒè¯**:
```bash
# âœ… æ­£ç¡®URL - åŠŸèƒ½æ­£å¸¸
curl -X POST "https://expense-tracker-backend-1mnvyo1le-likexin0304s-projects.vercel.app/api/ocr/parse-auto" \
  -H "Authorization: Bearer <token>" \
  -d '{"text":"è¯†åˆ« è®¾ç½®","autoCreateThreshold":0.8}'
# è¿”å›: {"success":true,"message":"è§£ææˆåŠŸï¼Œéœ€è¦ç”¨æˆ·ç¡®è®¤"...}

# âŒ é”™è¯¯URL - ä»æœ‰Bug
curl -X POST "https://expense-tracker-backend-mocrhvaay-likexin0304s-projects.vercel.app/api/ocr/parse-auto" \
  -H "Authorization: Bearer <token>" \
  -d '{"text":"è¯†åˆ« è®¾ç½®","autoCreateThreshold":0.8}'
# è¿”å›: {"success":false,"message":"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯","error":"Cannot read properties of undefined (reading 'id')"}
```

### ğŸ“š ä¸»è¦æ”¹è¿›ï¼šAPIæ–‡æ¡£å®Œå–„

#### 1. æ–°å¢"è‡ªåŠ¨è®°è´¦å®Œæ•´æµç¨‹"ç« èŠ‚
åœ¨ `docs/API.md` ä¸­æ·»åŠ äº†è¯¦ç»†çš„è‡ªåŠ¨è®°è´¦æµç¨‹è¯´æ˜ï¼š

**æ–¹æ¡ˆ1ï¼šæ™ºèƒ½è‡ªåŠ¨åˆ›å»ºï¼ˆæ¨èï¼‰**
```
ç”¨æˆ·æ“ä½œ â†’ æˆªå›¾ â†’ OCRè¯†åˆ« â†’ è‡ªåŠ¨è§£æ â†’ é«˜ç½®ä¿¡åº¦è‡ªåŠ¨åˆ›å»ºæ”¯å‡ºè®°å½•
```
- é€‚ç”¨äº"ç‚¹å‡»èƒŒå3æ¬¡"åŠŸèƒ½
- ä½¿ç”¨ `POST /api/ocr/parse-auto` API
- ç½®ä¿¡åº¦â‰¥0.85æ—¶è‡ªåŠ¨åˆ›å»ºï¼Œå¦åˆ™éœ€è¦ç”¨æˆ·ç¡®è®¤

**æ–¹æ¡ˆ2ï¼šä¸¤æ­¥ç¡®è®¤æµç¨‹**
```
ç”¨æˆ·æ“ä½œ â†’ æˆªå›¾ â†’ OCRè¯†åˆ« â†’ è§£æç»“æœ â†’ ç”¨æˆ·ç¡®è®¤ â†’ åˆ›å»ºæ”¯å‡ºè®°å½•
```
- é€‚ç”¨äºéœ€è¦ç”¨æˆ·ç¡®è®¤çš„åœºæ™¯
- ä½¿ç”¨ `POST /api/ocr/parse` + `POST /api/ocr/confirm/:recordId`

#### 2. å®Œå–„APIç«¯ç‚¹æ–‡æ¡£
æ›´æ–°äº† `POST /api/ocr/confirm/:recordId` çš„è¯¦ç»†è¯´æ˜ï¼š
- æ·»åŠ äº†å®Œæ•´çš„è¯·æ±‚å‚æ•°è¯´æ˜
- æ˜ç¡®äº†å¿…å¡«å­—æ®µï¼š`amount`ã€`category`ã€`description`
- æä¾›äº†å¯é€‰å­—æ®µçš„é»˜è®¤å€¼è¯´æ˜
- æ·»åŠ äº†è®¤è¯å¤´éƒ¨è¦æ±‚

#### 3. æ–°å¢iOS AutoExpenseServiceå®Œæ•´å®ç°
æä¾›äº†å®Œæ•´çš„Swiftä»£ç ç¤ºä¾‹ï¼š

```swift
class AutoExpenseService {
    /// è‡ªåŠ¨è®°è´¦ä¸»æµç¨‹ - æ¨èç”¨äº"ç‚¹å‡»èƒŒå3æ¬¡"åŠŸèƒ½
    func processReceiptText(_ text: String, threshold: Double = 0.85) async throws -> AutoExpenseResult
    
    /// ç¡®è®¤å¹¶åˆ›å»ºæ”¯å‡ºè®°å½•
    func confirmAndCreateExpense(recordId: String, corrections: ExpenseCorrections) async throws -> Expense
}
```

åŒ…å«ï¼š
- å®Œæ•´çš„æœåŠ¡ç±»å®ç°
- æ•°æ®æ¨¡å‹å®šä¹‰
- é”™è¯¯å¤„ç†æšä¸¾
- ä½¿ç”¨ç¤ºä¾‹ä»£ç 
- æ‰‹æœºç‚¹å‡»èƒŒå3æ¬¡çš„è§¦å‘æ–¹æ³•

#### 4. æ ¸å¿ƒAPIç«¯ç‚¹å¯¹æ¯”è¡¨

| APIç«¯ç‚¹ | ç”¨é€” | è¿”å›ç»“æœ |
|---------|------|----------|
| `POST /api/ocr/parse-auto` | æ™ºèƒ½è§£æ+è‡ªåŠ¨åˆ›å»º | é«˜ç½®ä¿¡åº¦è‡ªåŠ¨åˆ›å»ºï¼Œä½ç½®ä¿¡åº¦è¿”å›è§£æç»“æœ |
| `POST /api/ocr/parse` | åŸºç¡€è§£æ | è¿”å›è§£æç»“æœï¼Œéœ€è¦ç”¨æˆ·ç¡®è®¤ |
| `POST /api/ocr/confirm/:recordId` | ç¡®è®¤å¹¶åˆ›å»ºæ”¯å‡º | åˆ›å»ºæ”¯å‡ºè®°å½• |

#### 5. ç½®ä¿¡åº¦é˜ˆå€¼è¯´æ˜
- **â‰¥ 0.85**: é«˜ç½®ä¿¡åº¦ï¼Œå»ºè®®è‡ªåŠ¨åˆ›å»º
- **0.6 - 0.84**: ä¸­ç­‰ç½®ä¿¡åº¦ï¼Œå»ºè®®ç”¨æˆ·ç¡®è®¤  
- **< 0.6**: ä½ç½®ä¿¡åº¦ï¼Œéœ€è¦ç”¨æˆ·ä»”ç»†æ£€æŸ¥

### ğŸ¯ è§£å†³æ–¹æ¡ˆæ€»ç»“

**é—®é¢˜æ ¹å› **: ä¸æ˜¯åç«¯APIç¼ºå¤±ï¼Œè€Œæ˜¯APIæ–‡æ¡£ä¸å¤Ÿè¯¦ç»†ï¼Œå‰ç«¯å¼€å‘è€…ä¸æ¸…æ¥šå¦‚ä½•ä½¿ç”¨ç°æœ‰APIå®ç°è‡ªåŠ¨è®°è´¦åŠŸèƒ½ã€‚

**è§£å†³æªæ–½**:
1. âœ… **å®Œå–„APIæ–‡æ¡£**: æ·»åŠ äº†è¯¦ç»†çš„è‡ªåŠ¨è®°è´¦æµç¨‹è¯´æ˜
2. âœ… **æä¾›å®Œæ•´ç¤ºä¾‹**: åŒ…å«Swiftä»£ç çš„å®Œæ•´å®ç°
3. âœ… **æ˜ç¡®APIç”¨é€”**: é€šè¿‡å¯¹æ¯”è¡¨æ¸…æ™°è¯´æ˜å„APIçš„ç”¨é€”
4. âœ… **ä¼˜åŒ–å¼€å‘ä½“éªŒ**: æä¾›äº†å¯ç›´æ¥ä½¿ç”¨çš„ä»£ç æ¨¡æ¿

### ğŸ“± å‰ç«¯é›†æˆæŒ‡å¯¼

å‰ç«¯å¼€å‘è€…ç°åœ¨å¯ä»¥ï¼š

1. **æŸ¥çœ‹å®Œæ•´æµç¨‹**: äº†è§£ä¸¤ç§è‡ªåŠ¨è®°è´¦æ–¹æ¡ˆçš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯
2. **å¤åˆ¶ç¤ºä¾‹ä»£ç **: ç›´æ¥ä½¿ç”¨æä¾›çš„ `AutoExpenseService` å®ç°
3. **ç†è§£APIè°ƒç”¨**: é€šè¿‡è¯¦ç»†çš„APIæ–‡æ¡£äº†è§£è¯·æ±‚æ ¼å¼å’Œå“åº”å¤„ç†
4. **å¤„ç†é”™è¯¯æƒ…å†µ**: å‚è€ƒé”™è¯¯å¤„ç†ç¤ºä¾‹è¿›è¡Œå¼‚å¸¸å¤„ç†

### ğŸ”„ åç»­å»ºè®®

1. **å‰ç«¯å®ç°**: ä½¿ç”¨æä¾›çš„ `AutoExpenseService` å®ç°è‡ªåŠ¨è®°è´¦åŠŸèƒ½
2. **æµ‹è¯•éªŒè¯**: åœ¨å¼€å‘ç¯å¢ƒä¸­æµ‹è¯•å®Œæ•´çš„è‡ªåŠ¨è®°è´¦æµç¨‹
3. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**: æ ¹æ®ç½®ä¿¡åº¦é˜ˆå€¼ä¼˜åŒ–ç”¨æˆ·äº¤äº’æµç¨‹
4. **é”™è¯¯å¤„ç†**: å®ç°å®Œå–„çš„é”™è¯¯æç¤ºå’Œé‡è¯•æœºåˆ¶

**æ–‡æ¡£æ›´æ–°å®Œæˆæ—¶é—´**: 2025-10-15T09:00:00.000Z

---

## 2025-06-28 ä¿®å¤OCRè§£ædecodingErroré—®é¢˜

### ğŸ› é—®é¢˜æè¿°
- **é”™è¯¯ä¿¡æ¯**: `åç«¯è§£æå¤±è´¥: decodingError`
- **iOSå®¢æˆ·ç«¯æ—¥å¿—**:
  ```
  ğŸ” è§£æOCRæ–‡æœ¬: 15:17 A11 transactions å…æŠ¼ç§Ÿå€Ÿå……ç”µå® -4.00 Current 5tatu...
  ğŸ¤– OCR APIè¯·æ±‚: POST https://expense-tracker-backend-mocrhvaay-likexin0304s-projects.vercel.app/api/ocr/parse
  ğŸ”‘ ä½¿ç”¨è®¤è¯ä»¤ç‰Œ: eyJhbGciOiJIUzI1NiIs...
  âŒ åç«¯è§£æå¤±è´¥: decodingError
  âŒ é”™è¯¯ï¼šOCRè¯†åˆ«å¤±è´¥ï¼šNetwork error: åç«¯è§£æå¤±è´¥: æ•°æ®è§£æå¤±è´¥
  ```
- **å½±å“**: å‰ç«¯æ— æ³•è§£æåç«¯è¿”å›çš„æ•°æ®ï¼Œå¯¼è‡´OCRè‡ªåŠ¨è®°è´¦åŠŸèƒ½å®Œå…¨ä¸å¯ç”¨

### ğŸ” é—®é¢˜åˆ†æ
- **æ ¹æœ¬åŸå› **: 
  1. åç«¯OCRè§£æè¿‡ç¨‹ä¸­çš„é”™è¯¯å¤„ç†ä¸å®Œå–„ï¼Œå¯¼è‡´è¿”å›çš„æ•°æ®ç»“æ„ä¸ä¸€è‡´
  2. åœ¨æŸäº›è¾¹ç¼˜æƒ…å†µä¸‹ï¼ˆå¦‚æ•°æ®åº“æ“ä½œå¤±è´¥ï¼‰ï¼Œè¿”å›çš„å“åº”æ ¼å¼ä¸å‰ç«¯é¢„æœŸä¸ç¬¦
  3. ç¼ºå°‘å¯¹nullå€¼å’Œå¼‚å¸¸æƒ…å†µçš„å¤„ç†ï¼Œå¯¼è‡´å‰ç«¯è§£æJSONæ—¶å‡ºé”™

- **å…³é”®é—®é¢˜ç‚¹**:
  1. OCRæ§åˆ¶å™¨ä¸­ç¼ºå°‘å¯¹æ•°æ®åº“æ“ä½œå¤±è´¥çš„å®Œæ•´é”™è¯¯å¤„ç†
  2. OCRè§£æå™¨ä¸­æ²¡æœ‰å¯¹å„ä¸ªè§£ææ­¥éª¤è¿›è¡Œå¼‚å¸¸æ•è·
  3. å“åº”æ•°æ®ç»“æ„ä¸ä¸€è‡´ï¼Œæœ‰æ—¶ç¼ºå°‘å‰ç«¯æœŸæœ›çš„å­—æ®µ

### ğŸ”§ ä¿®å¤æªæ–½

#### 1. å¢å¼ºOCRæ§åˆ¶å™¨é”™è¯¯å¤„ç†
- **æ–‡ä»¶**: `src/controllers/ocrController.js`
- **ä¿®æ”¹å†…å®¹**:
  - æ·»åŠ å¯¹æ•°æ®åº“æ“ä½œçš„å®Œæ•´é”™è¯¯å¤„ç†
  - ç¡®ä¿æ‰€æœ‰å“åº”éƒ½æœ‰ä¸€è‡´çš„ç»“æ„ï¼ˆsuccess, message, error, dataï¼‰
  - å¢åŠ å¯¹nullå€¼çš„å®‰å…¨æ£€æŸ¥ï¼ˆå¦‚ `updatedRecord?.id || ocrRecord.id`ï¼‰
  - æ·»åŠ è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•
  - ä¸ºæ‰€æœ‰é”™è¯¯å“åº”æ·»åŠ æ ‡å‡†åŒ–çš„é”™è¯¯ä»£ç 

#### 2. å¢å¼ºOCRè§£æå™¨çš„å¥å£®æ€§
- **æ–‡ä»¶**: `src/utils/ocrParser.js`
- **ä¿®æ”¹å†…å®¹**:
  - å¯¹æ¯ä¸ªè§£ææ­¥éª¤æ·»åŠ try-catchï¼Œé˜²æ­¢å•ä¸ªè§£æå¤±è´¥å½±å“æ•´ä½“æµç¨‹
  - ç¡®ä¿æ‰€æœ‰è¿”å›å­—æ®µéƒ½æœ‰é»˜è®¤å€¼ï¼Œé¿å…nullå¼•ç”¨é”™è¯¯
  - å¢å¼ºæ•°æ®éªŒè¯åŠŸèƒ½ï¼Œç¡®ä¿è¿”å›çš„æ•°æ®æ ¼å¼ç¬¦åˆé¢„æœŸ
  - æ”¹è¿›é”™è¯¯å“åº”æ ¼å¼ï¼Œç¡®ä¿å³ä½¿åœ¨å¤±è´¥æƒ…å†µä¸‹ä¹Ÿè¿”å›éƒ¨åˆ†æœ‰ç”¨æ•°æ®

#### 3. æ ‡å‡†åŒ–é”™è¯¯å¤„ç†
- ä½¿ç”¨æ˜ç¡®çš„é”™è¯¯ä»£ç ï¼ˆå¦‚`INVALID_TEXT`, `PARSE_FAILED`, `DATABASE_ERROR`ï¼‰
- ç¡®ä¿æ‰€æœ‰å“åº”éƒ½åŒ…å«`success`ã€`message`ã€`data`å­—æ®µ
- åœ¨é”™è¯¯æƒ…å†µä¸‹æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯å’Œä»£ç 

### âœ… éªŒè¯ç»“æœ
- ä¿®å¤åï¼Œå³ä½¿åœ¨OCRè§£æå¤±è´¥çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½è¿”å›å‰ç«¯å¯ä»¥æ­£ç¡®è§£æçš„JSONæ ¼å¼
- å¢å¼ºäº†ç³»ç»Ÿå¯¹å¼‚å¸¸æƒ…å†µçš„å¤„ç†èƒ½åŠ›
- æä¾›äº†æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

### ğŸ“Š æŠ€æœ¯æ€»ç»“
- **é—®é¢˜ç±»å‹**: æ•°æ®æ ¼å¼ä¸ä¸€è‡´å¯¼è‡´çš„å‰ç«¯è§£æé”™è¯¯
- **è§£å†³ç­–ç•¥**: å…¨é¢å¢å¼ºé”™è¯¯å¤„ç†ï¼Œç¡®ä¿å“åº”æ ¼å¼ä¸€è‡´æ€§
- **é¢„é˜²æªæ–½**: å¯¹æ‰€æœ‰å¯èƒ½çš„å¤±è´¥ç‚¹æ·»åŠ å¼‚å¸¸æ•è·ï¼Œå¹¶ç¡®ä¿è¿”å›æ ‡å‡†åŒ–çš„å“åº”æ ¼å¼

### ğŸ”„ å‰ç«¯é€‚é…å»ºè®®
å‰ç«¯å¼€å‘è€…åº”è¯¥ï¼š
1. ç¡®ä¿å¤„ç†æ‰€æœ‰å¯èƒ½çš„é”™è¯¯çŠ¶æ€ï¼Œå³ä½¿çŠ¶æ€ç æ˜¯200
2. æ£€æŸ¥å“åº”ä¸­çš„`success`å­—æ®µï¼Œè€Œä¸ä»…ä»…ä¾èµ–HTTPçŠ¶æ€ç 
3. åœ¨è§£æå¤±è´¥æ—¶ï¼Œä½¿ç”¨`error`å­—æ®µä¸­çš„é”™è¯¯ä»£ç è¿›è¡Œä¸åŒå¤„ç†
4. ç¤ºä¾‹ä»£ç :
```swift
// æ¨èçš„å‰ç«¯é”™è¯¯å¤„ç†æ–¹å¼
func parseOCRResponse(_ data: Data) throws -> OCRResult {
    let decoder = JSONDecoder()
    let response = try decoder.decode(APIResponse.self, from: data)
    
    // é¦–å…ˆæ£€æŸ¥successå­—æ®µ
    guard response.success else {
        throw OCRError.backendError(code: response.error ?? "UNKNOWN_ERROR", 
                                   message: response.message ?? "æœªçŸ¥é”™è¯¯")
    }
    
    // ç¡®ä¿dataå­—æ®µå­˜åœ¨
    guard let resultData = response.data else {
        throw OCRError.missingData
    }
    
    return OCRResult(
        recordId: resultData.recordId,
        parsedData: resultData.parsedData,
        confidence: resultData.confidence ?? 0
    )
}
```

## 2025-06-27 ä¿®å¤OCRè§£æè¯·æ±‚å¤±è´¥é—®é¢˜

### ğŸ› é—®é¢˜æè¿°
- **é”™è¯¯ä¿¡æ¯**: `TypeError: Cannot read properties of undefined (reading 'id')`
- **é”™è¯¯ä½ç½®**: `/var/task/src/controllers/ocrController.js:17:37`
- **é”™è¯¯å †æ ˆ**: 
  ```
  at parseText (/var/task/src/controllers/ocrController.js:17:37)
  at Layer.handle [as handle_request] (/var/task/node_modules/express/lib/router/layer.js:95:5)
  at next (/var/task/node_modules/express/lib/router/route.js:149:13)
  at Route.dispatch (/var/task/node_modules/express/lib/router/route.js:119:3)
  ...
  ```

### ğŸ” é—®é¢˜åˆ†æ
- **æ ¹æœ¬åŸå› **: åœ¨`ocrController.js`ä¸­ï¼Œ`parseText`å’Œ`parseTextAndAutoCreate`å‡½æ•°æ²¡æœ‰æ£€æŸ¥`OCRRecord.create()`è¿”å›çš„`ocrRecord`å¯¹è±¡æ˜¯å¦å­˜åœ¨
- **é—®é¢˜åœºæ™¯**: å½“`OCRRecord.create()`å› æ•°æ®åº“è¿æ¥é—®é¢˜æˆ–å…¶ä»–åŸå› å¤±è´¥æ—¶ï¼Œè¿”å›`undefined`ï¼Œå¯¼è‡´åç»­ä»£ç å°è¯•è®¿é—®`ocrRecord.id`å±æ€§æ—¶æŠ¥é”™
- **å½±å“èŒƒå›´**: OCRæ–‡æœ¬è§£æåŠŸèƒ½å®Œå…¨ä¸å¯ç”¨

### ğŸ”§ ä¿®å¤æªæ–½
1. **ä¿®å¤`parseText`å‡½æ•°**:
   - æ·»åŠ å¯¹`ocrRecord`æ˜¯å¦å­˜åœ¨çš„æ£€æŸ¥
   - æ·»åŠ é”™è¯¯å¤„ç†é€»è¾‘ï¼Œè¿”å›é€‚å½“çš„é”™è¯¯å“åº”
   - æ·»åŠ è¯¦ç»†æ—¥å¿—è®°å½•

2. **ä¿®å¤`parseTextAndAutoCreate`å‡½æ•°**:
   - åŒæ ·æ·»åŠ å¯¹`ocrRecord`æ˜¯å¦å­˜åœ¨çš„æ£€æŸ¥
   - ä¿®å¤é”™è¯¯å¤„ç†é€»è¾‘ï¼Œç¡®ä¿è¿”å›é€‚å½“çš„é”™è¯¯å“åº”
   - ä¿®æ­£æ—¥å¿—ä¿¡æ¯

### ğŸ“ ä»£ç ä¿®æ”¹
- **æ–‡ä»¶**: `src/controllers/ocrController.js`
- **ä¿®æ”¹å†…å®¹**:
  - åœ¨åˆ›å»ºOCRè®°å½•åæ·»åŠ å­˜åœ¨æ€§æ£€æŸ¥ï¼š
    ```javascript
    // æ£€æŸ¥OCRè®°å½•æ˜¯å¦æˆåŠŸåˆ›å»º
    if (!ocrRecord || !ocrRecord.id) {
        console.error('âŒ OCRè®°å½•åˆ›å»ºå¤±è´¥');
        return res.status(500).json({
            success: false,
            message: 'OCRè®°å½•åˆ›å»ºå¤±è´¥',
            error: 'Failed to create OCR record'
        });
    }
    ```
  - ä¿®å¤é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### âœ… éªŒè¯ç»“æœ
- ä¿®å¤åï¼Œå½“OCRè®°å½•åˆ›å»ºå¤±è´¥æ—¶ï¼Œä¼šè¿”å›æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯ï¼Œè€Œä¸æ˜¯å¯¼è‡´æœåŠ¡å™¨å´©æºƒ
- å¢å¼ºäº†é”™è¯¯å¤„ç†èƒ½åŠ›ï¼Œæé«˜äº†æœåŠ¡ç¨³å®šæ€§
- æ·»åŠ äº†æ›´è¯¦ç»†çš„æ—¥å¿—è®°å½•ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

### ğŸ“Š æŠ€æœ¯æ€»ç»“
- **é—®é¢˜ç±»å‹**: ç©ºå¯¹è±¡å¼•ç”¨é”™è¯¯ (TypeError)
- **è§£å†³ç­–ç•¥**: æ·»åŠ ç©ºå€¼æ£€æŸ¥å’Œé€‚å½“çš„é”™è¯¯å¤„ç†
- **é¢„é˜²æªæ–½**: å¯¹æ‰€æœ‰å¯èƒ½è¿”å›undefinedçš„å¼‚æ­¥æ“ä½œæ·»åŠ æ£€æŸ¥

## 2025-06-26 APIç«¯ç‚¹éƒ¨ç½²å®Œæ•´æ€§éªŒè¯

### APIç«¯ç‚¹éƒ¨ç½²å®Œæ•´æ€§éªŒè¯
- **æ£€æŸ¥ç»“æœ**: API.mdæ–‡æ¡£ä¸­å®šä¹‰çš„æ‰€æœ‰33ä¸ªç«¯ç‚¹éƒ½å·²å®Œæ•´éƒ¨ç½² âœ…
  - åŸºç¡€ç«¯ç‚¹: 2ä¸ª âœ… (GET /health, GET /api/debug/routes)
  - è®¤è¯ç›¸å…³: 5ä¸ª âœ… (register, login, me, delete account, debug users)
  - é¢„ç®—ç®¡ç†: 7ä¸ª âœ… (create, current, alerts, suggestions, history, by month, delete)
  - æ”¯å‡ºè®°å½•: 9ä¸ª âœ… (CRUD, categories, export, trends, stats)
  - OCRè‡ªåŠ¨è¯†åˆ«: 10ä¸ª âœ… (parse, parse-auto, confirm, records CRUD, statistics, merchants, shortcuts)
- **æµ‹è¯•çŠ¶æ€**: æ‰€æœ‰ç«¯ç‚¹åŠŸèƒ½æ­£å¸¸ï¼Œå“åº”æ­£ç¡®
- **å¯¹æ¯”æ–¹æ³•**: ç³»ç»Ÿå¯¹æ¯”API.mdæ–‡æ¡£å®šä¹‰ä¸å®é™…éƒ¨ç½²çš„è·¯ç”±åˆ—è¡¨
- **éªŒè¯å·¥å…·**: curl + jq æµ‹è¯•ç«¯ç‚¹å¯ç”¨æ€§

### Rate Limitingé…ç½®ä¼˜åŒ–
- **é—®é¢˜**: Express trust proxyè®¾ç½®å¯¼è‡´rate limiting ValidationErrorè­¦å‘Š
  ```
  ValidationError: The Express 'trust proxy' setting is true, which allows anyone to trivially bypass IP-based rate limiting.
  ```
- **åŸå› **: express-rate-limitè®¤ä¸º`trust proxy: true`å¯èƒ½ä¸å®‰å…¨ï¼Œå¯èƒ½è¢«ç»•è¿‡IPé™åˆ¶
- **ä¿®å¤**: 
  1. ä¿æŒ`app.set('trust proxy', true)`ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…éœ€ï¼‰
  2. ä¼˜åŒ–rate limitingé…ç½®ï¼Œæ·»åŠ è‡ªå®šä¹‰keyGenerator
  3. åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨X-Forwarded-Forï¼Œå¼€å‘ç¯å¢ƒä½¿ç”¨çœŸå®IP
  4. æ·»åŠ ç¯å¢ƒç‰¹å®šçš„IPè·å–é€»è¾‘
- **ä¿®æ”¹æ–‡ä»¶**: `src/app.js` - rate limitingé…ç½®éƒ¨åˆ†
- **éªŒè¯**: æœåŠ¡å™¨å¯åŠ¨æ— è­¦å‘Šï¼Œæ‰€æœ‰33ä¸ªAPIç«¯ç‚¹æ­£å¸¸å·¥ä½œ

### é…ç½®çŠ¶æ€æ€»ç»“
- âœ… **æ‰€æœ‰APIç«¯ç‚¹å·²éƒ¨ç½²**: 33/33ä¸ªç«¯ç‚¹å®Œæ•´å¯ç”¨
- âœ… **Trust proxyé…ç½®**: ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒéƒ½æ­£ç¡®é…ç½®
- âœ… **Rate limitingä¼˜åŒ–**: æ— ValidationErrorè­¦å‘Š
- âœ… **æœåŠ¡å™¨å¯åŠ¨**: æ— é”™è¯¯ï¼Œæ— è­¦å‘Š
- âœ… **ç«¯ç‚¹åŠŸèƒ½æµ‹è¯•**: å¥åº·æ£€æŸ¥ã€è®¤è¯ã€è·¯ç”±åˆ—è¡¨ç­‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸

### ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æˆåŠŸ
- **éƒ¨ç½²æ—¶é—´**: 2025-06-26 11:19:58 GMT+8
- **éƒ¨ç½²ç‰ˆæœ¬**: v1.0.12
- **éƒ¨ç½²å¹³å°**: Vercel
- **ä¸»åŸŸå**: `https://expense-tracker-backend-likexin0304s-projects.vercel.app`
- **æœ€æ–°éƒ¨ç½²URL**: `https://expense-tracker-backend-p64s4eb06-likexin0304s-projects.vercel.app`
- **å¤‡ç”¨åŸŸå**: `https://expense-tracker-backend-xi-seven.vercel.app`
- **éƒ¨ç½²çŠ¶æ€**: âœ… Ready
- **ç¯å¢ƒå˜é‡**: å·²é…ç½®å®Œæ•´ï¼ˆNODE_ENV, JWT_SECRET, SUPABASE_URL, SUPABASE_ANON_KEY, SUPABASE_SERVICE_ROLE_KEYï¼‰
- **åŠŸèƒ½éªŒè¯**: 
  - âœ… å¥åº·æ£€æŸ¥æ­£å¸¸
  - âœ… 33ä¸ªAPIç«¯ç‚¹å…¨éƒ¨å¯ç”¨
  - âœ… ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½æ­£å¸¸
  - âœ… Supabaseæ•°æ®åº“è¿æ¥æ­£å¸¸
  - âœ… ç”Ÿäº§ç¯å¢ƒé…ç½®æ­£ç¡®

---

## 2025-06-23ï¼ˆğŸš€ v1.0.11: å¼ºåˆ¶Verceléƒ¨ç½²UUIDè°ƒè¯•ç‰ˆæœ¬ï¼‰

### ğŸš¨ **Verceléƒ¨ç½²é—®é¢˜å†æ¬¡å‡ºç°**

#### é—®é¢˜ç°è±¡
ç”¨æˆ·åˆ é™¤æ”¯å‡ºæ—¶ä»ç„¶æŠ¥é”™ï¼ŒVercelæ—¥å¿—æ˜¾ç¤ºï¼š
- **é”™è¯¯**: `invalid input syntax for type uuid: "8"`
- **å®Œæ•´UUID**: `8dbf136d-84d3-4b72-84bf-d7eb78c2dca0` (36å­—ç¬¦)
- **ä¼ ç»™æ•°æ®åº“**: `"8"` (åªæœ‰1ä¸ªå­—ç¬¦)
- **å…³é”®å‘ç°**: æ²¡æœ‰çœ‹åˆ°v1.0.10ç‰ˆæœ¬æ·»åŠ çš„è¯¦ç»†è°ƒè¯•æ—¥å¿—

#### æ ¹æœ¬åŸå› åˆ†æ
1. **Vercelä»åœ¨ä½¿ç”¨æ—§ä»£ç **ï¼š
   - æœ¬åœ°ä»£ç å·²åŒ…å«å®Œæ•´çš„UUIDè°ƒè¯•ä¿¡æ¯ï¼ˆ`Expense.findById`æ–¹æ³•161-184è¡Œï¼‰
   - Vercelæ—¥å¿—ä¸­å®Œå…¨æ²¡æœ‰è¿™äº›è°ƒè¯•ä¿¡æ¯è¾“å‡º
   - è¯´æ˜Vercelæ²¡æœ‰éƒ¨ç½²æœ€æ–°çš„v1.0.10ä»£ç 

2. **UUIDæˆªæ–­ä½ç½®**ï¼š
   - æ§åˆ¶å™¨å±‚æ­£å¸¸æ¥æ”¶ï¼š`8dbf136d-84d3-4b72-84bf-d7eb78c2dca0`
   - æ•°æ®åº“å±‚è¢«æˆªæ–­ï¼š`"8"`
   - é”™è¯¯ä½ç½®ï¼š`/var/task/src/models/Expense.js:145:23`

#### ğŸ”§ **å¼ºåˆ¶éƒ¨ç½²ä¿®å¤æªæ–½**

##### 1. ç‰ˆæœ¬å·å¼ºåˆ¶æ›´æ–°
**æ–‡ä»¶**: `package.json`
```diff
- "version": "1.0.10",
- "description": "è´¹ç”¨è¿½è¸ªåº”ç”¨åç«¯API - ä¿®å¤Vercelé…ç½®",
+ "version": "1.0.11",
+ "description": "è´¹ç”¨è¿½è¸ªåº”ç”¨åç«¯API - å¼ºåˆ¶Verceléƒ¨ç½² 2025-06-23",
```

##### 2. æœåŠ¡å™¨æ–‡ä»¶æ—¶é—´æˆ³æ›´æ–°
**æ–‡ä»¶**: `server.js`
```diff
/**
 * è´¹ç”¨è¿½è¸ªåº”ç”¨åç«¯æœåŠ¡å™¨
- * v1.0.10 - æ·»åŠ è¯¦ç»†è°ƒè¯•ä¿¡æ¯è¿½è¸ªUUIDæˆªæ–­é—®é¢˜
+ * v1.0.11 - å¼ºåˆ¶Verceléƒ¨ç½²UUIDè°ƒè¯•ç‰ˆæœ¬
+ * éƒ¨ç½²æ—¶é—´: 2025-06-23T04:00:00Z
 * ä¿®å¤: æ·»åŠ express-rate-limitä¾èµ–
 * ä¿®å¤: Vercelè·¯ç”±é…ç½®ï¼Œä½¿ç”¨builds+routesæ›¿ä»£rewrites
 * ä¿®å¤: UUIDå¤„ç†é—®é¢˜ï¼Œç§»é™¤æ‰€æœ‰parseInt(id)è°ƒç”¨
+ * è°ƒè¯•: æ·»åŠ è¯¦ç»†UUIDè¿½è¸ªä¿¡æ¯åˆ°Expense.findById
 */
```

##### 3. å¯åŠ¨æ—¥å¿—å¢å¼º
```diff
- console.log(`ğŸ“ Version: 1.0.10 - æ·»åŠ UUIDè°ƒè¯•ä¿¡æ¯`);
+ console.log(`ğŸ“ Version: 1.0.11 - å¼ºåˆ¶Verceléƒ¨ç½²UUIDè°ƒè¯•ç‰ˆæœ¬`);
+ console.log(`ğŸ› Debug: UUID tracking enabled in Expense.findById`);
```

#### ğŸš€ **éƒ¨ç½²çŠ¶æ€**
- âœ… ä»£ç å·²æäº¤: `git commit -m "ğŸš€ v1.0.11 - å¼ºåˆ¶Verceléƒ¨ç½²UUIDè°ƒè¯•ç‰ˆæœ¬"`
- âœ… ä»£ç å·²æ¨é€: `git push origin main`
- âŒ Vercelè‡ªåŠ¨éƒ¨ç½²æœªç”Ÿæ•ˆï¼ˆä»ä½¿ç”¨æ—§ä»£ç ï¼‰
- âœ… **Vercel CLIå¼ºåˆ¶éƒ¨ç½²æˆåŠŸ**: `npx vercel --prod --force`
- ğŸ†• **æ–°ç”Ÿäº§ç¯å¢ƒURL**: `https://expense-tracker-backend-fls5ul0ht-likexin0304s-projects.vercel.app`
- âœ… å¥åº·æ£€æŸ¥æ­£å¸¸: `2025-06-23T04:53:34.070Z`
- ğŸ” å‡†å¤‡éªŒè¯UUIDè°ƒè¯•æ—¥å¿—

#### ğŸ¯ **é¢„æœŸç»“æœ**
1. **è°ƒè¯•æ—¥å¿—å‡ºç°**ï¼š
   - `ğŸ” Expense.findById è°ƒç”¨å¼€å§‹`
   - `ğŸ” å‡†å¤‡æ‰§è¡ŒSupabaseæŸ¥è¯¢ï¼ŒUUID`
   - `ğŸ” SupabaseæŸ¥è¯¢å®Œæˆ`

2. **UUIDå®Œæ•´æ€§éªŒè¯**ï¼š
   - 36å­—ç¬¦UUIDä¸è¢«æˆªæ–­
   - è¯¦ç»†çš„UUIDæ ¼å¼éªŒè¯æ—¥å¿—
   - é”™è¯¯ä½ç½®ç²¾ç¡®å®šä½

3. **åˆ é™¤åŠŸèƒ½ä¿®å¤**ï¼š
   - æ”¯å‡ºè®°å½•æˆåŠŸåˆ é™¤
   - å‰ç«¯åˆ·æ–°åè®°å½•çœŸæ­£æ¶ˆå¤±

#### ğŸ“Š **æŠ€æœ¯åˆ†æ**
**é—®é¢˜ç±»å‹**: Verceléƒ¨ç½²ç¼“å­˜/åŒæ­¥é—®é¢˜
**è§£å†³ç­–ç•¥**: 
- å¤šé‡å¼ºåˆ¶æ›´æ–°æ ‡è®°ï¼ˆç‰ˆæœ¬å·+æ—¶é—´æˆ³+æè¿°ï¼‰
- å¯åŠ¨æ—¥å¿—éªŒè¯éƒ¨ç½²ç‰ˆæœ¬
- è¯¦ç»†è°ƒè¯•ä¿¡æ¯è¿½è¸ªUUIDå¤„ç†æµç¨‹

**å¤‡ç”¨æ–¹æ¡ˆ**: å¦‚æœè‡ªåŠ¨éƒ¨ç½²ä»ä¸ç”Ÿæ•ˆï¼Œå‡†å¤‡æ‰‹åŠ¨è§¦å‘Vercel Dashboardé‡æ–°éƒ¨ç½²

---

## 2025-06-20ï¼ˆâœ… v1.0.8: Verceléƒ¨ç½²é—®é¢˜å½»åº•è§£å†³ï¼ï¼‰

### ğŸ‰ **é‡å¤§çªç ´ï¼šVerceléƒ¨ç½²é—®é¢˜å®Œå…¨ä¿®å¤**

ç»è¿‡æ·±å…¥æ’æŸ¥ï¼ŒæˆåŠŸè§£å†³äº†Verceléƒ¨ç½²çš„æ‰€æœ‰é—®é¢˜ï¼š

#### ğŸš¨ **å‘ç°çš„é—®é¢˜**
1. **Vercelé…ç½®é”™è¯¯**ï¼š
   - ä½¿ç”¨äº†`rewrites`é…ç½®å¯¼è‡´è¿”å›æºä»£ç è€Œä¸æ˜¯æ‰§è¡ŒAPI
   - Mixed routing propertiesé”™è¯¯ï¼šä¸èƒ½åŒæ—¶ä½¿ç”¨`routes`å’Œ`headers`

2. **ç¼ºå¤±å…³é”®ä¾èµ–**ï¼š
   - `express-rate-limit`ä¾èµ–æœªåœ¨`package.json`ä¸­å£°æ˜
   - å¯¼è‡´Vercelå‡½æ•°æ‰§è¡Œå¤±è´¥ï¼š`FUNCTION_INVOCATION_FAILED`

#### ğŸ”§ **ä¿®å¤æªæ–½**

##### 1. ä¿®å¤Vercelé…ç½® (`vercel.json`)
```json
{
  "version": 2,
  "builds": [{"src": "server.js", "use": "@vercel/node"}],
  "routes": [{"src": "/(.*)", "dest": "/server.js"}]
}
```
- âœ… ä½¿ç”¨`builds` + `routes`æ›¿ä»£`rewrites`
- âœ… ç§»é™¤`headers`é…ç½®é¿å…mixed routingé”™è¯¯
- âœ… æ­£ç¡®é…ç½®`@vercel/node`æ„å»ºå™¨

##### 2. æ·»åŠ ç¼ºå¤±ä¾èµ– (`package.json`)
```json
"express-rate-limit": "^6.7.0"
```
- âœ… æ·»åŠ `express-rate-limit`ä¾èµ–
- âœ… ç‰ˆæœ¬å·æ›´æ–°ï¼š`1.0.7` â†’ `1.0.8`

#### ğŸ§ª **éªŒè¯ç»“æœ**
- âœ… **å¥åº·æ£€æŸ¥æ­£å¸¸**ï¼š`{"status":"OK","timestamp":"2025-06-20T09:17:13.694Z","env":"production"}`
- âœ… **APIç«¯ç‚¹å¯ç”¨**ï¼šè¿”å›æ­£ç¡®çš„è®¤è¯é”™è¯¯è€Œä¸æ˜¯å‡½æ•°å¤±è´¥
- âœ… **ä¸»åŸŸåæ­£å¸¸**ï¼š`https://expense-tracker-backend-likexin0304s-projects.vercel.app`
- âœ… **æœ€æ–°éƒ¨ç½²URL**ï¼š`https://expense-tracker-backend-nm3a1bc9f-likexin0304s-projects.vercel.app`

#### ğŸ”„ **éƒ¨ç½²å†ç¨‹**
1. **v1.0.6**: ä¿®å¤UUIDå¤„ç†ï¼Œä½†Vercelä»è¿”å›æºä»£ç 
2. **v1.0.7**: ä¿®å¤Vercelé…ç½®ï¼Œä½†é‡åˆ°å‡½æ•°æ‰§è¡Œå¤±è´¥
3. **v1.0.8**: æ·»åŠ ç¼ºå¤±ä¾èµ–ï¼Œ**å®Œå…¨è§£å†³æ‰€æœ‰é—®é¢˜** âœ…

### ğŸ¯ **ä¸‹ä¸€æ­¥ï¼šæµ‹è¯•UUIDåˆ é™¤åŠŸèƒ½**
ç°åœ¨Verceléƒ¨ç½²æ­£å¸¸ï¼Œå¯ä»¥æµ‹è¯•UUIDåˆ é™¤åŠŸèƒ½æ˜¯å¦ä¿®å¤ï¼š
- é¢„æœŸï¼š`[v1.0.5-latest]`è°ƒè¯•æ—¥å¿—å‡ºç°
- é¢„æœŸï¼š36å­—ç¬¦UUIDå®Œæ•´ä¼ é€’åˆ°æ•°æ®åº“
- é¢„æœŸï¼šåˆ é™¤åŠŸèƒ½æ­£å¸¸å·¥ä½œ

### ğŸ“Š **æŠ€æœ¯æ€»ç»“**
**æ ¹æœ¬åŸå› **ï¼šVerceléƒ¨ç½²é…ç½®é”™è¯¯ + ç¼ºå¤±ä¾èµ–
**è§£å†³æ–¹æ¡ˆ**ï¼šæ­£ç¡®çš„builds+routesé…ç½® + å®Œæ•´çš„ä¾èµ–å£°æ˜
**å…³é”®å­¦ä¹ **ï¼šVercelçš„ç°ä»£é…ç½®è¦æ±‚å’Œä¾èµ–ç®¡ç†çš„é‡è¦æ€§

---

## 2025-06-20ï¼ˆğŸ› v1.0.6: å¼ºåˆ¶ä¿®å¤UUIDåˆ é™¤é—®é¢˜ï¼‰

### ğŸš¨ é—®é¢˜æè¿°
Vercelçº¿ä¸Šç¯å¢ƒä»ç„¶å­˜åœ¨UUIDæˆªæ–­é—®é¢˜ï¼š
- **é”™è¯¯æ—¥å¿—**: `invalid input syntax for type uuid: "4513089"`
- **å®Œæ•´UUID**: `4513089a-8823-466a-bbc2-411639a86f95` (36å­—ç¬¦)
- **ä¼ ç»™æ•°æ®åº“**: `"4513089"` (7å­—ç¬¦)
- **é—®é¢˜**: Vercelä»åœ¨ä½¿ç”¨æ—§ç‰ˆæœ¬ä»£ç ï¼Œæˆ–å­˜åœ¨ç¼“å­˜é—®é¢˜

### ğŸ”§ ä¿®å¤æªæ–½

#### 1. å¼ºåŒ–deleteExpenseæ–¹æ³•
**æ–‡ä»¶**: `src/controllers/expenseController.js`
- âœ… æ·»åŠ è¯¦ç»†è°ƒè¯•æ—¥å¿— `[v1.0.5-latest]`
- âœ… æ·»åŠ UUIDæ ¼å¼éªŒè¯ï¼ˆé•¿åº¦å¿…é¡»ä¸º36å­—ç¬¦ï¼‰
- âœ… æ·»åŠ ç±»å‹æ£€æŸ¥å’Œé”™è¯¯å¤„ç†
- âœ… åœ¨æ¯ä¸ªå…³é”®æ­¥éª¤æ·»åŠ IDè¿½è¸ªæ—¥å¿—

#### 2. å¼ºåˆ¶éƒ¨ç½²æ›´æ–°
**æ–‡ä»¶**: `package.json`
- âœ… ç‰ˆæœ¬å·: `1.0.5` â†’ `1.0.6`
- âœ… æ¸…ç†ä¾èµ–ç‰ˆæœ¬å·

**æ–‡ä»¶**: `server.js`
- âœ… æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯åˆ° v1.0.6
- âœ… æ·»åŠ å¼ºåˆ¶éƒ¨ç½²æ—¶é—´æˆ³
- âœ… æ·»åŠ è¯¦ç»†å¯åŠ¨æ—¥å¿—

#### 3. ä»£ç éªŒè¯
- âœ… ç¡®è®¤æœ¬åœ°ä»£ç æ— ä»»ä½• `parseInt(id)` è°ƒç”¨
- âœ… ç¡®è®¤ `Expense.findById()` æ–¹æ³•æ­£ç¡®å¤„ç†UUID
- âœ… ç¡®è®¤ `Expense.deleteById()` æ–¹æ³•æ­£ç¡®å¤„ç†UUID

### ğŸ“ è°ƒè¯•å¢å¼º
```javascript
// æ–°å¢UUIDéªŒè¯
if (!id || typeof id !== 'string' || id.length !== 36) {
  console.error('âŒ æ— æ•ˆçš„UUIDæ ¼å¼:', { id, type: typeof id, length: id ? id.length : 'undefined' });
  return res.status(400).json({
    success: false,
    message: 'æ— æ•ˆçš„æ”¯å‡ºè®°å½•IDæ ¼å¼'
  });
}
```

### ğŸš€ éƒ¨ç½²çŠ¶æ€
- âœ… ä»£ç å·²æäº¤: `git commit -m "ğŸš€ v1.0.6: å¼ºåˆ¶ä¿®å¤UUIDåˆ é™¤é—®é¢˜"`
- âœ… ä»£ç å·²æ¨é€: `git push origin main`
- â³ ç­‰å¾…Vercelè‡ªåŠ¨éƒ¨ç½²
- ğŸ”„ æœŸå¾…UUIDåˆ é™¤åŠŸèƒ½æ­£å¸¸å·¥ä½œ

### ğŸ¯ é¢„æœŸç»“æœ
1. **Vercelä½¿ç”¨æœ€æ–°ä»£ç **: è°ƒè¯•æ—¥å¿—æ˜¾ç¤º `[v1.0.5-latest]`
2. **UUIDå®Œæ•´ä¼ é€’**: 36å­—ç¬¦UUIDä¸è¢«æˆªæ–­
3. **åˆ é™¤åŠŸèƒ½æ­£å¸¸**: æ”¯å‡ºè®°å½•æˆåŠŸåˆ é™¤
4. **å‰ç«¯æ˜¾ç¤ºæ­£ç¡®**: åˆ é™¤åè®°å½•çœŸæ­£æ¶ˆå¤±

### ğŸ“Š é—®é¢˜åˆ†æ
**æ ¹æœ¬åŸå› **: Verceléƒ¨ç½²ç¼“å­˜å¯¼è‡´ä»£ç æ›´æ–°å»¶è¿Ÿç”Ÿæ•ˆ
**è§£å†³ç­–ç•¥**: 
- å¼ºåˆ¶ç‰ˆæœ¬å·æ›´æ–°
- æ·»åŠ æ—¶é—´æˆ³å¼ºåˆ¶é‡æ–°éƒ¨ç½²
- è¯¦ç»†æ—¥å¿—ç¡®è®¤ä»£ç ç‰ˆæœ¬

---

## 2024-06-17ï¼ˆğŸ‰ Vercel éƒ¨ç½²æˆåŠŸï¼ï¼‰

### ğŸš€ Vercel éƒ¨ç½²å®Œæˆ
éƒ¨ç½²åœ°å€ï¼š**https://expense-tracker-backend-ccuxsyehj-likexin0304s-projects.vercel.app/**

#### åˆ›å»ºçš„æ–‡ä»¶
1. **vercel.json**ï¼š
   - é…ç½® Node.js æ„å»º
   - è®¾ç½®è·¯ç”±è§„åˆ™
   - ç”Ÿäº§ç¯å¢ƒé…ç½®

2. **deploy-guide.md**ï¼š
   - è¯¦ç»†çš„éƒ¨ç½²æ­¥éª¤æŒ‡å—
   - ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜
   - iOS åº”ç”¨é›†æˆæŒ‡å¯¼
   - æ•…éšœæ’é™¤æŒ‡å—

#### ç¯å¢ƒå˜é‡é…ç½®
**éœ€è¦åœ¨ Vercel Dashboard ä¸­æ·»åŠ ä»¥ä¸‹ 5 ä¸ªç¯å¢ƒå˜é‡**ï¼š
- `NODE_ENV=production`
- `JWT_SECRET=expense_tracker_jwt_secret_2024_production_change_this_in_real_deployment`
- `SUPABASE_URL=https://nlrtjnvwgsaavtpfccxg.supabase.co`
- `SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`
- `SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`

#### é…ç½®æ­¥éª¤
1. è®¿é—® https://vercel.com/dashboard
2. æ‰¾åˆ°é¡¹ç›® `expense-tracker-backend`
3. Settings â†’ Environment Variables
4. é€ä¸€æ·»åŠ ä¸Šè¿°ç¯å¢ƒå˜é‡
5. æ¯ä¸ªå˜é‡é€‰æ‹©ï¼šProduction, Preview, Development
6. é‡æ–°éƒ¨ç½²é¡¹ç›®

#### éƒ¨ç½²çŠ¶æ€
- âœ… Vercel CLI å·²å®‰è£…ï¼ˆv43.2.0ï¼‰
- âœ… éƒ¨ç½²é…ç½®æ–‡ä»¶å·²åˆ›å»º
- âœ… é¡¹ç›®æˆåŠŸéƒ¨ç½²åˆ° Vercel
- ğŸ”„ ç¯å¢ƒå˜é‡é…ç½®ä¸­
- â³ ç”Ÿäº§ç¯å¢ƒæµ‹è¯•å¾…å®Œæˆ

### 8. ğŸ“± iOS é›†æˆæ–‡æ¡£åˆ›å»º
- **æ–‡ä»¶**: `docs/swift-supabase-example.md`
- **å†…å®¹åŒ…å«**:
  - å®Œæ•´çš„åç«¯æ¶æ„è¯´æ˜å’ŒæŠ€æœ¯æ ˆ
  - Supabase é›†æˆè¯¦ç»†æŒ‡å—
  - è®¤è¯ç³»ç»Ÿå®Œæ•´é›†æˆæ–¹æ¡ˆ
  - è¯¦ç»†çš„æ•°æ®æ¨¡å‹å®šä¹‰å’Œæ˜ å°„
  - API é›†æˆç¤ºä¾‹ä»£ç ï¼ˆç½‘ç»œå±‚ã€æœåŠ¡å±‚ï¼‰
  - é”™è¯¯å¤„ç†æœ€ä½³å®è·µ
  - å®‰å…¨æ³¨æ„äº‹é¡¹å’Œ Keychain ä½¿ç”¨
  - æµ‹è¯•å’Œè°ƒè¯•æŒ‡å—
  - éƒ¨ç½²ä¿¡æ¯å’Œç‰ˆæœ¬ç®¡ç†
- **ç›®æ ‡**: ä¸º iOS å¼€å‘è€…æä¾›ä¸€ç«™å¼åç«¯é›†æˆæŒ‡å—
- **ç‰¹è‰²**: åŒ…å«å®Œæ•´çš„ Swift ä»£ç ç¤ºä¾‹å’Œæœ€ä½³å®è·µ

#### é¢„æœŸç»“æœ
- ç”Ÿäº§ç¯å¢ƒ URLï¼š`https://expense-tracker-backend-ccuxsyehj-likexin0304s-projects.vercel.app/`
- å¥åº·æ£€æŸ¥ï¼š`/health` ç«¯ç‚¹æ­£å¸¸
- æ‰€æœ‰ 21 ä¸ª API ç«¯ç‚¹å¯ç”¨
- iOS åº”ç”¨å¯è¿æ¥åç«¯

## 2024-06-17ï¼ˆAPI æ–‡æ¡£æ›´æ–°å®Œæˆï¼‰

### ğŸ“ API.md æ–‡æ¡£å…¨é¢æ›´æ–°
ä¸º iOS å‰ç«¯å¼€å‘æä¾›å®Œæ•´çš„ API é›†æˆæŒ‡å—ï¼š

#### æ›´æ–°å†…å®¹
1. **åŸºç¡€ä¿¡æ¯æ›´æ–°**ï¼š
   - æ·»åŠ ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒ URL
   - æ›´æ–° Supabase é¡¹ç›®é…ç½®ä¿¡æ¯
   - æ˜ç¡®æ•°æ®åº“çŠ¶æ€å’Œ API ç«¯ç‚¹æ•°é‡

2. **iOS å®¢æˆ·ç«¯é›†æˆæŒ‡å—**ï¼š
   - å®Œæ•´çš„ Supabase Swift SDK é›†æˆæ­¥éª¤
   - Info.plist é…ç½®ç¤ºä¾‹
   - ç”¨æˆ·è®¤è¯ä»£ç ç¤ºä¾‹
   - æ•°æ®æ“ä½œä»£ç ç¤ºä¾‹
   - å®‰å…¨æ³¨æ„äº‹é¡¹

3. **éƒ¨ç½²ä¿¡æ¯å®Œå–„**ï¼š
   - **æ¨èæ–¹æ¡ˆ**ï¼šVercel éƒ¨ç½²ï¼ˆå…è´¹ã€ç®€å•ã€è‡ªåŠ¨åŒ–ï¼‰
   - **æ›¿ä»£æ–¹æ¡ˆ**ï¼šRailwayã€Renderã€Heroku
   - **ä¸æ¨èæ–¹æ¡ˆ**ï¼šé˜¿é‡Œäº‘ K8sã€è‡ªå»ºæœåŠ¡å™¨
   - è¯¦ç»†çš„ Vercel éƒ¨ç½²æ­¥éª¤å’Œé…ç½®
   - ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•
   - ç›‘æ§å’Œç»´æŠ¤å»ºè®®

#### å…³é”®é…ç½®ä¿¡æ¯
- **Supabase URL**: `https://nlrtjnvwgsaavtpfccxg.supabase.co`
- **é¡¹ç›® ID**: `nlrtjnvwgsaavtpfccxg`
- **API ç«¯ç‚¹**: 21ä¸ªå®Œæ•´åŠŸèƒ½
- **æ•°æ®åº“**: PostgreSQL with RLS

#### ä¸º iOS å¼€å‘è€…æä¾›
- å®Œæ•´çš„ Swift ä»£ç ç¤ºä¾‹
- å®‰å…¨é…ç½®æŒ‡å—
- é”™è¯¯å¤„ç†ç¤ºä¾‹
- æ•°æ®æ¨¡å‹æ˜ å°„

## 2024-06-17ï¼ˆç«¯å£å ç”¨é—®é¢˜è§£å†³ï¼‰

### ğŸ› é—®é¢˜æè¿°
æœåŠ¡å™¨å¯åŠ¨æ—¶é‡åˆ°ç«¯å£å ç”¨é”™è¯¯ï¼š
```
Error: listen EADDRINUSE: address already in use :::3000
```

### ğŸ” é—®é¢˜æ’æŸ¥
1. **ç«¯å£å ç”¨æ£€æŸ¥**ï¼šä½¿ç”¨ `lsof -ti:3000` å‘ç°è¿›ç¨‹ ID `26982`
2. **è¿›ç¨‹è¯†åˆ«**ï¼šé€šè¿‡ `ps aux | grep 26982` ç¡®è®¤æ˜¯ä¹‹å‰çš„ `node server.js` è¿›ç¨‹
3. **æ ¹æœ¬åŸå› **ï¼šä¹‹å‰å¯åŠ¨çš„æœåŠ¡å™¨è¿›ç¨‹æ²¡æœ‰æ­£ç¡®ç»ˆæ­¢ï¼Œä»åœ¨å ç”¨ç«¯å£ 3000

### âœ… è§£å†³æ–¹æ¡ˆ
1. **ç»ˆæ­¢å ç”¨è¿›ç¨‹**ï¼š
   ```bash
   kill 26982
   ```
2. **éªŒè¯ç«¯å£é‡Šæ”¾**ï¼š
   ```bash
   lsof -ti:3000  # æ— è¾“å‡ºè¡¨ç¤ºç«¯å£å·²é‡Šæ”¾
   ```
3. **é‡æ–°å¯åŠ¨æœåŠ¡å™¨**ï¼š
   ```bash
   npm start
   ```

### ğŸ§ª éªŒè¯ç»“æœ
- âœ… æœåŠ¡å™¨æˆåŠŸå¯åŠ¨åœ¨ localhost:3000
- âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹æ­£å¸¸ï¼š`{"status":"OK","timestamp":"2025-06-17T07:49:01.105Z","env":"development"}`
- âœ… API è·¯ç”±è°ƒè¯•ç«¯ç‚¹æ­£å¸¸ï¼š21ä¸ªå¯ç”¨ç«¯ç‚¹
- âœ… æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å¯ç”¨

### ğŸ“ é¢„é˜²æªæ–½
ä¸ºé¿å…å°†æ¥å‡ºç°ç±»ä¼¼é—®é¢˜ï¼Œå»ºè®®ï¼š
1. ä½¿ç”¨ `Ctrl+C` æ­£ç¡®ç»ˆæ­¢æœåŠ¡å™¨
2. å¯åŠ¨å‰æ£€æŸ¥ç«¯å£ï¼š`lsof -ti:3000`
3. è€ƒè™‘ä½¿ç”¨ nodemon è¿›è¡Œå¼€å‘æ—¶çš„è‡ªåŠ¨é‡å¯

## 2024-06-17ï¼ˆæ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼‰

### âœ… Supabase æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
é€šè¿‡ Supabase CLI æˆåŠŸå®Œæˆäº†æ•°æ®åº“çš„å®Œæ•´åˆå§‹åŒ–ï¼š

#### æ‰§è¡Œçš„æ“ä½œ
1. **CLI ç™»å½•**ï¼šä½¿ç”¨è®¿é—®ä»¤ç‰ŒæˆåŠŸç™»å½• Supabase CLI
2. **é¡¹ç›®è¿æ¥**ï¼šæˆåŠŸè¿æ¥åˆ°é¡¹ç›® `nlrtjnvwgsaavtpfccxg`
3. **è¿ç§»åˆ›å»º**ï¼šåˆ›å»ºè¿ç§»æ–‡ä»¶ `20250617071807_init_expense_tracker_database.sql`
4. **è¿ç§»æ¨é€**ï¼šæˆåŠŸæ¨é€åˆ°è¿œç¨‹æ•°æ®åº“
5. **éªŒè¯å®Œæˆ**ï¼šé€šè¿‡ `supabase db diff` ç¡®è®¤åŒæ­¥æˆåŠŸ

#### åˆ›å»ºçš„æ•°æ®åº“ç»“æ„
- âœ… `public.profiles` è¡¨ï¼ˆç”¨æˆ·æ‰©å±•ä¿¡æ¯ï¼‰
- âœ… `budgets` è¡¨ï¼ˆé¢„ç®—ç®¡ç†ï¼‰
- âœ… `expenses` è¡¨ï¼ˆæ”¯å‡ºè®°å½•ï¼‰
- âœ… å®Œæ•´çš„ RLS å®‰å…¨ç­–ç•¥
- âœ… æ€§èƒ½ä¼˜åŒ–ç´¢å¼•ï¼ˆ8ä¸ªç´¢å¼•ï¼‰
- âœ… è‡ªåŠ¨æ›´æ–°è§¦å‘å™¨
- âœ… ç”¨æˆ·æ³¨å†Œè‡ªåŠ¨åˆ›å»º profile è§¦å‘å™¨

#### ç¯å¢ƒé…ç½®å®Œæˆ
- âœ… åˆ›å»º `.env` æ–‡ä»¶ï¼ŒåŒ…å«å®Œæ•´çš„ Supabase é…ç½®
- âœ… é…ç½®é¡¹ç›® URLï¼š`https://nlrtjnvwgsaavtpfccxg.supabase.co`
- âœ… é…ç½® API å¯†é’¥ï¼ˆanon å’Œ service_roleï¼‰

#### é—®é¢˜è§£å†³
- **ç´¢å¼•é—®é¢˜**ï¼šä¿®å¤äº† `CURRENT_DATE` åœ¨ç´¢å¼•æ¡ä»¶ä¸­çš„é”™è¯¯
- **é…ç½®å·®å¼‚**ï¼šå¤„ç†äº†æœ¬åœ°é…ç½®ä¸è¿œç¨‹é¡¹ç›®çš„ç‰ˆæœ¬å·®å¼‚

#### æµ‹è¯•éªŒè¯
- âœ… æœåŠ¡å™¨æˆåŠŸå¯åŠ¨åœ¨ localhost:3000
- âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹ `/health` æ­£å¸¸å“åº”
- âœ… æ•°æ®åº“è¿æ¥é…ç½®æ­£ç¡®

### é¡¹ç›®çŠ¶æ€
**åç«¯å·²å®Œå…¨å°±ç»ªï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨ï¼**
- æ•°æ®åº“è¡¨ç»“æ„å®Œæ•´
- API ç«¯ç‚¹å…¨éƒ¨å¯ç”¨
- å®‰å…¨ç­–ç•¥å·²å¯ç”¨
- ç¯å¢ƒé…ç½®å®Œæˆ

## 2024-06-17ï¼ˆSupabase CLI å®‰è£…å’Œé…ç½®ï¼‰

### Supabase CLI å®‰è£…é—®é¢˜è§£å†³
- **é—®é¢˜**ï¼šç”¨æˆ·å°è¯•ä½¿ç”¨ `npm install -g supabase` å…¨å±€å®‰è£…å¤±è´¥
- **é”™è¯¯ä¿¡æ¯**ï¼š`Installing Supabase CLI as a global module is not supported`
- **åŸå› **ï¼šæ–°ç‰ˆæœ¬çš„ Supabase CLI ä¸å†æ”¯æŒé€šè¿‡ npm å…¨å±€å®‰è£…

### è§£å†³æ–¹æ¡ˆï¼ˆå·²å®æ–½ï¼‰
1. **ä½¿ç”¨ npxï¼ˆæ¨èï¼‰**ï¼š
   ```bash
   npx supabase --help
   ```
   - æ— éœ€å®‰è£…ï¼Œç›´æ¥ä½¿ç”¨
   - æ¯æ¬¡éƒ½ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬

2. **é¡¹ç›®ä¾èµ–å®‰è£…**ï¼š
   ```bash
   npm install supabase --save-dev
   ```
   - ä½œä¸ºå¼€å‘ä¾èµ–å®‰è£…åˆ°é¡¹ç›®ä¸­
   - å¯ä»¥åœ¨ package.json ä¸­æ·»åŠ è„šæœ¬

3. **Homebrew ç³»ç»Ÿçº§å®‰è£…ï¼ˆå·²å®Œæˆï¼‰**ï¼š
   ```bash
   brew install supabase/tap/supabase
   ```
   - ç³»ç»Ÿçº§å®‰è£…ï¼Œç‰ˆæœ¬ 2.26.9
   - å¯ä»¥ç›´æ¥ä½¿ç”¨ `supabase` å‘½ä»¤

### æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ä½¿ç”¨æ–¹æ³•
**æ¨èæ–¹æ³•**ï¼šåœ¨ Supabase Dashboard ä¸­æ‰§è¡Œ
1. è®¿é—® Supabase é¡¹ç›® Dashboard
2. ç‚¹å‡»å·¦ä¾§èœå•çš„ "SQL Editor"
3. å¤åˆ¶ `database/init.sql` å†…å®¹åˆ°ç¼–è¾‘å™¨
4. ç‚¹å‡» "Run" æ‰§è¡Œè„šæœ¬

**CLI æ–¹æ³•**ï¼ˆéœ€è¦ç™»å½•ï¼‰ï¼š
```bash
# ç™»å½•åˆ° Supabase
supabase login

# è¿æ¥åˆ°é¡¹ç›®
supabase link --project-ref YOUR_PROJECT_REF

# æ‰§è¡Œè¿ç§»
supabase db push
```

### ç¯å¢ƒå˜é‡é…ç½®æé†’
ç¡®ä¿åœ¨é¡¹ç›®ä¸­é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
```env
SUPABASE_URL=your_supabase_project_url
SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

### æ•°æ®åº“è¡¨ç»“æ„ç¡®è®¤
`database/init.sql` è„šæœ¬å°†åˆ›å»ºï¼š
- `public.profiles` è¡¨ï¼ˆç”¨æˆ·æ‰©å±•ä¿¡æ¯ï¼‰
- `budgets` è¡¨ï¼ˆé¢„ç®—ç®¡ç†ï¼‰
- `expenses` è¡¨ï¼ˆæ”¯å‡ºè®°å½•ï¼‰
- å®Œæ•´çš„ RLS å®‰å…¨ç­–ç•¥
- æ€§èƒ½ä¼˜åŒ–ç´¢å¼•
- è‡ªåŠ¨æ›´æ–°è§¦å‘å™¨

## 2023-xx-xxï¼ˆå½“å‰æ—¥æœŸï¼‰

### æ·»åŠ çš„æ–‡ä»¶
- åˆ›å»ºäº† `server.js` - è®¾ç½®åŸºæœ¬çš„æœåŠ¡å™¨ï¼Œç›‘å¬æŒ‡å®šç«¯å£
- åˆ›å»ºäº† `src/app.js` - é…ç½®Expressåº”ç”¨ï¼Œè®¾ç½®ä¸­é—´ä»¶å’ŒåŸºæœ¬è·¯ç”±

### ä¿®æ”¹çš„æ–‡ä»¶
- æ›´æ–°äº† `package.json`ï¼š
  - æ·»åŠ äº† `start` å’Œ `dev` è„šæœ¬
  - æ·»åŠ äº† `morgan` ä¾èµ–ç”¨äºæ—¥å¿—è®°å½•

### å®‰è£…è¯´æ˜
éœ€è¦å®‰è£…æ–°çš„ä¾èµ–ï¼š
```bash
npm install
```

### è¿è¡Œè¯´æ˜
å¼€å‘æ¨¡å¼è¿è¡Œï¼š
```bash
npm run dev
```

ç”Ÿäº§æ¨¡å¼è¿è¡Œï¼š
```bash
npm start
```

## 2024-06-20ï¼ˆURLæ ¼å¼é”™è¯¯é—®é¢˜ä¿®å¤ï¼‰

### ğŸ› é—®é¢˜å‘ç°
ç”¨æˆ·åé¦ˆAPIæŠ¥é”™ï¼š`"è·¯ç”± /api/expense?id=8dbf136d-84d3-4b72-84bf-d7eb78c2dca0 ä¸å­˜åœ¨"`

### ğŸ” æ ¹æœ¬åŸå› 
**iOSå®¢æˆ·ç«¯ä½¿ç”¨äº†é”™è¯¯çš„URLæ ¼å¼**ï¼š
- âŒ é”™è¯¯æ ¼å¼ï¼š`DELETE /api/expense?id=8dbf136d-84d3-4b72-84bf-d7eb78c2dca0` (æŸ¥è¯¢å‚æ•°)
- âœ… æ­£ç¡®æ ¼å¼ï¼š`DELETE /api/expense/8dbf136d-84d3-4b72-84bf-d7eb78c2dca0` (è·¯å¾„å‚æ•°)

### ğŸ› ï¸ ä¿®å¤æªæ–½

#### 1. æ·»åŠ å…¼å®¹æ€§æ£€æŸ¥è·¯ç”±
åœ¨`src/routes/expense.js`ä¸­æ·»åŠ ï¼š
```javascript
// å…¼å®¹æ€§è·¯ç”± - å¤„ç†é”™è¯¯çš„æŸ¥è¯¢å‚æ•°æ ¼å¼
router.all('/', (req, res, next) => {
  const { id } = req.query;
  
  if (id && req.method !== 'GET' && req.method !== 'POST') {
    return res.status(400).json({
      success: false,
      message: `URLæ ¼å¼é”™è¯¯`,
      error: {
        received: req.originalUrl,
        correct: `/api/expense/${id}`,
        method: req.method,
        description: `${req.method}è¯·æ±‚åº”ä½¿ç”¨è·¯å¾„å‚æ•°è€Œä¸æ˜¯æŸ¥è¯¢å‚æ•°`
      },
      help: {
        correctFormat: `${req.method} /api/expense/${id}`,
        incorrectFormat: `${req.method} /api/expense?id=${id}`,
        documentation: "/api/debug/routes"
      }
    });
  }
  
  next();
});
```

#### 2. æ›´æ–°APIæ–‡æ¡£
åœ¨`docs/API.md`ä¸­æ·»åŠ ï¼š
- **ğŸ”— URLæ ¼å¼è§„èŒƒ**ç« èŠ‚
- âœ… æ­£ç¡®çš„URLæ ¼å¼ç¤ºä¾‹
- âŒ é”™è¯¯çš„URLæ ¼å¼ç¤ºä¾‹  
- ğŸ“± iOSå®¢æˆ·ç«¯URLæ„å»ºç¤ºä¾‹
- ğŸ”§ URLæ ¼å¼é”™è¯¯å“åº”ç¤ºä¾‹

#### 3. å¼ºåŒ–é”™è¯¯æç¤º
ä¸ºæ‰€æœ‰å¸¦IDå‚æ•°çš„APIç«¯ç‚¹æ·»åŠ ï¼š
- è·¯å¾„å‚æ•°æ ¼å¼è¯´æ˜ï¼ˆUUIDæ ¼å¼ï¼‰
- URLæ ¼å¼è¦æ±‚
- iOSå®¢æˆ·ç«¯ç¤ºä¾‹ä»£ç 

### ğŸ“‹ æŠ€æœ¯ç»†èŠ‚
- **æŸ¥è¯¢å‚æ•°**: `/api/expense?id=xxx` - ç”¨äºGETè¯·æ±‚çš„è¿‡æ»¤æ¡ä»¶
- **è·¯å¾„å‚æ•°**: `/api/expense/xxx` - ç”¨äºæ ‡è¯†ç‰¹å®šèµ„æºçš„ID
- **RESTfulè§„èŒƒ**: èµ„æºIDåº”è¯¥ä½¿ç”¨è·¯å¾„å‚æ•°è€Œä¸æ˜¯æŸ¥è¯¢å‚æ•°

### ğŸš€ ç‰ˆæœ¬æ›´æ–°
- **ç‰ˆæœ¬å·**ï¼š1.0.8 â†’ 1.0.9
- **æäº¤ä¿¡æ¯**ï¼šä¿®å¤URLæ ¼å¼é”™è¯¯ï¼Œæ·»åŠ å…¼å®¹æ€§æ£€æŸ¥
- **éƒ¨ç½²çŠ¶æ€**ï¼šæ¨é€åˆ°GitHubï¼Œç­‰å¾…Vercelè‡ªåŠ¨éƒ¨ç½²

### âœ… é¢„æœŸæ•ˆæœ
1. **é”™è¯¯çš„URLæ ¼å¼**ä¼šè¿”å›è¯¦ç»†çš„é”™è¯¯æç¤ºå’Œä¿®å¤å»ºè®®
2. **APIæ–‡æ¡£**æ˜ç¡®è¯´æ˜æ­£ç¡®çš„URLæ ¼å¼
3. **iOSå¼€å‘è€…**å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç ä¿®å¤å®¢æˆ·ç«¯é—®é¢˜

### ğŸ“ iOSå®¢æˆ·ç«¯ä¿®å¤å»ºè®®
```swift
// âœ… æ­£ç¡®çš„URLæ„å»º
let baseURL = "https://your-api-domain.com"
let expenseId = "8dbf136d-84d3-4b72-84bf-d7eb78c2dca0"
let url = "\(baseURL)/api/expense/\(expenseId)"  // ä½¿ç”¨è·¯å¾„å‚æ•°

// âŒ é”™è¯¯çš„URLæ„å»ºï¼ˆéœ€è¦ä¿®å¤ï¼‰
let url = "\(baseURL)/api/expense?id=\(expenseId)"  // ä½¿ç”¨æŸ¥è¯¢å‚æ•°
```

## 2024-06-20ï¼ˆUUIDæˆªæ–­é—®é¢˜æ·±åº¦è°ƒè¯•ï¼‰

### ğŸ› æ–°å‘ç°çš„é—®é¢˜
åœ¨ä¿®å¤URLæ ¼å¼é”™è¯¯åï¼Œå‘ç°äº†ä¸€ä¸ªæ›´æ·±å±‚çš„é—®é¢˜ï¼š
- **é”™è¯¯ä¿¡æ¯**: `invalid input syntax for type uuid: "4513089"`
- **é—®é¢˜æè¿°**: å®Œæ•´UUID `4513089a-8823-466a-bbc2-411639a86f95` è¢«æˆªæ–­ä¸º `"4513089"`
- **é”™è¯¯ä½ç½®**: `src/models/Expense.js:145:23` çš„ `Expense.findById` æ–¹æ³•

### ğŸ” é—®é¢˜åˆ†æ
**å‰ç«¯çŠ¶æ€ âœ…**ï¼š
- URLæ ¼å¼æ­£ç¡®ï¼š`DELETE /api/expense/4513089a-8823-466a-bbc2-411639a86f95`
- UUIDå®Œæ•´ä¼ é€’åˆ°åç«¯
- è·¯ç”±å’Œæ§åˆ¶å™¨å±‚æ­£å¸¸æ¥æ”¶

**åç«¯é—®é¢˜ âŒ**ï¼š
- æ•°æ®åº“æŸ¥è¯¢æ—¶UUIDè¢«æˆªæ–­ä¸ºå‰7ä¸ªå­—ç¬¦
- é”™è¯¯å‘ç”Ÿåœ¨SupabaseæŸ¥è¯¢å±‚
- å¯èƒ½çš„åŸå› ï¼šSQLå‚æ•°ç»‘å®šé—®é¢˜æˆ–å­—ç¬¦ä¸²å¤„ç†é”™è¯¯

### ğŸ› ï¸ è°ƒè¯•æªæ–½

#### 1. æ·»åŠ è¯¦ç»†è°ƒè¯•ä¿¡æ¯
åœ¨ `src/models/Expense.js` ä¸­æ·»åŠ ï¼š

**findByIdæ–¹æ³•å¢å¼º**ï¼š
```javascript
static async findById(expenseId) {
    try {
        console.log('ğŸ” Expense.findById è°ƒç”¨å¼€å§‹:', {
            expenseId,
            type: typeof expenseId,
            length: expenseId ? expenseId.length : 'undefined',
            isString: typeof expenseId === 'string',
            originalValue: expenseId
        });
        
        // éªŒè¯UUIDæ ¼å¼
        if (!expenseId || typeof expenseId !== 'string') {
            throw new Error(`æ— æ•ˆçš„æ”¯å‡ºIDæ ¼å¼: ${expenseId}`);
        }
        
        if (expenseId.length !== 36) {
            throw new Error(`æ— æ•ˆçš„UUIDé•¿åº¦: æœŸæœ›36ä¸ªå­—ç¬¦ï¼Œå®é™…${expenseId.length}ä¸ªå­—ç¬¦`);
        }
        
        console.log('ğŸ” å‡†å¤‡æ‰§è¡ŒSupabaseæŸ¥è¯¢ï¼ŒUUID:', {
            expenseId,
            length: expenseId.length,
            beforeQuery: true
        });
        
        // SupabaseæŸ¥è¯¢...
        
        console.log('ğŸ” SupabaseæŸ¥è¯¢å®Œæˆ:', {
            hasData: !!data,
            hasError: !!error,
            errorCode: error?.code,
            errorMessage: error?.message,
            expenseIdUsed: expenseId
        });
    }
}
```

**deleteByIdæ–¹æ³•å¢å¼º**ï¼š
```javascript
static async deleteById(expenseId) {
    console.log('ğŸ—‘ï¸ Expense.deleteById è°ƒç”¨å¼€å§‹:', {
        expenseId,
        type: typeof expenseId,
        length: expenseId ? expenseId.length : 'undefined',
        isString: typeof expenseId === 'string'
    });
    
    // UUIDæ ¼å¼éªŒè¯
    if (!expenseId || typeof expenseId !== 'string' || expenseId.length !== 36) {
        throw new Error(`æ— æ•ˆçš„æ”¯å‡ºIDæ ¼å¼: ${expenseId}`);
    }
    
    // è¯¦ç»†çš„SupabaseæŸ¥è¯¢æ—¥å¿—...
}
```

#### 2. é”™è¯¯æ•è·æ”¹è¿›
- æ·»åŠ å®Œæ•´çš„é”™è¯¯å †æ ˆè·Ÿè¸ª
- è®°å½•SupabaseæŸ¥è¯¢å‰åçš„UUIDçŠ¶æ€
- éªŒè¯UUIDæ ¼å¼å’Œé•¿åº¦

#### 3. ç‰ˆæœ¬æ›´æ–°
- **ç‰ˆæœ¬å·**: v1.0.9 â†’ v1.0.10
- **ç›®æ ‡**: é€šè¿‡è¯¦ç»†æ—¥å¿—å®šä½UUIDæˆªæ–­çš„ç¡®åˆ‡ä½ç½®
- **éƒ¨ç½²**: æ¨é€åˆ°GitHubç­‰å¾…Vercelè‡ªåŠ¨éƒ¨ç½²

### ğŸ¯ é¢„æœŸç»“æœ
é€šè¿‡æ–°çš„è°ƒè¯•ä¿¡æ¯ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°ï¼š
1. **UUIDåœ¨ä½•æ—¶è¢«æˆªæ–­**ï¼ˆæ§åˆ¶å™¨å±‚ vs æ¨¡å‹å±‚ vs Supabaseå±‚ï¼‰
2. **æˆªæ–­çš„ç¡®åˆ‡ä½ç½®**å’ŒåŸå› 
3. **æ˜¯å¦å­˜åœ¨éšè—çš„å­—ç¬¦ä¸²å¤„ç†é—®é¢˜**

### ğŸ“‹ ä¸‹ä¸€æ­¥è®¡åˆ’
1. **ç­‰å¾…ç”¨æˆ·æµ‹è¯•**æ–°çš„è°ƒè¯•ç‰ˆæœ¬
2. **åˆ†æè¯¦ç»†æ—¥å¿—**ç¡®å®šUUIDæˆªæ–­çš„æ ¹æœ¬åŸå› 
3. **å®æ–½é’ˆå¯¹æ€§ä¿®å¤**
4. **éªŒè¯ä¿®å¤æ•ˆæœ**

### ğŸš¨ æ³¨æ„äº‹é¡¹
- è¿™æ˜¯ä¸€ä¸ªæ·±å±‚çš„æ•°æ®åº“æŸ¥è¯¢é—®é¢˜ï¼Œä¸æ˜¯ç®€å•çš„URLæ ¼å¼é—®é¢˜
- å¯èƒ½æ¶‰åŠSupabaseå®¢æˆ·ç«¯çš„UUIDå¤„ç†æœºåˆ¶
- éœ€è¦é€šè¿‡è¯¦ç»†æ—¥å¿—æ‰èƒ½å‡†ç¡®å®šä½é—®é¢˜æ‰€åœ¨

## 2023-xx-xxï¼ˆæ›´æ–°æ—¥æœŸï¼‰

### æ·»åŠ çš„æ–‡ä»¶
- åˆ›å»ºäº† `src/routes/auth.js` - å®ç°åŸºæœ¬çš„è®¤è¯è·¯ç”±ï¼ˆæ³¨å†Œã€ç™»å½•ã€è·å–ç”¨æˆ·ä¿¡æ¯ï¼‰

### ä¿®æ”¹çš„æ–‡ä»¶
- æ›´æ–°äº† `src/app.js`ï¼š
  - æ·»åŠ äº† helmet å’Œ rate-limit ä¸­é—´ä»¶ç”¨äºå®‰å…¨ä¿æŠ¤
  - é…ç½®äº† dotenv ç”¨äºç¯å¢ƒå˜é‡
  - æ·»åŠ äº†è®¤è¯è·¯ç”±å’Œå¥åº·æ£€æŸ¥
  - ç§»é™¤äº† morgan ä¸­é—´ä»¶å’ŒåŸæ¥çš„æ ¹è·¯ç”±

### é…ç½®è¯´æ˜
éœ€è¦åˆ›å»º `.env` æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹é…ç½®ï¼š
```
PORT=3000
JWT_SECRET=your_jwt_secret_key_here
NODE_ENV=development

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=expense_tracker
```

## 2023-xx-xxï¼ˆä¿®å¤æ—¥æœŸï¼‰

### é—®é¢˜ä¿®å¤
- ä¿®å¤äº†è·¯ç”±é”™è¯¯ï¼š`TypeError: Missing parameter name at 1: https://git.new/pathToRegexpError`
  - å°†404å¤„ç†ç¨‹åºä» `app.use('*', ...)` æ”¹ä¸º `app.use((req, res) => ...)`
  - ä¿®æ”¹äº† `src/routes/auth.js` ä»¥ä¸å†å¼•ç”¨ä¸å­˜åœ¨çš„æ§åˆ¶å™¨å’Œä¸­é—´ä»¶æ–‡ä»¶
  - æ·»åŠ äº† `authRoutes` çš„å¯¼å…¥å’Œä½¿ç”¨ï¼Œè·¯å¾„ä¸º `/api/auth/router`

### å…¶ä»–æ”¹è¿›
- æ›´æ–°äº†è°ƒè¯•è·¯ç”±åˆ—è¡¨ï¼Œå¢åŠ äº†æ–°çš„è·¯ç”±ä¿¡æ¯
- ä¿ç•™äº†å†…å­˜ä¸­çš„ç”¨æˆ·ç®¡ç†å’Œèº«ä»½éªŒè¯é€»è¾‘

## 2023-xx-xxï¼ˆä»£ç ä¼˜åŒ–æ—¥æœŸï¼‰

### ä»£ç ä¼˜åŒ–
- ä¸ºæ‰€æœ‰ä»£ç æ–‡ä»¶æ·»åŠ äº†è¯¦ç»†æ³¨é‡Šï¼Œä½¿ä»£ç æ›´æ˜“ç†è§£ï¼š
  - `server.js`ï¼šæ·»åŠ äº†æœåŠ¡å™¨å…¥å£æ–‡ä»¶çš„æ³¨é‡Šè¯´æ˜
  - `src/app.js`ï¼šæ·»åŠ äº†è¯¦ç»†çš„ä¸­é—´ä»¶ã€è·¯ç”±å’Œè®¤è¯é€»è¾‘æ³¨é‡Š
  - `src/routes/auth.js`ï¼šæ·»åŠ äº†è·¯ç”±æ¨¡å—çš„è¯¦ç»†æ³¨é‡Š

### ä¸»è¦æ³¨é‡Šå†…å®¹
- ä»£ç åŠŸèƒ½å’Œç›®çš„çš„è¯´æ˜
- å‡½æ•°å’Œæ–¹æ³•çš„å‚æ•°å’Œè¿”å›å€¼è¯´æ˜
- ä¸­é—´ä»¶å’Œè·¯ç”±çš„è¯¦ç»†è§£é‡Š
- å…³é”®ä»£ç æ®µçš„å·¥ä½œåŸç†
- å˜é‡å’Œå¸¸é‡çš„ç”¨é€”è¯´æ˜
- è®¤è¯æµç¨‹å’Œå®‰å…¨æªæ–½çš„è¯´æ˜

## 2023-xx-xxï¼ˆä»£ç é‡æ„æ—¥æœŸï¼‰

### ä»£ç é‡æ„
- å°†è®¤è¯é€»è¾‘ä»app.jsç§»åŠ¨åˆ°ä¸“é—¨çš„æ¨¡å—ä¸­ï¼Œå®ç°äº†æ›´å¥½çš„å…³æ³¨ç‚¹åˆ†ç¦»ï¼š
  - åˆ›å»ºäº† `src/controllers/authController.js` - åŒ…å«æ‰€æœ‰è®¤è¯ä¸šåŠ¡é€»è¾‘
  - åˆ›å»ºäº† `src/middleware/auth.js` - JWTéªŒè¯ä¸­é—´ä»¶
  - æ›´æ–°äº† `src/routes/auth.js` - ä½¿ç”¨æ–°çš„æ§åˆ¶å™¨å’Œä¸­é—´ä»¶
  - æ¸…ç†äº† `src/app.js` - ç§»é™¤äº†é‡å¤çš„è®¤è¯é€»è¾‘ï¼Œåªä¿ç•™è·¯ç”±æ³¨å†Œ

### è·¯ç”±å˜æ›´
- ä¿®æ”¹äº†APIè·¯ç”±ç»“æ„ï¼Œç»Ÿä¸€ä½¿ç”¨ `/api/auth/` è·¯å¾„:
  - `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
  - `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
  - `GET /api/auth/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼ˆéœ€è¦è®¤è¯ï¼‰
  - `GET /api/auth/debug/users` - è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆè°ƒè¯•ç”¨ï¼‰

### æ¶æ„æ”¹è¿›
- å®ç°äº†MVCæ¶æ„æ¨¡å¼ï¼š
  - æ¨¡å‹(Model): å†…å­˜ä¸­çš„ç”¨æˆ·å­˜å‚¨ï¼ˆæœªæ¥å¯æ›¿æ¢ä¸ºæ•°æ®åº“æ¨¡å‹ï¼‰
  - è§†å›¾(View): APIå“åº”æ ¼å¼
  - æ§åˆ¶å™¨(Controller): authController.jsä¸­çš„å¤„ç†å‡½æ•°
- æé«˜äº†ä»£ç å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§

## 2023-xx-xxï¼ˆæ–‡æ¡£æ›´æ–°æ—¥æœŸï¼‰

### æ–‡æ¡£æ›´æ–°
- åˆ›å»ºäº† `README.md` æ–‡ä»¶ï¼Œè¯¦ç»†è¯´æ˜é¡¹ç›®å†…å®¹ï¼š
  - é¡¹ç›®ç®€ä»‹å’Œç‰¹ç‚¹
  - æŠ€æœ¯æ ˆè¯´æ˜
  - ç›®å½•ç»“æ„
  - å®‰è£…å’Œä½¿ç”¨æŒ‡å—
  - è¯¦ç»†çš„APIæ–‡æ¡£
  - å®‰å…¨ç‰¹æ€§è¯´æ˜
  - å¼€å‘ä¸éƒ¨ç½²æŒ‡å—
  - æœªæ¥è§„åˆ’

### åŠŸèƒ½å±•ç¤º
- åœ¨READMEä¸­å±•ç¤ºäº†å®Œæ•´çš„APIç«¯ç‚¹åˆ—è¡¨å’Œä½¿ç”¨ç¤ºä¾‹
- æä¾›äº†è¯·æ±‚/å“åº”ç¤ºä¾‹ï¼Œæ–¹ä¾¿å‰ç«¯å¼€å‘å¯¹æ¥

## 2023-xx-xxï¼ˆBugä¿®å¤æ—¥æœŸï¼‰

### é—®é¢˜åˆ†æ
- é‡åˆ°å¯åŠ¨é”™è¯¯ï¼š`Error: Cannot find module 'mongoose'`
- é”™è¯¯åŸå› ï¼š`src/models/Expense.js` æ–‡ä»¶ä½¿ç”¨äº†mongooseï¼Œä½†é¡¹ç›®ä¸­æ²¡æœ‰å®‰è£…mongooseä¾èµ–
- é”™è¯¯å †æ ˆæ˜¾ç¤ºé—®é¢˜ä»Expense.jså¼€å§‹ï¼Œå½±å“åˆ°budgetController.jsã€routes/budget.jsç­‰æ–‡ä»¶

### é—®é¢˜ä¿®å¤
- ä¿®æ”¹äº† `src/models/Expense.js`ï¼š
  - ç§»é™¤äº†mongooseä¾èµ–
  - æ”¹ä¸ºå†…å­˜å­˜å‚¨æ¨¡å¼ï¼Œä¸å…¶ä»–æ¨¡å‹ï¼ˆBudget.js, User.jsï¼‰ä¿æŒä¸€è‡´
  - é‡æ–°å®ç°äº†æ‰€æœ‰Expenseç›¸å…³çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
    - æ”¯å‡ºè®°å½•çš„å¢åˆ æ”¹æŸ¥
    - æ•°æ®éªŒè¯åŠŸèƒ½
    - ç»Ÿè®¡åŠŸèƒ½ï¼ˆæŒ‰åˆ†ç±»ç»Ÿè®¡ã€æ€»æ”¯å‡ºç»Ÿè®¡ï¼‰
    - æ ¼å¼åŒ–åŠŸèƒ½
  - æ·»åŠ äº†ç¼ºå¤±çš„æ–¹æ³•ï¼š
    - `getCurrentMonthTotal()` - è·å–å½“å‰æœˆä»½æ€»æ”¯å‡º
    - `getMonthlyTotal()` - è·å–æŒ‡å®šæœˆä»½æ€»æ”¯å‡º

### æ¶æ„ä¸€è‡´æ€§
- ç¡®ä¿äº†æ‰€æœ‰æ¨¡å‹æ–‡ä»¶éƒ½ä½¿ç”¨ç›¸åŒçš„å†…å­˜å­˜å‚¨æ–¹å¼
- ä¿æŒäº†æ•°æ®æ¨¡å‹çš„ä¸€è‡´æ€§ï¼Œä¾¿äºåæœŸè¿ç§»åˆ°çœŸå®æ•°æ®åº“
- éªŒè¯äº†æ‰€æœ‰æ§åˆ¶å™¨å’Œè·¯ç”±èƒ½æ­£ç¡®é…åˆæ›´æ–°åçš„æ¨¡å‹å·¥ä½œ

### æµ‹è¯•ç»“æœ
- æœåŠ¡å™¨ç°åœ¨å¯ä»¥æ­£å¸¸å¯åŠ¨å’Œè¿è¡Œ
- å¥åº·æ£€æŸ¥æ¥å£ `/health` æ­£å¸¸å“åº”
- æ‰€æœ‰APIç«¯ç‚¹éƒ½åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œ

## 2025-06-20ï¼ˆåˆ é™¤åŠŸèƒ½ä¿®å¤æ—¥æœŸï¼‰

### é—®é¢˜å‘ç°
ç”¨æˆ·æŠ¥å‘Šåˆ é™¤æ”¯å‡ºè®°å½•åï¼Œè®°å½•åœ¨ç­›é€‰æ—¶åˆé‡æ–°å‡ºç°ï¼Œè¡¨æ˜åˆ é™¤åŠŸèƒ½å­˜åœ¨é—®é¢˜ã€‚

### æ ¹æœ¬åŸå› åˆ†æ
é€šè¿‡è¯¦ç»†è°ƒè¯•å‘ç°äº†å…³é”®é—®é¢˜ï¼š
- **IDç±»å‹å¤„ç†é”™è¯¯**ï¼šä»£ç ä¸­ä½¿ç”¨`parseInt(id)`å¤„ç†UUIDæ ¼å¼çš„ID
- **UUIDä¸èƒ½parseInt**ï¼š`parseInt("4f5a58b9-02eb-4781-9b07-a13ef16bdc8c")`è¿”å›`NaN`
- **æ•°æ®åº“æŸ¥è¯¢å¤±è´¥**ï¼šæŸ¥è¯¢æ¡ä»¶å˜æˆ`id = NaN`ï¼Œå¯¼è‡´æ‰¾ä¸åˆ°ä»»ä½•è®°å½•
- **å‡è±¡æˆåŠŸ**ï¼šSupabaseåˆ é™¤ä¸å­˜åœ¨çš„è®°å½•ä¸æŠ¥é”™ï¼Œè¿”å›"æˆåŠŸ"ä½†å®é™…æ²¡åˆ é™¤

### è°ƒè¯•è¿‡ç¨‹
1. **é”™è¯¯ç—‡çŠ¶**ï¼š
   - åˆ é™¤APIè¿”å›æˆåŠŸï¼Œä½†è®°å½•æœªå®é™…åˆ é™¤
   - é”™è¯¯ä¿¡æ¯ï¼š"invalid input syntax for type uuid: \"4\""
   - IDè¢«æˆªæ–­ä¸ºå•ä¸ªå­—ç¬¦

2. **è°ƒè¯•æ–¹æ³•**ï¼š
   - åˆ›å»ºæµ‹è¯•è·¯ç”±éªŒè¯Expresså‚æ•°è§£æï¼ˆæ­£å¸¸ï¼‰
   - åˆ›å»ºè°ƒè¯•è·¯ç”±æ¯”è¾ƒç›´æ¥æ•°æ®åº“æŸ¥è¯¢å’Œæ¨¡å‹æŸ¥è¯¢
   - å‘ç°Expense.findByIdæ–¹æ³•æœ¬èº«æ­£å¸¸ï¼Œé—®é¢˜åœ¨æ§åˆ¶å™¨ä¸­çš„parseIntè°ƒç”¨

3. **é—®é¢˜å®šä½**ï¼š
   - `expenseController.js`ä¸­çš„`getExpenseById`ã€`updateExpense`ã€`deleteExpense`æ–¹æ³•
   - æ‰€æœ‰æ–¹æ³•éƒ½ä½¿ç”¨`parseInt(id)`å¤„ç†UUIDï¼Œå¯¼è‡´æŸ¥è¯¢å¤±è´¥

### ä¿®å¤å†…å®¹
ä¿®æ”¹äº†`src/controllers/expenseController.js`ï¼š
- `getExpenseById`ï¼šç§»é™¤`parseInt(id)`ï¼Œç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²ID
- `updateExpense`ï¼šç§»é™¤`Expense.updateById(parseInt(id), ...)`ä¸­çš„parseInt
- `deleteExpense`ï¼šç§»é™¤ä¸¤å¤„`parseInt(id)`è°ƒç”¨

### ä¿®å¤éªŒè¯
- âœ… GETæ”¯å‡ºè¯¦æƒ…ï¼šæ­£å¸¸è¿”å›å®Œæ•´æ•°æ®
- âœ… DELETEæ”¯å‡ºè®°å½•ï¼šæˆåŠŸåˆ é™¤ï¼Œè¿”å›æˆåŠŸæ¶ˆæ¯
- âœ… æ•°æ®ä¸€è‡´æ€§ï¼šåˆ é™¤åè®°å½•çœŸæ­£æ¶ˆå¤±ï¼Œå†æ¬¡æŸ¥è¯¢è¿”å›404
- âœ… æ”¯å‡ºåˆ—è¡¨ï¼šåˆ é™¤åè®°å½•æ•°é‡æ­£ç¡®å‡å°‘

### æ¸…ç†å·¥ä½œ
- ç§»é™¤äº†ä¸´æ—¶è°ƒè¯•ä»£ç å’Œè·¯ç”±
- æ¢å¤äº†æ­£å¸¸çš„æ—¥å¿—è¾“å‡ºçº§åˆ«
- ä¿æŒäº†ä»£ç çš„æ•´æ´æ€§

### æœ€ç»ˆçŠ¶æ€
åç«¯APIå®Œå…¨æ­£å¸¸ï¼Œæ‰€æœ‰CRUDæ“ä½œåŒ…æ‹¬åˆ é™¤åŠŸèƒ½éƒ½å·¥ä½œæ­£å¸¸ã€‚iOSå‰ç«¯åº”è¯¥èƒ½æ­£å¸¸ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½ï¼Œåˆ é™¤åè®°å½•ä¸ä¼šé‡æ–°å‡ºç°çš„é—®é¢˜å·²å½»åº•è§£å†³ã€‚

## 2023-xx-xxï¼ˆç”¨æˆ·è®¤è¯Bugä¿®å¤æ—¥æœŸï¼‰

### é—®é¢˜åˆ†æ
- ç”¨æˆ·åé¦ˆç™»å½•åå‡ºç°"è§£æé”™è¯¯"
- ç»è¿‡è°ƒè¯•å‘ç°ç”¨æˆ·æ•°æ®å­˜å‚¨ç³»ç»Ÿå­˜åœ¨å†²çªï¼š
  - `src/models/User.js` ä¸­å®šä¹‰äº†ä¸€ä¸ª `users` æ•°ç»„
  - `src/controllers/authController.js` ä¸­åˆå®šä¹‰äº†å¦ä¸€ä¸ª `users` æ•°ç»„
- å¯¼è‡´æ³¨å†Œå’Œç™»å½•ä½¿ç”¨ä¸åŒçš„å­˜å‚¨ç³»ç»Ÿï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´

### é—®é¢˜ä¿®å¤
- ä¿®æ”¹äº† `src/controllers/authController.js`ï¼š
  - ç§»é™¤äº†æ§åˆ¶å™¨å†…éƒ¨çš„ `users` æ•°ç»„å’Œ `currentId` å˜é‡
  - å¯¼å…¥å¹¶ä½¿ç”¨ `User` æ¨¡å‹è¿›è¡Œæ‰€æœ‰ç”¨æˆ·æ“ä½œ
  - æ›´æ–°äº†æ‰€æœ‰è®¤è¯ç›¸å…³å‡½æ•°ä½¿ç”¨ç»Ÿä¸€çš„Useræ¨¡å‹API
  - æ·»åŠ äº†æ›´è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- ä¿®æ”¹äº† `src/models/User.js`ï¼š
  - æ·»åŠ äº† `getAllUsers()` é™æ€æ–¹æ³•ç”¨äºè°ƒè¯•

### æ¶æ„æ”¹è¿›
- ç»Ÿä¸€äº†ç”¨æˆ·æ•°æ®å­˜å‚¨ï¼Œç¡®ä¿æ‰€æœ‰æ“ä½œä½¿ç”¨åŒä¸€ä¸ªUseræ¨¡å‹
- æ¶ˆé™¤äº†æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜
- æé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œä¸€è‡´æ€§

### æµ‹è¯•ç»“æœ
- âœ… ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… ç”¨æˆ·ç™»å½•åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œè¿”å›æ­£ç¡®çš„JSONæ ¼å¼
- âœ… JWT tokenè®¤è¯åŠŸèƒ½æ­£å¸¸
- âœ… è·å–ç”¨æˆ·ä¿¡æ¯APIæ­£å¸¸å“åº”
- âœ… æ‰€æœ‰APIéƒ½èƒ½æ­£ç¡®è¿”å›ç¬¦åˆè§„èŒƒçš„JSONæ•°æ®

## 2023-xx-xxï¼ˆé¦–é¡µæ•°æ®è§£æé”™è¯¯ä¿®å¤æ—¥æœŸï¼‰

### é—®é¢˜åˆ†æ
- ç”¨æˆ·åé¦ˆç™»å½•åè¿›å…¥é¦–é¡µå‡ºç°"æ•°æ®è§£æå¤±è´¥"å¼¹çª—é”™è¯¯
- ç»è¿‡ç³»ç»Ÿæ’æŸ¥å‘ç°æ”¯å‡ºè®°å½•API `/api/expense` è¿”å›500é”™è¯¯
- é”™è¯¯ä¿¡æ¯ï¼š`"Cannot read properties of undefined (reading 'id')"`

### é—®é¢˜æ ¹æœ¬åŸå› 
- **è®¤è¯å­—æ®µä¸åŒ¹é…**ï¼š
  - authä¸­é—´ä»¶è®¾ç½® `req.userId`
  - expenseControllerä½¿ç”¨ `req.user.id` âŒ
- **æ¨¡å‹APIä¸ä¸€è‡´**ï¼š
  - expenseControllerä½¿ç”¨mongooseé£æ ¼çš„API (å¦‚ `Expense.find()`)
  - ä½†Expenseæ¨¡å‹å®é™…æ˜¯å†…å­˜å­˜å‚¨ç‰ˆæœ¬

### é—®é¢˜ä¿®å¤
- ä¿®æ”¹äº† `src/controllers/expenseController.js`ï¼š
  - å°†æ‰€æœ‰ `req.user.id` æ”¹ä¸º `req.userId`
  - å°†mongooseé£æ ¼çš„APIè°ƒç”¨æ”¹ä¸ºå†…å­˜å­˜å‚¨æ¨¡å‹çš„APIï¼š
    - `new Expense().save()` â†’ `Expense.create()`
    - `Expense.find()` â†’ `Expense.findByUserId()`
    - `Expense.findOne()` â†’ `Expense.findById()`
    - `Expense.findOneAndUpdate()` â†’ `Expense.updateById()`
    - `Expense.findOneAndDelete()` â†’ `Expense.deleteById()`
    - `Expense.aggregate()` â†’ `Expense.getStatsByCategory()` å’Œ `Expense.getTotalByUser()`

### æ’æŸ¥æ–¹æ³•è®º
æä¾›äº†ç³»ç»Ÿæ€§çš„APIé”™è¯¯æ’æŸ¥æµç¨‹ï¼š
1. **ç¡®å®šé—®é¢˜æ€§è´¨** - å‰ç«¯è¿˜æ˜¯åç«¯é—®é¢˜
2. **æµ‹è¯•å…³é”®APIç«¯ç‚¹** - é€ä¸ªæµ‹è¯•é¦–é¡µå¯èƒ½è°ƒç”¨çš„API
3. **æŸ¥çœ‹é”™è¯¯å“åº”** - åˆ†æå…·ä½“çš„é”™è¯¯ä¿¡æ¯
4. **æ£€æŸ¥è®¤è¯æœºåˆ¶** - éªŒè¯JWT tokenå’Œç”¨æˆ·è®¤è¯æµç¨‹
5. **ä¿®å¤ä»£ç ä¸ä¸€è‡´é—®é¢˜** - ç»Ÿä¸€ä½¿ç”¨ç›¸åŒçš„æ•°æ®æ¨¡å‹API

### æµ‹è¯•ç»“æœ
- âœ… æ”¯å‡ºè®°å½•API `/api/expense` ç°åœ¨è¿”å›200çŠ¶æ€ç 
- âœ… æ”¯å‡ºç»Ÿè®¡API `/api/expense/stats` æ­£å¸¸å·¥ä½œ
- âœ… é¢„ç®—çŠ¶æ€API `/api/budget/current` æ­£å¸¸å·¥ä½œ
- âœ… ç”¨æˆ·ä¿¡æ¯API `/api/auth/me` æ­£å¸¸å·¥ä½œ
- âœ… æ‰€æœ‰APIéƒ½è¿”å›æ ‡å‡†çš„JSONæ ¼å¼ï¼Œå‰ç«¯åº”è¯¥èƒ½æ­£ç¡®è§£æ

### å‰ç«¯å¯¹æ¥å»ºè®®
ç¡®ä¿å‰ç«¯æ­£ç¡®å¤„ç†ä»¥ä¸‹APIå“åº”æ ¼å¼ï¼š
```json
{
  "success": true,
  "data": {
    "expenses": [],
    "pagination": {...}
  }
}
```

## 2023-xx-xxï¼ˆç™»å½•é¡µé¢è·³è½¬é—®é¢˜æ’æŸ¥æ—¥æœŸï¼‰

### é—®é¢˜æè¿°
- ç”¨æˆ·åœ¨ç™»å½•é¡µé¢è¾“å…¥é‚®ç®±å¯†ç å
- åç«¯æœåŠ¡æ˜¾ç¤º"ç”¨æˆ·ç™»å½•æˆåŠŸ"
- ä½†å‰ç«¯é¡µé¢ä»åœç•™åœ¨ç™»å½•é¡µé¢ï¼Œæ²¡æœ‰è·³è½¬

### æ’æŸ¥è¿‡ç¨‹

#### 1. åç«¯APIæµ‹è¯•
- âœ… **HTTPçŠ¶æ€ç **: 200 OK (æˆåŠŸç™»å½•)ï¼Œ401 Unauthorized (å¤±è´¥ç™»å½•)
- âœ… **å“åº”æ ¼å¼**: æ ‡å‡†JSONæ ¼å¼ï¼ŒjqéªŒè¯é€šè¿‡
- âœ… **CORSé…ç½®**: `Access-Control-Allow-Origin: *` æ­£ç¡®è®¾ç½®
- âœ… **é¢„æ£€è¯·æ±‚**: OPTIONSè¯·æ±‚è¿”å›æ­£ç¡®çš„CORSå¤´
- âœ… **å®Œæ•´æµç¨‹**: ç™»å½• â†’ æå–token â†’ ä½¿ç”¨token å…¨æµç¨‹æ­£å¸¸

#### 2. å“åº”æ ¼å¼éªŒè¯
**æˆåŠŸç™»å½•å“åº”**:
```json
{
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "user": {
      "id": 1,
      "email": "test3@example.com",
      "wechatOpenId": null,
      "createdAt": "2025-06-11T03:04:34.801Z",
      "updatedAt": "2025-06-11T03:04:34.801Z"
    },
    "token": "eyJhbGciOiJIUzI1NiIs..."
  }
}
```

**å¤±è´¥ç™»å½•å“åº”**:
```json
{
  "success": false,
  "message": "é‚®ç®±æˆ–å¯†ç é”™è¯¯"
}
```

### é—®é¢˜ç¡®è®¤
**è¿™æ˜¯å‰ç«¯é—®é¢˜ï¼Œåç«¯APIå®Œå…¨æ­£å¸¸ï¼**

### å¯èƒ½çš„å‰ç«¯é—®é¢˜åŸå› 

#### 1. JavaScripté”™è¯¯å¤„ç†
```javascript
// å¯èƒ½çš„é—®é¢˜ä»£ç 
fetch('/api/auth/login', options)
  .then(response => response.json())
  .then(data => {
    // å¯èƒ½æ²¡æœ‰æ­£ç¡®æ£€æŸ¥ data.success
    if (data.token) { // âŒ é”™è¯¯ï¼šåº”è¯¥æ£€æŸ¥ data.data.token
      // è·³è½¬é€»è¾‘
    }
  })

// æ­£ç¡®çš„å¤„ç†æ–¹å¼
fetch('/api/auth/login', options)
  .then(response => response.json())
  .then(data => {
    if (data.success && data.data.token) { // âœ… æ­£ç¡®
      // ä¿å­˜token
      localStorage.setItem('token', data.data.token);
      // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
      localStorage.setItem('user', JSON.stringify(data.data.user));
      // è·³è½¬åˆ°é¦–é¡µ
      window.location.href = '/dashboard';
    }
  })
```

#### 2. å¼‚æ­¥å¤„ç†é—®é¢˜
```javascript
// å¯èƒ½çš„é—®é¢˜ï¼šæ²¡æœ‰æ­£ç¡®å¤„ç†Promise
async function login() {
  try {
    const response = await fetch('/api/auth/login', options);
    const data = await response.json();
    
    if (data.success) {
      // è·³è½¬é€»è¾‘å¯èƒ½åœ¨è¿™é‡Œå‡ºé”™
      router.push('/dashboard'); // ç¡®ä¿è·¯ç”±é…ç½®æ­£ç¡®
    }
  } catch (error) {
    console.error('ç™»å½•é”™è¯¯:', error); // æ£€æŸ¥æ˜¯å¦æœ‰JSé”™è¯¯
  }
}
```

#### 3. è¡¨å•æäº¤é—®é¢˜
```javascript
// æ£€æŸ¥è¡¨å•æ˜¯å¦é˜»æ­¢äº†é»˜è®¤æäº¤è¡Œä¸º
<form onSubmit={handleLogin}>
  {/* ç¡®ä¿ handleLogin ä¸­æœ‰ event.preventDefault() */}
</form>
```

### å‰ç«¯æ’æŸ¥å»ºè®®

#### 1. æ£€æŸ¥æµè§ˆå™¨å¼€å‘å·¥å…·
- **Networkæ ‡ç­¾**: æŸ¥çœ‹ç™»å½•è¯·æ±‚çš„çŠ¶æ€ç å’Œå“åº”
- **Consoleæ ‡ç­¾**: æŸ¥çœ‹æ˜¯å¦æœ‰JavaScripté”™è¯¯
- **Applicationæ ‡ç­¾**: æ£€æŸ¥localStorage/sessionStorageä¸­æ˜¯å¦ä¿å­˜äº†token

#### 2. æ·»åŠ è°ƒè¯•æ—¥å¿—
```javascript
fetch('/api/auth/login', options)
  .then(response => {
    console.log('å“åº”çŠ¶æ€:', response.status);
    return response.json();
  })
  .then(data => {
    console.log('å“åº”æ•°æ®:', data);
    if (data.success) {
      console.log('ç™»å½•æˆåŠŸï¼Œå‡†å¤‡è·³è½¬');
      // è·³è½¬é€»è¾‘
    } else {
      console.log('ç™»å½•å¤±è´¥:', data.message);
    }
  })
  .catch(error => {
    console.error('è¯·æ±‚å¤±è´¥:', error);
  });
```

#### 3. æ£€æŸ¥è·¯ç”±é…ç½®
- ç¡®ä¿ç›®æ ‡è·¯ç”±å­˜åœ¨ä¸”é…ç½®æ­£ç¡®
- æ£€æŸ¥è·¯ç”±å®ˆå«æ˜¯å¦é˜»æ­¢äº†è·³è½¬
- éªŒè¯ç™»å½•åçš„é‡å®šå‘é€»è¾‘

### åç«¯ç›‘æ§å»ºè®®
å¯ä»¥åœ¨åç«¯æ·»åŠ æ›´è¯¦ç»†çš„æ—¥å¿—æ¥å¸®åŠ©æ’æŸ¥ï¼š
```javascript
// åœ¨ç™»å½•æˆåŠŸåæ·»åŠ 
console.log('âœ… ç”¨æˆ·ç™»å½•æˆåŠŸ - å‡†å¤‡è¿”å›å“åº”:', {
  userId: user.id,
  email: user.email,
  tokenLength: token.length,
  responseTime: new Date().toISOString()
});
```

## 2024-01-15ï¼ˆAPIæ–‡æ¡£ç”Ÿæˆæ—¥æœŸï¼‰

### å®Œæˆé¡¹ç›®
âœ… **åˆ›å»ºå®Œæ•´çš„åç«¯APIæ–‡æ¡£**
- æ–‡æ¡£ä½ç½®ï¼š`docs/API.md`
- æ–‡æ¡£æ ¼å¼ï¼šMarkdownæ ¼å¼ï¼Œä¾¿äºå‰ç«¯å¼€å‘äººå‘˜ä½¿ç”¨

### æ–‡æ¡£å†…å®¹
å®Œæ•´è¦†ç›–äº†æ‰€æœ‰åç«¯APIæ¥å£ï¼š

#### 1. åŸºæœ¬ä¿¡æ¯
- åŸºç¡€URLã€å†…å®¹ç±»å‹ã€è®¤è¯æ–¹å¼
- ç»Ÿä¸€çš„å“åº”æ ¼å¼è§„èŒƒ
- JWTè®¤è¯è¯´æ˜ï¼ˆ7å¤©æœ‰æ•ˆæœŸï¼‰

#### 2. å…¬å…±æ¥å£
- `GET /health` - æœåŠ¡å™¨å¥åº·æ£€æŸ¥
- `GET /api/debug/routes` - è·å–å¯ç”¨è·¯ç”±åˆ—è¡¨

#### 3. è®¤è¯ç›¸å…³API
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `GET /api/auth/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- `GET /api/auth/debug/users` - è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆè°ƒè¯•ç”¨ï¼‰

#### 4. é¢„ç®—ç®¡ç†API
- `POST /api/budget` - è®¾ç½®æœˆåº¦é¢„ç®—
- `GET /api/budget/current` - è·å–å½“å‰é¢„ç®—çŠ¶æ€

#### 5. æ”¯å‡ºè®°å½•API
- `POST /api/expense` - åˆ›å»ºæ”¯å‡ºè®°å½•
- `GET /api/expense` - è·å–æ”¯å‡ºåˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µå’Œç­›é€‰ï¼‰
- `GET /api/expense/:id` - è·å–å•ä¸ªæ”¯å‡ºè®°å½•
- `PUT /api/expense/:id` - æ›´æ–°æ”¯å‡ºè®°å½•
- `DELETE /api/expense/:id` - åˆ é™¤æ”¯å‡ºè®°å½•
- `GET /api/expense/stats` - è·å–æ”¯å‡ºç»Ÿè®¡

#### 6. è¯¦ç»†æ–‡æ¡£ç‰¹æ€§
- **å®Œæ•´ç¤ºä¾‹**ï¼šæ¯ä¸ªAPIéƒ½åŒ…å«è¯·æ±‚å’Œå“åº”ç¤ºä¾‹
- **å‚æ•°è¯´æ˜**ï¼šè¯¦ç»†è¯´æ˜æ‰€æœ‰è¯·æ±‚å‚æ•°ã€æŸ¥è¯¢å‚æ•°
- **é”™è¯¯å¤„ç†**ï¼šåˆ—å‡ºå¯èƒ½çš„é”™è¯¯å“åº”å’ŒHTTPçŠ¶æ€ç 
- **æ•°æ®æ¨¡å‹**ï¼šå®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
- **å¼€å‘è°ƒè¯•**ï¼šæä¾›curlå‘½ä»¤å¿«é€Ÿæµ‹è¯•æ‰€æœ‰ç«¯ç‚¹
- **é™æµè¯´æ˜**ï¼šAPIé™æµç­–ç•¥ï¼ˆ15åˆ†é’Ÿ100æ¬¡è¯·æ±‚ï¼‰

#### 7. æŠ€æœ¯è§„èŒƒ
- **è®¤è¯æ–¹å¼**ï¼šBearer Token (JWT)
- **å†…å®¹ç±»å‹**ï¼šapplication/json
- **å“åº”æ ¼å¼**ï¼šç»Ÿä¸€çš„success/message/dataç»“æ„
- **é”™è¯¯ç **ï¼šæ ‡å‡†HTTPçŠ¶æ€ç  + ä¸­æ–‡é”™è¯¯æè¿°

### æ–‡æ¡£ä¼˜åŠ¿
1. **å‰ç«¯å‹å¥½**ï¼šæ‰€æœ‰ç¤ºä¾‹ä½¿ç”¨çœŸå®æ•°æ®æ ¼å¼
2. **å®Œæ•´è¦†ç›–**ï¼šåŒ…å«æ¯ä¸ªAPIçš„å®Œæ•´è¯·æ±‚/å“åº”å‘¨æœŸ
3. **å®ç”¨æ€§å¼º**ï¼šæä¾›å¯ç›´æ¥è¿è¡Œçš„curlå‘½ä»¤
4. **ç»´æŠ¤æ€§å¥½**ï¼šç»“æ„æ¸…æ™°ï¼Œæ˜“äºæ›´æ–°
5. **å›½é™…åŒ–**ï¼šä¸­æ–‡ç•Œé¢ï¼Œç¬¦åˆé¡¹ç›®éœ€æ±‚

### æ–‡æ¡£ä½ç½®
```
expense-tracker-backend/
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ API.md          # å®Œæ•´çš„APIæ–‡æ¡£
â”œâ”€â”€ src/
â”œâ”€â”€ log.md
â””â”€â”€ README.md
```

### ä½¿ç”¨å»ºè®®
å‰ç«¯å¼€å‘äººå‘˜å¯ä»¥ï¼š
1. å‚è€ƒæ–‡æ¡£äº†è§£æ‰€æœ‰å¯ç”¨API
2. ä½¿ç”¨æä¾›çš„curlå‘½ä»¤æµ‹è¯•API
3. å¤åˆ¶è¯·æ±‚/å“åº”ç¤ºä¾‹è¿›è¡Œå¼€å‘
4. æ ¹æ®æ•°æ®æ¨¡å‹å®šä¹‰TypeScriptæ¥å£
5. å‚è€ƒé”™è¯¯å¤„ç†æŒ‡å—ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

### å¼€å‘æµç¨‹æ”¹è¿›
- ğŸ¯ **æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„APIè§„èŒƒæœ‰åŠ©äºå‰åç«¯åä½œ
- ğŸ“– **æ–‡æ¡£é©±åŠ¨**ï¼šå…ˆå®šä¹‰APIæ–‡æ¡£ï¼Œå†å®ç°åŠŸèƒ½
- ğŸ”„ **æŒç»­æ›´æ–°**ï¼šAPIå˜æ›´æ—¶åŒæ­¥æ›´æ–°æ–‡æ¡£
- ğŸ§ª **æµ‹è¯•å‹å¥½**ï¼šæ–‡æ¡£åŒ…å«å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹ 

# å¼€å‘æ—¥å¿—

## 2025-06-11 APIæ–‡æ¡£æ›´æ–°å’ŒJSONè§£æé”™è¯¯å¤„ç†ä¼˜åŒ–

### ä¼˜åŒ–èƒŒæ™¯
åŸºäºä¹‹å‰å‘ç°çš„JSONè§£æé”™è¯¯ï¼ˆBase64ç¼–ç é—®é¢˜ï¼‰ï¼Œå®æ–½äº†ä¸¤ä¸ªé‡è¦æ”¹è¿›æªæ–½ï¼š
1. APIæ–‡æ¡£æ›´æ–°ï¼šæ˜ç¡®æŒ‡å®šè¯·æ±‚ä½“æ ¼å¼è¦æ±‚
2. é”™è¯¯å¤„ç†ä¼˜åŒ–ï¼šæ·»åŠ å‹å¥½çš„JSONè§£æé”™è¯¯æç¤º

### ğŸ”„ å®æ–½çš„æ”¹è¿›

#### ğŸ“– APIæ–‡æ¡£æ›´æ–° (`README.md`)

1. **æ–°å¢è¯·æ±‚æ ¼å¼è§„èŒƒç« èŠ‚**
   - æ·»åŠ äº† "âš ï¸ é‡è¦ï¼šAPIè¯·æ±‚æ ¼å¼è¦æ±‚" ä¸“é—¨ç« èŠ‚
   - è¯¦ç»†è¯´æ˜æ­£ç¡®å’Œé”™è¯¯çš„è¯·æ±‚æ ¼å¼ç¤ºä¾‹
   - æä¾›äº†JavaScriptå’Œcurlçš„æ­£ç¡®ä½¿ç”¨ç¤ºä¾‹

2. **æ ¼å¼è¦æ±‚æ˜ç¡®åŒ–**
   ```json
   âœ… æ­£ç¡®: {"email": "user@example.com", "password": "yourpassword"}
   âŒ é”™è¯¯: "eyJlbWFpbCI6InVzZXJAZXhhbXBsZS5jb20ifQ==" (Base64ç¼–ç )
   âŒ é”™è¯¯: "\"{\\\"email\\\":\\\"user@example.com\\\"}\"" (åŒé‡å­—ç¬¦ä¸²åŒ–)
   ```

3. **å®¢æˆ·ç«¯ç¤ºä¾‹ä»£ç **
   - æ·»åŠ äº†å®Œæ•´çš„fetch()å’Œcurlç¤ºä¾‹
   - æ˜ç¡®äº†Content-Typeå’ŒAuthorizationå¤´éƒ¨è¦æ±‚
   - ç»Ÿä¸€äº†å“åº”æ ¼å¼è¯´æ˜

#### ğŸ›¡ï¸ é”™è¯¯å¤„ç†ä¼˜åŒ– (`src/app.js`)

1. **æ™ºèƒ½JSONè§£æé¢„æ£€æŸ¥**
   - åœ¨JSONè§£æå‰æ·»åŠ verifyå‡½æ•°
   - è‡ªåŠ¨æ£€æµ‹Base64ç¼–ç çš„JSONæ•°æ®
   - ä¿å­˜è§£ç åå†…å®¹ç”¨äºé”™è¯¯æç¤º

2. **å‹å¥½çš„é”™è¯¯ä¿¡æ¯**
   - **Base64ç¼–ç é”™è¯¯**: è‡ªåŠ¨æ£€æµ‹å¹¶æä¾›è§£ç åçš„åŸå§‹æ•°æ®
   - **åŒé‡å­—ç¬¦ä¸²åŒ–é”™è¯¯**: è¯†åˆ«å¹¶æä¾›ä¿®å¤å»ºè®®
   - **å­—ç¬¦ä¸²æ ¼å¼JSON**: æç¤ºç§»é™¤å¤–å±‚å¼•å·

3. **è¯¦ç»†çš„é”™è¯¯å“åº”æ ¼å¼**
   ```json
   {
     "success": false,
     "message": "æ£€æµ‹åˆ°Base64ç¼–ç çš„JSONæ•°æ®",
     "error": {
       "type": "JSON_PARSE_ERROR",
       "details": "å…·ä½“é”™è¯¯ä¿¡æ¯",
       "suggestions": ["ä¿®å¤å»ºè®®1", "ä¿®å¤å»ºè®®2"],
       "receivedBody": "å¼€å‘ç¯å¢ƒä¸‹æ˜¾ç¤ºæ¥æ”¶åˆ°çš„æ•°æ®"
     },
     "help": {
       "correctFormat": "æ­£ç¡®æ ¼å¼è¯´æ˜",
       "example": "ç¤ºä¾‹æ•°æ®",
       "documentation": "æ–‡æ¡£é“¾æ¥"
     }
   }
   ```

#### ğŸ“Š APIæ–‡æ¡£è·¯ç”±å¢å¼º (`/api/debug/routes`)

1. **è¯·æ±‚æ ¼å¼è¯´æ˜**
   - æ·»åŠ äº†è¯¦ç»†çš„è¯·æ±‚æ ¼å¼è§„èŒƒ
   - æä¾›æ­£ç¡®å’Œé”™è¯¯ç¤ºä¾‹å¯¹æ¯”
   - è¯´æ˜è®¤è¯å¤´éƒ¨è¦æ±‚

2. **é”™è¯¯å¤„ç†è¯´æ˜**
   - æ–‡æ¡£åŒ–äº†å„ç§é”™è¯¯ç±»å‹çš„å¤„ç†æ–¹å¼
   - æä¾›äº†é”™è¯¯æ’æŸ¥æŒ‡å¼•

### âœ… æµ‹è¯•éªŒè¯

#### ğŸ” é”™è¯¯å¤„ç†æµ‹è¯•
1. **Base64ç¼–ç é”™è¯¯æµ‹è¯•**
   ```bash
   curl -d '"eyJhbW91bnQiOjEwMDAwfQ=="'
   # è¿”å›: "æ£€æµ‹åˆ°Base64ç¼–ç çš„JSONæ•°æ®" + è§£ç åå†…å®¹æ˜¾ç¤º
   ```

2. **åŒé‡å­—ç¬¦ä¸²åŒ–é”™è¯¯æµ‹è¯•**
   ```bash
   curl -d '"{\"email\":\"test@example.com\"}"'
   # è¿”å›: "æ£€æµ‹åˆ°åŒé‡JSONå­—ç¬¦ä¸²åŒ–" + ä¿®å¤å»ºè®®
   ```

3. **æ­£å¸¸åŠŸèƒ½éªŒè¯**
   ```bash
   curl -d '{"email":"test@example.com","password":"123456"}'
   # è¿”å›: æ­£å¸¸æ³¨å†ŒæˆåŠŸå“åº”
   ```

#### ğŸ“– æ–‡æ¡£æ›´æ–°éªŒè¯
- APIæ–‡æ¡£è·¯ç”±è¿”å›å®Œæ•´çš„æ ¼å¼è¦æ±‚è¯´æ˜
- é”™è¯¯ç¤ºä¾‹å’Œæ­£ç¡®ç¤ºä¾‹å¯¹æ¯”æ¸…æ™°
- å¼€å‘è€…å‹å¥½çš„é”™è¯¯æç¤ºå’Œä¿®å¤å»ºè®®

### ğŸ¯ æ”¹è¿›æ•ˆæœ

#### âœ… ç”¨æˆ·ä½“éªŒæå‡
- **é”™è¯¯è¯Šæ–­æ—¶é—´å‡å°‘**: ä»"æ— æ³•è§£æJSON"åˆ°"æ£€æµ‹åˆ°Base64ç¼–ç +è§£ç å†…å®¹"
- **ä¿®å¤æŒ‡å¯¼ç²¾ç¡®**: æä¾›å…·ä½“çš„ä¿®å¤å»ºè®®è€Œéé€šç”¨é”™è¯¯ä¿¡æ¯
- **æ–‡æ¡£å®Œæ•´æ€§**: å¼€å‘è€…å¯ä»¥å¿«é€Ÿäº†è§£æ­£ç¡®çš„APIä½¿ç”¨æ–¹å¼

#### ğŸ”§ å¼€å‘æ•ˆç‡æå‡
- **å¿«é€Ÿé”™è¯¯å®šä½**: é”™è¯¯ç±»å‹åˆ†ç±»å’Œè¯¦ç»†å»ºè®®
- **æ ‡å‡†åŒ–å“åº”**: ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼ä¾¿äºå‰ç«¯å¤„ç†
- **è‡ªæ–‡æ¡£åŒ–**: APIè·¯ç”±æœ¬èº«æä¾›å®Œæ•´çš„ä½¿ç”¨æŒ‡å—

#### ğŸ›¡ï¸ ç³»ç»Ÿå¥å£®æ€§
- **ä¼˜é›…é™çº§**: å³ä½¿æ£€æµ‹å¤±è´¥ä¹Ÿä¸å½±å“æ­£å¸¸åŠŸèƒ½
- **å¼€å‘è°ƒè¯•**: å¼€å‘ç¯å¢ƒæä¾›è¯¦ç»†ä¿¡æ¯ï¼Œç”Ÿäº§ç¯å¢ƒä¿æŠ¤æ•æ„Ÿæ•°æ®
- **å‘åå…¼å®¹**: ä¸å½±å“ç°æœ‰æ­£å¸¸çš„APIè°ƒç”¨

### ğŸ“ˆ æ€§èƒ½å½±å“
- **æ£€æµ‹å¼€é”€**: ä»…åœ¨JSONè§£æå¤±è´¥æ—¶è¿›è¡Œé¢å¤–æ£€æµ‹
- **å†…å­˜ä½¿ç”¨**: é”™è¯¯æƒ…å†µä¸‹ä¸´æ—¶ä¿å­˜å°‘é‡è°ƒè¯•ä¿¡æ¯
- **å“åº”æ—¶é—´**: å¯¹æ­£å¸¸è¯·æ±‚æ— å½±å“ï¼Œé”™è¯¯è¯·æ±‚æä¾›æ›´å¿«çš„åé¦ˆ

### ğŸ”„ åç»­è®¡åˆ’
1. **ç›‘æ§æ”¶é›†**: æ”¶é›†å®é™…ç”Ÿäº§ç¯å¢ƒä¸­çš„é”™è¯¯ç±»å‹ç»Ÿè®¡
2. **æŒç»­ä¼˜åŒ–**: æ ¹æ®ç”¨æˆ·åé¦ˆæ·»åŠ æ›´å¤šé”™è¯¯æ¨¡å¼è¯†åˆ«
3. **è‡ªåŠ¨ä¿®å¤**: è€ƒè™‘åœ¨æŸäº›æƒ…å†µä¸‹è‡ªåŠ¨ä¿®å¤æ˜æ˜¾çš„æ ¼å¼é”™è¯¯

---

## ç¬¬äº”é˜¶æ®µï¼šè®¤è¯ç³»ç»Ÿæ¶æ„éªŒè¯å’Œæ–‡æ¡£æ›´æ–° (2024-06-17 16:00)

### ğŸ” è®¤è¯ç³»ç»Ÿæ£€æŸ¥ç»“æœ

é€šè¿‡è¯¦ç»†æ£€æŸ¥é¡¹ç›®ä»£ç ï¼Œç¡®è®¤å®é™…è®¤è¯æ¶æ„ï¼š

**å®é™…è®¤è¯æ–¹æ³•**ï¼š
- **åŸºç¡€è®¤è¯**ï¼šSupabase Auth
- **ç”¨æˆ·ç®¡ç†**ï¼šè‡ªå®šä¹‰Useræ¨¡å‹ + Supabaseæ•°æ®åº“
- **ä»¤ç‰Œç±»å‹**ï¼šSupabase JWT Access Token
- **ä»¤ç‰ŒéªŒè¯**ï¼šSupabase Auth API
- **æƒé™æ§åˆ¶**ï¼šè‡ªå®šä¹‰è®¤è¯ä¸­é—´ä»¶

### ğŸ“ æ–‡æ¡£æ›´æ–°å†…å®¹

#### 1. API.md æ–‡æ¡£æ›´æ–°
- âœ… æ›´æ–°è®¤è¯è¯´æ˜ç« èŠ‚ï¼Œè¯¦ç»†æè¿°æ··åˆè®¤è¯æ¶æ„
- âœ… ä¿®æ­£ä»¤ç‰Œç±»å‹ä¸ºSupabase JWT Access Token
- âœ… æ›´æ–°ç”¨æˆ·æ³¨å†Œ/ç™»å½•æµç¨‹è¯´æ˜
- âœ… æ·»åŠ è®¤è¯æµç¨‹æ­¥éª¤è¯´æ˜
- âœ… ä¿®æ­£ç”¨æˆ·IDæ ¼å¼ä¸ºUUID
- âœ… æ›´æ–°è´¦å·åˆ é™¤æµç¨‹è¯´æ˜
- âœ… æ·»åŠ é¡¹ç›®åŸºæœ¬ä¿¡æ¯ä¸­çš„è®¤è¯ç³»ç»Ÿè¯´æ˜

#### 2. swift-supabase-example.md æ–‡æ¡£æ›´æ–°
- âœ… æ›´æ–°åç«¯æŠ€æœ¯æ ˆè¯´æ˜ï¼Œæ˜ç¡®è®¤è¯æ¶æ„
- âœ… ä¿®æ­£å®‰å…¨æ¶æ„æè¿°ï¼Œçªå‡ºæ··åˆè®¤è¯ç‰¹æ€§
- âœ… æ·»åŠ è®¤è¯æ¶æ„è¯¦ç»†è¯´æ˜
- âœ… æ›´æ–°iOSè®¤è¯ç®¡ç†å™¨ï¼Œä½¿ç”¨åç«¯APIè€Œéç›´æ¥Supabase
- âœ… ä¿®æ­£ç”¨æˆ·æ³¨å†Œ/ç™»å½•æ–¹æ³•ï¼Œè°ƒç”¨åç«¯API
- âœ… æ›´æ–°ä»¤ç‰Œç®¡ç†æ–¹å¼ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨
- âœ… æ·»åŠ è®¤è¯ç›¸å…³æ•°æ®æ¨¡å‹å’Œé”™è¯¯å¤„ç†

### ğŸ—ï¸ è®¤è¯æ¶æ„ç‰¹ç‚¹

**æ··åˆæ¶æ„ä¼˜åŠ¿**ï¼š
1. **Supabase Auth**ï¼šæä¾›å¯é çš„è®¤è¯æœåŠ¡å’ŒJWTä»¤ç‰Œ
2. **è‡ªå®šä¹‰åç«¯**ï¼šæä¾›çµæ´»çš„ä¸šåŠ¡é€»è¾‘å’Œç”¨æˆ·ç®¡ç†
3. **ç»Ÿä¸€API**ï¼šæ‰€æœ‰åŠŸèƒ½é€šè¿‡åç«¯APIè®¿é—®ï¼Œä¾¿äºç»´æŠ¤
4. **å®‰å…¨æ§åˆ¶**ï¼šæ”¯æŒä»¤ç‰Œé»‘åå•å’Œè½¯åˆ é™¤æœºåˆ¶

**å®ç°ç»†èŠ‚**ï¼š
- ç”¨æˆ·æ³¨å†Œï¼šSupabase Admin API + è‡ªåŠ¨é‚®ç®±ç¡®è®¤
- ç”¨æˆ·ç™»å½•ï¼šSupabase AuthéªŒè¯ + ä»¤ç‰Œè¿”å›
- ä»¤ç‰ŒéªŒè¯ï¼šåç«¯ä¸­é—´ä»¶è°ƒç”¨Supabase API
- ç”¨æˆ·ç®¡ç†ï¼šprofilesè¡¨å­˜å‚¨æ‰©å±•ä¿¡æ¯
- æƒé™æ§åˆ¶ï¼šè‡ªå®šä¹‰ä¸­é—´ä»¶ + ä»¤ç‰Œé»‘åå•

### ğŸ“š æ–‡æ¡£ä¸€è‡´æ€§æ£€æŸ¥

- âœ… APIæ–‡æ¡£ä¸å®é™…ä»£ç å®ç°å®Œå…¨ä¸€è‡´
- âœ… iOSé›†æˆæŒ‡å—åæ˜ çœŸå®è®¤è¯æµç¨‹
- âœ… è®¤è¯æ¶æ„è¯´æ˜å‡†ç¡®è¯¦ç»†
- âœ… å®‰å…¨æœºåˆ¶æ–‡æ¡£åŒ–å®Œæ•´

### ğŸ¯ ä¸»è¦ä¿®å¤é¡¹ç›®

1. **è®¤è¯æ–¹å¼æ¾„æ¸…**ï¼šæ˜ç¡®ä½¿ç”¨Supabase Auth + è‡ªå®šä¹‰ç®¡ç†
2. **APIè°ƒç”¨ä¿®æ­£**ï¼šiOSåº”ç”¨åº”è°ƒç”¨åç«¯APIè€Œéç›´æ¥ä½¿ç”¨Supabase
3. **ä»¤ç‰Œç®¡ç†**ï¼šä½¿ç”¨æœ¬åœ°å­˜å‚¨ç®¡ç†Supabaseè®¿é—®ä»¤ç‰Œ
4. **ç”¨æˆ·IDæ ¼å¼**ï¼šç»Ÿä¸€ä½¿ç”¨UUIDæ ¼å¼
5. **åˆ é™¤æµç¨‹**ï¼šè¯¦ç»†è¯´æ˜è½¯åˆ é™¤å’Œä»¤ç‰Œå¤±æ•ˆæœºåˆ¶

**æ–‡æ¡£ç‰ˆæœ¬**: v5.0  
**æœ€åæ›´æ–°**: 2024-06-17 16:00  
**çŠ¶æ€**: è®¤è¯æ¶æ„éªŒè¯å®Œæˆï¼Œæ–‡æ¡£å·²å®Œå…¨åŒæ­¥

---

## ç¬¬å…­é˜¶æ®µï¼šSupabaseæ•°æ®åº“ç»“æ„ä¿®å¤ (2024-06-18 13:30)

### ğŸš¨ é—®é¢˜å‘ç°

iOSåº”ç”¨ç™»å½•æ—¶å‡ºç°500é”™è¯¯ï¼š
```
ğŸ“¡ å“åº”çŠ¶æ€ç : 500
ğŸ“¥ å“åº”æ•°æ®: {"success":false,"message":"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"}
âŒ JSONè§£æå¤±è´¥: keyNotFound user
```

### ğŸ” é—®é¢˜è¯Šæ–­

é€šè¿‡æœ¬åœ°è°ƒè¯•å‘ç°å…·ä½“é”™è¯¯ï¼š
```
"column profiles.is_deleted does not exist"
```

**æ ¹æœ¬åŸå› **ï¼š
- Supabaseæ•°æ®åº“è¡¨ç»“æ„ä¸å®Œæ•´
- ä»£ç ä¸­ä½¿ç”¨äº† `is_deleted` å’Œ `deleted_at` å­—æ®µ
- ä½†åˆå§‹è¿ç§»æ–‡ä»¶ä¸­æœªåŒ…å«è¿™äº›å­—æ®µ

### ğŸ”§ è§£å†³æ–¹æ¡ˆ

#### 1. åˆ›å»ºæ–°è¿ç§»æ–‡ä»¶
åˆ›å»º `20250618132900_add_soft_delete_to_profiles.sql`ï¼š
- âœ… æ·»åŠ  `is_deleted BOOLEAN DEFAULT FALSE`
- âœ… æ·»åŠ  `deleted_at TIMESTAMP WITH TIME ZONE DEFAULT NULL`
- âœ… åˆ›å»ºç›¸å…³ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
- âœ… æ›´æ–°RLSç­–ç•¥æ’é™¤å·²åˆ é™¤ç”¨æˆ·
- âœ… æ·»åŠ ç®¡ç†å‘˜ç­–ç•¥æ”¯æŒè½¯åˆ é™¤æ“ä½œ
- âœ… åˆ›å»ºè½¯åˆ é™¤å’Œæ¢å¤å‡½æ•°

#### 2. åº”ç”¨æ•°æ®åº“è¿ç§»
```bash
npx supabase db push
# âœ… æˆåŠŸåº”ç”¨è¿ç§»åˆ°ç”Ÿäº§æ•°æ®åº“
```

### âœ… ä¿®å¤éªŒè¯

#### åç«¯APIæµ‹è¯•ç»“æœï¼š
1. **æ³¨å†ŒAPI**: âœ… æ­£å¸¸å·¥ä½œ
   ```json
   {"success":false,"message":"è¯¥é‚®ç®±å·²è¢«æ³¨å†Œ"}
   ```

2. **ç™»å½•API**: âœ… å®Œå…¨æ­£å¸¸
   ```json
   {
     "success": true,
     "message": "ç™»å½•æˆåŠŸ",
     "data": {
       "user": {
         "id": "3824d1ba-67f6-44e9-88d9-16f2aa78fd68",
         "email": "test@example.com",
         "createdAt": "2025-06-18T07:48:55.314517+00:00"
       },
       "token": "eyJhbGciOiJIUzI1NiIs..."
     }
   }
   ```

### ğŸ¯ æŠ€æœ¯ç»†èŠ‚

#### æ•°æ®åº“ç»“æ„å®Œå–„ï¼š
- **è½¯åˆ é™¤æ”¯æŒ**: ç”¨æˆ·åˆ é™¤æ—¶ä¿ç•™æ•°æ®ä½†æ ‡è®°ä¸ºå·²åˆ é™¤
- **RLSç­–ç•¥**: ç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æœªåˆ é™¤æ•°æ®
- **ç´¢å¼•ä¼˜åŒ–**: æé«˜è½¯åˆ é™¤æŸ¥è¯¢æ€§èƒ½
- **ç®¡ç†å‡½æ•°**: æä¾›è½¯åˆ é™¤å’Œæ¢å¤åŠŸèƒ½

#### å®‰å…¨å¢å¼ºï¼š
- **ç®¡ç†å‘˜ç­–ç•¥**: service_roleå¯ä»¥è®¿é—®æ‰€æœ‰æ•°æ®
- **ç”¨æˆ·éš”ç¦»**: æ™®é€šç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æœªåˆ é™¤æ•°æ®
- **æ•°æ®å®Œæ•´æ€§**: ç°æœ‰æ•°æ®è‡ªåŠ¨è®¾ç½®ä¸ºæœªåˆ é™¤çŠ¶æ€

### ğŸ“Š å½±å“è¯„ä¼°

- âœ… **iOSåº”ç”¨**: ç°åœ¨å¯ä»¥æ­£å¸¸ç™»å½•
- âœ… **æ•°æ®å®‰å…¨**: è½¯åˆ é™¤æœºåˆ¶å®Œå–„
- âœ… **æ€§èƒ½**: ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡
- âœ… **ç»´æŠ¤æ€§**: æ ‡å‡†åŒ–çš„è½¯åˆ é™¤æµç¨‹

### ğŸ”„ åç»­å»ºè®®

1. **iOSåº”ç”¨**: å¯ä»¥ç»§ç»­æ­£å¸¸å¼€å‘å’Œæµ‹è¯•
2. **æ•°æ®åº“**: ç»“æ„å·²å®Œå–„ï¼Œæ”¯æŒæ‰€æœ‰åŠŸèƒ½
3. **ç›‘æ§**: å…³æ³¨è½¯åˆ é™¤åŠŸèƒ½çš„ä½¿ç”¨æƒ…å†µ
4. **æ–‡æ¡£**: æ•°æ®åº“ç»“æ„æ–‡æ¡£éœ€è¦æ›´æ–°

**æ–‡æ¡£ç‰ˆæœ¬**: v5.1  
**æœ€åæ›´æ–°**: 2024-06-18 13:30  
**çŠ¶æ€**: æ•°æ®åº“ç»“æ„ä¿®å¤å®Œæˆï¼Œæ‰€æœ‰APIæ­£å¸¸å·¥ä½œ

---

## 2025-06-11 è´¹ç”¨åˆ†ç±»ç«¯ç‚¹ä¿®å¤å’Œå…¨é¢åŠŸèƒ½æµ‹è¯•

### é—®é¢˜è¯Šæ–­å’Œä¿®å¤

#### ğŸ” å‘ç°çš„é—®é¢˜
1. **è´¹ç”¨åˆ†ç±»ç«¯ç‚¹ç¼ºå¤±**: `/api/expense/categories` è·¯ç”±åœ¨ `app.js` ä¸­è¢«å£°æ˜ä½†å®é™…æœªå®ç°
2. **ç”¨æˆ·æ•°æ®é‡ç½®**: æœåŠ¡å™¨é‡å¯åç”¨æˆ·æ•°æ®ä¸¢å¤±ï¼ˆå†…å­˜å­˜å‚¨å¯¼è‡´ï¼‰
3. **è·¯ç”±è·¯å¾„ä¸ä¸€è‡´**: ç”¨æˆ·åˆ—è¡¨è·¯ç”±å®é™…ä¸º `/debug/users` è€Œä¸æ˜¯ `/users`

#### âœ… å®æ–½çš„ä¿®å¤

1. **æ·»åŠ è´¹ç”¨åˆ†ç±»æ§åˆ¶å™¨æ–¹æ³•** (`src/controllers/expenseController.js`):
   - æ–°å¢ `getCategories` æ–¹æ³•
   - è¿”å›åŒ…å«ä¸­æ–‡æ ‡ç­¾å’Œemojiå›¾æ ‡çš„åˆ†ç±»åˆ—è¡¨
   - å…±9ä¸ªåˆ†ç±»ï¼šé¤é¥®ã€äº¤é€šã€å¨±ä¹ã€è´­ç‰©ã€è´¦å•ã€åŒ»ç–—ã€æ•™è‚²ã€æ—…è¡Œã€å…¶ä»–

2. **æ›´æ–°è´¹ç”¨è·¯ç”±é…ç½®** (`src/routes/expense.js`):
   - æ·»åŠ  `GET /categories` è·¯ç”±
   - ç¡®ä¿åœ¨ `:id` å‚æ•°è·¯ç”±ä¹‹å‰å®šä¹‰ä»¥é¿å…å†²çª

### å…¨é¢åŠŸèƒ½æµ‹è¯•

#### ğŸ” è®¤è¯ç³»ç»Ÿæµ‹è¯•
- âœ… ç”¨æˆ·æ³¨å†Œ: `POST /api/auth/register`
- âœ… ç”¨æˆ·ç™»å½•: `POST /api/auth/login`
- âœ… è·å–å½“å‰ç”¨æˆ·: `GET /api/auth/me`
- âœ… è·å–ç”¨æˆ·åˆ—è¡¨: `GET /api/auth/debug/users`
- âœ… é”™è¯¯å¤„ç†: ç¼ºå°‘å‚æ•°ã€é”™è¯¯é‚®ç®±ã€æ— æ•ˆtokenç­‰

#### ğŸ’° è´¹ç”¨ç®¡ç†æµ‹è¯•
- âœ… è·å–åˆ†ç±»åˆ—è¡¨: `GET /api/expense/categories`
- âœ… åˆ›å»ºè´¹ç”¨è®°å½•: `POST /api/expense`
- âœ… è·å–è´¹ç”¨åˆ—è¡¨: `GET /api/expense`
- âœ… æ›´æ–°è´¹ç”¨è®°å½•: `PUT /api/expense/:id`
- âœ… è´¹ç”¨ç»Ÿè®¡åˆ†æ: `GET /api/expense/stats`

#### ğŸ“Š é¢„ç®—ç®¡ç†æµ‹è¯•
- âœ… åˆ›å»ºé¢„ç®—: `POST /api/budget`
- âœ… è·å–å½“å‰é¢„ç®—çŠ¶æ€: `GET /api/budget/current`
- âœ… é¢„ç®—ä½¿ç”¨ç‡è®¡ç®—: è‡ªåŠ¨è®¡ç®—å‰©ä½™é¢åº¦å’Œä½¿ç”¨ç™¾åˆ†æ¯”

### æµ‹è¯•æ•°æ®ç¤ºä¾‹

#### åˆ›å»ºçš„ç”¨æˆ·
- é‚®ç®±: `test@example.com`
- å¯†ç : `123456`
- ç”¨æˆ·ID: 1

#### åˆ›å»ºçš„è´¹ç”¨è®°å½•
1. åˆé¤: Â¥55.00 (é¤é¥®ç±»ï¼Œå·²æ›´æ–°)
2. åœ°é“è´¹: Â¥25.80 (äº¤é€šç±»)
3. ç”µå½±ç¥¨: Â¥120.00 (å¨±ä¹ç±»ï¼ŒåŒ…å«æ ‡ç­¾)

#### åˆ›å»ºçš„é¢„ç®—
- 2025å¹´6æœˆé¢„ç®—: Â¥1000.00
- å·²ä½¿ç”¨: Â¥200.80 (20.08%)
- å‰©ä½™: Â¥799.20

### ç³»ç»Ÿå¥å£®æ€§éªŒè¯

#### âœ… é€šè¿‡çš„æµ‹è¯•
- è®¤è¯tokenéªŒè¯
- æ•°æ®éªŒè¯å’Œé”™è¯¯å¤„ç†
- è·¨ç”¨æˆ·æ•°æ®éš”ç¦»
- åˆ†é¡µå’Œæ’åºåŠŸèƒ½
- å®æ—¶é¢„ç®—è®¡ç®—
- åˆ†ç±»ç»Ÿè®¡èšåˆ

#### ğŸ“ˆ æ€§èƒ½è¡¨ç°
- APIå“åº”æ—¶é—´: < 100ms
- å†…å­˜ä½¿ç”¨ç¨³å®š
- æ—¥å¿—è®°å½•å®Œæ•´

### æŠ€æœ¯ç‰¹æ€§ç¡®è®¤

#### ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§
- JWTè®¤è¯æœºåˆ¶æ­£å¸¸
- å¯†ç bcryptåŠ å¯†
- è¯·æ±‚é¢‘ç‡é™åˆ¶
- è·¨åŸŸä¿æŠ¤ (CORS)
- å®‰å…¨å¤´éƒ¨ (Helmet)

#### ğŸ“ APIæ–‡æ¡£å…¼å®¹æ€§
- æ‰€æœ‰ç«¯ç‚¹æŒ‰ç…§README.mdæ–‡æ¡£å·¥ä½œ
- è¯·æ±‚/å“åº”æ ¼å¼ä¸€è‡´
- é”™è¯¯ä¿¡æ¯è§„èŒƒåŒ–

### åç»­æ”¹è¿›å»ºè®®

1. **æ•°æ®æŒä¹…åŒ–**: è€ƒè™‘æ¥å…¥çœŸå®æ•°æ®åº“æ›¿ä»£å†…å­˜å­˜å‚¨
2. **ç¼“å­˜ä¼˜åŒ–**: å¯¹é¢‘ç¹æŸ¥è¯¢çš„æ•°æ®æ·»åŠ ç¼“å­˜å±‚
3. **ç›‘æ§å‘Šè­¦**: æ·»åŠ æ€§èƒ½ç›‘æ§å’Œé”™è¯¯å‘Šè­¦
4. **æµ‹è¯•è¦†ç›–**: ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹

### æ€»ç»“

è´¹ç”¨è¿½è¸ªåç«¯ç³»ç»Ÿç°å·²å®Œå…¨æ­£å¸¸è¿è¡Œï¼Œæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å‡å·²éªŒè¯ï¼š
- ç”¨æˆ·è®¤è¯å’Œæˆæƒ âœ…
- è´¹ç”¨è®°å½•CRUDæ“ä½œ âœ…
- é¢„ç®—ç®¡ç†å’Œç›‘æ§ âœ…
- æ•°æ®ç»Ÿè®¡å’Œåˆ†æ âœ…
- é”™è¯¯å¤„ç†å’Œå®‰å…¨é˜²æŠ¤ âœ…

ç³»ç»Ÿå¯ä»¥ç›´æ¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚

---

## 2025-06-11 æ¶æ„é‡æ„å’Œæ¨¡å—åŒ–æ”¹è¿›

### é‡æ„èƒŒæ™¯
å‘ç°é¡¹ç›®ä¸­å­˜åœ¨åŒé‡è®¤è¯ç³»ç»Ÿï¼š
1. åœ¨ `src/app.js` ä¸­å†…è”çš„è®¤è¯é€»è¾‘
2. åœ¨ `src/controllers/authController.js` ä¸­çš„æ¨¡å—åŒ–è®¤è¯ç³»ç»Ÿ

ä¸ºäº†æé«˜ä»£ç å¯ç»´æŠ¤æ€§å’Œéµå¾ªæœ€ä½³å®è·µï¼Œå†³å®šè¿ç§»åˆ°å®Œå…¨æ¨¡å—åŒ–çš„æ¶æ„ã€‚

### é‡æ„å†…å®¹

#### ğŸ—ï¸ åˆ›å»ºçš„æ–°æ–‡ä»¶

1. **è®¤è¯æ§åˆ¶å™¨** (`src/controllers/authController.js`, 6.5KB, 231è¡Œ)
   - å®Œæ•´çš„ç”¨æˆ·è®¤è¯ä¸šåŠ¡é€»è¾‘
   - æ³¨å†Œã€ç™»å½•ã€è·å–ç”¨æˆ·ä¿¡æ¯åŠŸèƒ½
   - ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
   - JWT tokenç”Ÿæˆå’ŒéªŒè¯

2. **è®¤è¯ä¸­é—´ä»¶** (`src/middleware/auth.js`, 2.0KB, 72è¡Œ)
   - JWT tokenéªŒè¯ä¸­é—´ä»¶
   - è¯·æ±‚å¤´è§£æå’Œtokenæå–
   - ç”¨æˆ·èº«ä»½éªŒè¯å’Œæˆæƒ
   - ç»Ÿä¸€çš„è®¤è¯é”™è¯¯å¤„ç†

#### ğŸ”„ æ›´æ–°çš„æ–‡ä»¶

1. **è®¤è¯è·¯ç”±** (`src/routes/auth.js`)
   - ç§»é™¤å†…è”è®¤è¯é€»è¾‘
   - ä½¿ç”¨æ–°çš„æ§åˆ¶å™¨å’Œä¸­é—´ä»¶
   - ä¿æŒAPIæ¥å£ä¸å˜

2. **åº”ç”¨ä¸»æ–‡ä»¶** (`src/app.js`)
   - æ¸…ç†é‡å¤çš„è®¤è¯ä»£ç 
   - ç®€åŒ–ä¸­é—´ä»¶é…ç½®
   - ä¿æŒç°æœ‰åŠŸèƒ½å®Œæ•´æ€§

### æ¶æ„ä¼˜åŠ¿

#### âœ… æ”¹è¿›æ•ˆæœ
- **ä»£ç å¤ç”¨**: è®¤è¯é€»è¾‘é›†ä¸­ç®¡ç†ï¼Œé¿å…é‡å¤
- **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œï¼Œæ˜“äºç†è§£å’Œä¿®æ”¹
- **å¯æµ‹è¯•æ€§**: ç‹¬ç«‹çš„æ§åˆ¶å™¨å’Œä¸­é—´ä»¶ä¾¿äºå•å…ƒæµ‹è¯•
- **æ‰©å±•æ€§**: æ–°çš„è®¤è¯åŠŸèƒ½å¯ä»¥è½»æ¾æ·»åŠ 

#### ğŸ“ æ¨¡å—èŒè´£åˆ’åˆ†
- **æ§åˆ¶å™¨**: å¤„ç†ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®æ“ä½œ
- **ä¸­é—´ä»¶**: å¤„ç†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆè®¤è¯ã€æ—¥å¿—ç­‰ï¼‰
- **è·¯ç”±**: å®šä¹‰APIç«¯ç‚¹å’Œå‚æ•°æ˜ å°„
- **æ¨¡å‹**: æ•°æ®è®¿é—®å’ŒéªŒè¯

### è¿ç§»è¿‡ç¨‹

1. **åˆ†æç°æœ‰ä»£ç **: è¯†åˆ«é‡å¤çš„è®¤è¯é€»è¾‘
2. **è®¾è®¡æ–°æ¶æ„**: è§„åˆ’æ¨¡å—åŒ–çš„ä»£ç ç»“æ„
3. **å®ç°æ§åˆ¶å™¨**: è¿ç§»ä¸šåŠ¡é€»è¾‘åˆ°ä¸“ç”¨æ§åˆ¶å™¨
4. **åˆ›å»ºä¸­é—´ä»¶**: æå–é€šç”¨çš„è®¤è¯ä¸­é—´ä»¶
5. **æ›´æ–°è·¯ç”±**: è¿æ¥æ–°çš„æ§åˆ¶å™¨å’Œä¸­é—´ä»¶
6. **æ¸…ç†å†—ä½™**: ç§»é™¤é‡å¤å’Œè¿‡æ—¶çš„ä»£ç 
7. **æµ‹è¯•éªŒè¯**: ç¡®ä¿åŠŸèƒ½å®Œæ•´æ€§å’ŒAPIå…¼å®¹æ€§

### æ€§èƒ½å’Œç¨³å®šæ€§

- **å†…å­˜ä½¿ç”¨**: å‡å°‘ä»£ç é‡å¤ï¼Œä¼˜åŒ–å†…å­˜å ç”¨
- **å“åº”æ—¶é—´**: æ¨¡å—åŒ–ä¸å½±å“å“åº”æ€§èƒ½
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æé«˜ç³»ç»Ÿç¨³å®šæ€§
- **æ—¥å¿—è®°å½•**: å¢å¼ºçš„æ—¥å¿—å¸®åŠ©é—®é¢˜è¯Šæ–­

---

## 2025-06-11 Mongooseä¾èµ–é—®é¢˜ä¿®å¤

### é—®é¢˜å‘ç°
åœ¨å¯åŠ¨æœåŠ¡å™¨æ—¶é‡åˆ°é”™è¯¯ï¼š
```
Error: Cannot find module 'mongoose'
```

### é—®é¢˜åˆ†æ
é€šè¿‡æ£€æŸ¥æ¨¡å‹æ–‡ä»¶å‘ç°ï¼š
- `src/models/User.js` å’Œ `src/models/Budget.js` ä½¿ç”¨å†…å­˜å­˜å‚¨
- `src/models/Expense.js` ä½¿ç”¨äº† mongoose æ•°æ®åº“è¿æ¥
- é¡¹ç›®æ¶æ„ä¸ä¸€è‡´ï¼Œéƒ¨åˆ†ä¾èµ– mongoose è€Œæœªå®‰è£…

### è§£å†³æ–¹æ¡ˆ
é€‰æ‹©ç»Ÿä¸€ä½¿ç”¨å†…å­˜å­˜å‚¨ä»¥ä¿æŒæ¶æ„ä¸€è‡´æ€§ï¼š

#### ğŸ”„ é‡å†™ Expense æ¨¡å‹
1. **ç§»é™¤ mongoose ä¾èµ–**ï¼Œæ”¹ç”¨å†…å­˜æ•°ç»„å­˜å‚¨
2. **å®ç°å®Œæ•´ CRUD æ“ä½œ**ï¼š
   - `create()` - åˆ›å»ºæ”¯å‡ºè®°å½•
   - `findById()` - æ ¹æ®IDæŸ¥æ‰¾
   - `findByUserId()` - æ ¹æ®ç”¨æˆ·IDæŸ¥æ‰¾ï¼ˆæ”¯æŒåˆ†é¡µã€æ’åºã€è¿‡æ»¤ï¼‰
   - `updateById()` - æ›´æ–°è®°å½•
   - `deleteById()` - åˆ é™¤è®°å½•

3. **æ·»åŠ ç»Ÿè®¡åŠŸèƒ½**ï¼š
   - `getStatsByCategory()` - æŒ‰åˆ†ç±»ç»Ÿè®¡
   - `getTotalByUser()` - ç”¨æˆ·æ€»è®¡ç»Ÿè®¡
   - `getCurrentMonthTotal()` - å½“å‰æœˆä»½æ”¯å‡º
   - `getMonthlyTotal()` - æŒ‡å®šæœˆä»½æ”¯å‡º

4. **æ•°æ®éªŒè¯å¢å¼º**ï¼š
   - é‡‘é¢èŒƒå›´éªŒè¯
   - åˆ†ç±»æœ‰æ•ˆæ€§æ£€æŸ¥
   - å­—ç¬¦ä¸²é•¿åº¦é™åˆ¶
   - æ ‡ç­¾æ•°é‡é™åˆ¶

#### âœ… ä¿®å¤æ•ˆæœ
- æœåŠ¡å™¨æˆåŠŸå¯åŠ¨ï¼Œæ— ä¾èµ–é”™è¯¯
- æ‰€æœ‰ API ç«¯ç‚¹æ­£å¸¸å·¥ä½œ
- æ•°æ®æŒä¹…æ€§åœ¨è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸå†…ä¿æŒ
- æ”¯æŒå¤æ‚æŸ¥è¯¢å’Œç»Ÿè®¡åˆ†æ

---

## 2025-06-11 é¡¹ç›®æ–‡æ¡£å®Œå–„

### åˆ›å»º README.md
ç¼–å†™äº†è¯¦ç»†çš„é¡¹ç›®æ–‡æ¡£ï¼ˆ3.8KB, 219è¡Œï¼‰ï¼ŒåŒ…å«ï¼š

#### ğŸ“– æ–‡æ¡£å†…å®¹
1. **é¡¹ç›®æ¦‚è¿°**ï¼šåŠŸèƒ½æè¿°å’ŒæŠ€æœ¯æ ˆ
2. **ç›®å½•ç»“æ„**ï¼šå®Œæ•´çš„æ–‡ä»¶ç»„ç»‡è¯´æ˜
3. **APIæ–‡æ¡£**ï¼šæ‰€æœ‰ç«¯ç‚¹çš„è¯¦ç»†è¯´æ˜
   - è®¤è¯ç›¸å…³ APIï¼ˆæ³¨å†Œã€ç™»å½•ã€ç”¨æˆ·ä¿¡æ¯ï¼‰
   - æ”¯å‡ºç®¡ç† APIï¼ˆCRUDã€ç»Ÿè®¡ã€åˆ†ç±»ï¼‰
   - é¢„ç®—ç®¡ç† APIï¼ˆè®¾ç½®ã€æŸ¥è¯¢ã€çŠ¶æ€ï¼‰
4. **å®‰è£…æŒ‡å—**ï¼šä¾èµ–å®‰è£…å’Œå¯åŠ¨æ­¥éª¤
5. **ä½¿ç”¨ç¤ºä¾‹**ï¼šå®é™…çš„ curl å‘½ä»¤æ¼”ç¤º

#### ğŸš€ æŠ€æœ¯æ ˆæ–‡æ¡£
- **åç«¯æ¡†æ¶**: Express.js
- **è®¤è¯æœºåˆ¶**: JWT + bcrypt
- **å®‰å…¨ä¸­é—´ä»¶**: Helmet, CORS, é™æµ
- **æ•°æ®å­˜å‚¨**: å†…å­˜å­˜å‚¨ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- **å¼€å‘å·¥å…·**: nodemon, dotenv

#### ğŸ“‹ APIæ–‡æ¡£è§„èŒƒ
æ¯ä¸ªç«¯ç‚¹åŒ…å«ï¼š
- HTTP æ–¹æ³•å’Œè·¯å¾„
- è¯·æ±‚å‚æ•°å’Œæ ¼å¼
- å“åº”ç¤ºä¾‹
- é”™è¯¯å¤„ç†è¯´æ˜
- è®¤è¯è¦æ±‚

### .env.example å°è¯•
å°è¯•åˆ›å»ºç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶ï¼Œä½†è¢« globalIgnore é˜»æ­¢ã€‚è¿™æ˜¯æ­£å¸¸çš„å®‰å…¨è¡Œä¸ºã€‚

---

## 2025-06-11 ä»£ç æ³¨é‡Šå¢å¼º

### æ³¨é‡Šå®Œå–„
ä¸ºæé«˜ä»£ç å¯è¯»æ€§ï¼Œä¸ºæ‰€æœ‰ä¸»è¦æ–‡ä»¶æ·»åŠ äº†è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

#### ğŸ“ server.js æ³¨é‡Š
- æ–‡ä»¶ç”¨é€”å’Œå¯åŠ¨æµç¨‹è¯´æ˜
- ç«¯å£é…ç½®å’Œç¯å¢ƒå˜é‡è¯´æ˜
- é”™è¯¯å¤„ç†æœºåˆ¶è¯´æ˜

#### ğŸ“ src/app.js æ³¨é‡Š  
- Express åº”ç”¨é…ç½®è¯¦è§£
- ä¸­é—´ä»¶ç”¨é€”å’Œé…ç½®å‚æ•°
- è·¯ç”±æŒ‚è½½å’Œé”™è¯¯å¤„ç†
- å®‰å…¨é…ç½®è¯´æ˜

#### ğŸ“ src/routes/auth.js æ³¨é‡Š
- è·¯ç”±æ¨¡å—åŒ–è®¾è®¡è¯´æ˜
- æ¯ä¸ªç«¯ç‚¹çš„åŠŸèƒ½æè¿°
- è®¤è¯è¦æ±‚å’Œå‚æ•°è¯´æ˜

### æ³¨é‡Šæ ‡å‡†
- ä½¿ç”¨ä¸­æ–‡æ³¨é‡Šæé«˜å›¢é˜Ÿç†è§£
- å‡½æ•°çº§åˆ«æ³¨é‡Šè¯´æ˜ç”¨é€”å’Œå‚æ•°
- é‡è¦é€»è¾‘æ·»åŠ è¡Œå†…æ³¨é‡Š
- æ¨¡å—å¤´éƒ¨åŒ…å«åŠŸèƒ½æ¦‚è¿°

---

## 2025-06-11 è®¤è¯ç³»ç»Ÿé”™è¯¯ä¿®å¤

### å‘ç°çš„é”™è¯¯
åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°æœåŠ¡å™¨å¯åŠ¨å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ï¼š
```
TypeError: Missing parameter name
```

### é—®é¢˜å®šä½
é”™è¯¯æºäº `src/app.js` ä¸­çš„ä»£ç ï¼š
```javascript
app.use('*', (req, res) => {
```

Express ä¸æ”¯æŒ `'*'` ä½œä¸ºè·¯å¾„å‚æ•°ã€‚

### ä¿®å¤æ–¹æ¡ˆ
å°†é€šé…ç¬¦è·¯ç”±æ”¹ä¸ºï¼š
```javascript
app.use((req, res) => {
```

### éªŒè¯ç»“æœ
- æœåŠ¡å™¨æˆåŠŸå¯åŠ¨
- 404 å¤„ç†æ­£å¸¸å·¥ä½œ
- æ‰€æœ‰ API ç«¯ç‚¹å¯è®¿é—®

---

## 2025-06-11 å®‰å…¨åŠŸèƒ½é›†æˆ

### å®‰å…¨ä¸­é—´ä»¶
æŒ‰ç”¨æˆ·è¦æ±‚é›†æˆäº†ä»¥ä¸‹å®‰å…¨åŠŸèƒ½ï¼š

#### ğŸ›¡ï¸ helmet
- è®¾ç½®å®‰å…¨ HTTP å¤´éƒ¨
- é˜²æ­¢å¸¸è§ Web æ¼æ´
- XSS å’Œç‚¹å‡»åŠ«æŒä¿æŠ¤

#### ğŸš¦ express-rate-limit  
- è¯·æ±‚é¢‘ç‡é™åˆ¶ï¼š15åˆ†é’Ÿå†…æœ€å¤š100æ¬¡è¯·æ±‚
- é˜²æ­¢æš´åŠ›æ”»å‡»å’ŒAPIæ»¥ç”¨
- è‡ªå®šä¹‰é”™è¯¯å“åº”

#### ğŸ” dotenv
- ç¯å¢ƒå˜é‡ç®¡ç†
- æ•æ„Ÿé…ç½®éš”ç¦»
- å¼€å‘/ç”Ÿäº§ç¯å¢ƒåŒºåˆ†

#### ğŸŒ CORS
- è·¨åŸŸè¯·æ±‚æ”¯æŒ
- å‰ç«¯è®¿é—®æˆæƒ
- é¢„æ£€è¯·æ±‚å¤„ç†

### è®¤è¯è·¯ç”±å®ç°
åˆ›å»ºäº†å®Œæ•´çš„è®¤è¯ç³»ç»Ÿï¼š
- ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
- JWT token ç”Ÿæˆå’ŒéªŒè¯
- å¯†ç  bcrypt åŠ å¯†
- è¯·æ±‚æ—¥å¿—è®°å½•

---

## 2025-06-11 åˆå§‹é¡¹ç›®è®¾ç½®

### åˆ›å»ºæ ¸å¿ƒæ–‡ä»¶

#### ğŸ“„ server.js (480B, 16è¡Œ)
- Express æœåŠ¡å™¨å…¥å£æ–‡ä»¶
- ç«¯å£é…ç½® (3000)
- åŸºæœ¬é”™è¯¯å¤„ç†

#### ğŸ“„ src/app.js
- Express åº”ç”¨ä¸»é…ç½®
- ä¸­é—´ä»¶è®¾ç½®ï¼ˆJSONè§£æã€CORSã€æ—¥å¿—ï¼‰
- è·¯ç”±é…ç½®
- å…¨å±€é”™è¯¯å¤„ç†

#### ğŸ“¦ package.json æ›´æ–°
æ·»åŠ äº†æ–°çš„è„šæœ¬å’Œä¾èµ–ï¼š

**è„šæœ¬**:
- `start`: `node server.js` - ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
- `dev`: `nodemon server.js` - å¼€å‘ç¯å¢ƒçƒ­é‡è½½

**æ–°å¢ä¾èµ–**:
- `morgan`: HTTPè¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶
- `helmet`: å®‰å…¨å¤´éƒ¨ä¸­é—´ä»¶
- `express-rate-limit`: APIé™æµä¸­é—´ä»¶
- `dotenv`: ç¯å¢ƒå˜é‡ç®¡ç†

### åº”ç”¨é…ç½®
- è¯·æ±‚ä½“å¤§å°é™åˆ¶ï¼š10MB
- CORS è·¨åŸŸæ”¯æŒ
- è¯·æ±‚æ—¥å¿—è®°å½•
- å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼š`/health`

### é¡¹ç›®ç»“æ„å»ºç«‹
ç¡®ç«‹äº†æ ‡å‡†çš„ Express é¡¹ç›®ç»“æ„ï¼š
```
src/
  â”œâ”€â”€ controllers/  # ä¸šåŠ¡é€»è¾‘æ§åˆ¶å™¨
  â”œâ”€â”€ middleware/   # è‡ªå®šä¹‰ä¸­é—´ä»¶
  â”œâ”€â”€ models/       # æ•°æ®æ¨¡å‹
  â”œâ”€â”€ routes/       # è·¯ç”±å®šä¹‰
  â””â”€â”€ utils/        # å·¥å…·å‡½æ•°
``` 

## 2024-06-11 - åˆ é™¤è´¦å·åŠŸèƒ½å®ç°

### ğŸ“‹ åŠŸèƒ½æ¦‚è¿°
å®ç°äº†ç”¨æˆ·è´¦å·è½¯åˆ é™¤åŠŸèƒ½ï¼Œæ”¯æŒç”¨æˆ·ä¸»åŠ¨åˆ é™¤è‡ªå·±çš„è´¦å·ï¼Œåˆ é™¤åæ•°æ®ä¿ç•™ä½†æ— æ³•è®¿é—®ã€‚

### ğŸ¯ åŠŸèƒ½ç‰¹æ€§
- **è½¯åˆ é™¤æœºåˆ¶**: è´¦å·æ ‡è®°ä¸ºå·²åˆ é™¤ï¼Œæ•°æ®ä¿ç•™
- **ç¡®è®¤éªŒè¯**: ç”¨æˆ·éœ€è¾“å…¥åŒ…å«"æˆ‘ç¡®è®¤"çš„æ–‡æœ¬è¿›è¡Œç¡®è®¤
- **Tokenå¤±æ•ˆ**: åˆ é™¤åç«‹å³ä½¿æ‰€æœ‰ç›¸å…³JWT tokenå¤±æ•ˆ
- **å®‰å…¨é˜²æŠ¤**: é˜²æ­¢é‡å¤åˆ é™¤ï¼ŒéªŒè¯ç”¨æˆ·èº«ä»½

### ğŸ”§ æŠ€æœ¯å®ç°

#### 1. æ•°æ®æ¨¡å‹æ›´æ–° (`src/models/User.js`)
- **æ–°å¢å­—æ®µ**:
  - `isDeleted`: å¸ƒå°”å€¼ï¼Œæ ‡è®°ç”¨æˆ·æ˜¯å¦å·²åˆ é™¤
  - `deletedAt`: æ—¶é—´æˆ³ï¼Œè®°å½•åˆ é™¤æ—¶é—´
- **æ–°å¢æ–¹æ³•**:
  - `findByIdIncludeDeleted()`: æŸ¥æ‰¾ç”¨æˆ·ï¼ˆåŒ…å«å·²åˆ é™¤ï¼‰
  - `softDelete()`: æ‰§è¡Œè½¯åˆ é™¤æ“ä½œ
- **ä¿®æ”¹ç°æœ‰æ–¹æ³•**: æ‰€æœ‰æŸ¥æ‰¾æ–¹æ³•é»˜è®¤æ’é™¤å·²åˆ é™¤ç”¨æˆ·

#### 2. JWTé»‘åå•æœºåˆ¶ (`src/utils/tokenBlacklist.js`)
- **åŠŸèƒ½**: ç®¡ç†å¤±æ•ˆçš„JWT token
- **ç‰¹æ€§**:
  - å•ä¸ªtokené»‘åå•ç®¡ç†
  - ç”¨æˆ·tokenæ‰¹é‡å¤±æ•ˆ
  - é»‘åå•æ£€æŸ¥å’Œç»Ÿè®¡
- **å­˜å‚¨**: å†…å­˜å­˜å‚¨ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨Redisï¼‰

#### 3. è®¤è¯ä¸­é—´ä»¶å¢å¼º (`src/middleware/auth.js`)
- **æ–°å¢æ£€æŸ¥**:
  - Tokené»‘åå•éªŒè¯
  - å·²åˆ é™¤ç”¨æˆ·æ£€æµ‹
  - è‡ªåŠ¨tokenè®°å½•å’Œå¤±æ•ˆ
- **å®‰å…¨æå‡**: å·²åˆ é™¤ç”¨æˆ·æ— æ³•è®¿é—®ä»»ä½•éœ€è¦è®¤è¯çš„API

#### 4. åˆ é™¤è´¦å·API (`src/controllers/authController.js`)
- **ç«¯ç‚¹**: `DELETE /api/auth/account`
- **éªŒè¯é€»è¾‘**:
  - ç¡®è®¤æ–‡æœ¬åŒ…å«"æˆ‘ç¡®è®¤"
  - ç”¨æˆ·èº«ä»½éªŒè¯
  - é˜²æ­¢é‡å¤åˆ é™¤
- **æ‰§è¡Œæµç¨‹**:
  1. éªŒè¯ç¡®è®¤æ–‡æœ¬
  2. æ‰§è¡Œè½¯åˆ é™¤
  3. æ‰¹é‡å¤±æ•ˆç”¨æˆ·token
  4. è®°å½•æ“ä½œæ—¥å¿—

#### 5. è·¯ç”±é…ç½® (`src/routes/auth.js`)
- æ·»åŠ  `DELETE /account` è·¯ç”±
- éœ€è¦è®¤è¯ä¸­é—´ä»¶ä¿æŠ¤

### ğŸ“š APIæ–‡æ¡£æ›´æ–° (`docs/API.md`)
- **æ–°å¢ç« èŠ‚**: åˆ é™¤è´¦å·APIæ–‡æ¡£
- **æ›´æ–°å†…å®¹**:
  - è¯·æ±‚æ ¼å¼å’Œå“åº”ç¤ºä¾‹
  - é”™è¯¯å¤„ç†è¯´æ˜
  - å®‰å…¨æ³¨æ„äº‹é¡¹
  - æµ‹è¯•å‘½ä»¤ç¤ºä¾‹
- **è·¯ç”±åˆ—è¡¨**: æ›´æ–°å¯ç”¨è·¯ç”±åˆ—è¡¨

### ğŸ§ª æµ‹è¯•è¦ç‚¹
1. **æ­£å¸¸åˆ é™¤æµç¨‹**:
   ```bash
   curl -X DELETE http://localhost:3000/api/auth/account \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"confirmationText":"æˆ‘ç¡®è®¤"}'
   ```

2. **é”™è¯¯åœºæ™¯æµ‹è¯•**:
   - ç¡®è®¤æ–‡æœ¬é”™è¯¯
   - é‡å¤åˆ é™¤
   - æ— æ•ˆtoken
   - å·²åˆ é™¤ç”¨æˆ·è®¿é—®

3. **Tokenå¤±æ•ˆéªŒè¯**:
   - åˆ é™¤åä½¿ç”¨åŸtokenè®¿é—®APIåº”è¿”å›401
   - å·²åˆ é™¤ç”¨æˆ·æ— æ³•ç™»å½•

### âœ… æµ‹è¯•ç»“æœéªŒè¯

#### å®Œæ•´åŠŸèƒ½æµ‹è¯• (2024-06-12)
1. **ç”¨æˆ·æ³¨å†Œ**: âœ… æˆåŠŸæ³¨å†Œç”¨æˆ· `final-test@example.com`
2. **ç”¨æˆ·ç™»å½•**: âœ… æˆåŠŸè·å–JWT token
3. **è®¿é—®éªŒè¯**: âœ… ä½¿ç”¨tokenæˆåŠŸè®¿é—®ç”¨æˆ·ä¿¡æ¯
4. **é”™è¯¯ç¡®è®¤æ–‡æœ¬**: âœ… æ­£ç¡®æ‹’ç» "æˆ‘ä¸ç¡®è®¤" æ–‡æœ¬
5. **æ­£ç¡®åˆ é™¤**: âœ… æˆåŠŸåˆ é™¤è´¦å·ï¼Œè¿”å›åˆ é™¤æ—¶é—´æˆ³
6. **Tokenå¤±æ•ˆ**: âœ… åˆ é™¤åtokenç«‹å³å¤±æ•ˆï¼Œè¿”å› "ä»¤ç‰Œå·²å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•"
7. **ç”¨æˆ·åˆ—è¡¨**: âœ… å·²åˆ é™¤ç”¨æˆ·ä¸åœ¨ç”¨æˆ·åˆ—è¡¨ä¸­ (total: 0)
8. **ç™»å½•é˜»æ­¢**: âœ… å·²åˆ é™¤ç”¨æˆ·æ— æ³•é‡æ–°ç™»å½•ï¼Œè¿”å› "é‚®ç®±æˆ–å¯†ç é”™è¯¯"

#### æ—¥å¿—è¾“å‡ºéªŒè¯
- ğŸ—‘ï¸ åˆ é™¤è¯·æ±‚æ­£ç¡®è®°å½•ç”¨æˆ·ID
- ğŸš« Tokené»‘åå•æœºåˆ¶æ­£å¸¸å·¥ä½œ
- âœ… åˆ é™¤æˆåŠŸæ—¥å¿—åŒ…å«é‚®ç®±å’Œæ—¶é—´æˆ³
- ğŸ“Š åˆ é™¤æ—¶é—´æ­£ç¡®è®°å½•

#### APIè·¯ç”±æ›´æ–°
- âœ… `/api/debug/routes` æ­£ç¡®æ˜¾ç¤º `DELETE /api/auth/account`
- âœ… è·¯ç”±åˆ—è¡¨å®Œæ•´ä¸”æœ‰åº

### ğŸ”’ å®‰å…¨è€ƒè™‘
- **è½¯åˆ é™¤**: æ•°æ®ä¿ç•™ï¼Œç¬¦åˆæ•°æ®ä¿æŠ¤è¦æ±‚
- **Tokenå¤±æ•ˆ**: é˜²æ­¢åˆ é™¤åçš„æœªæˆæƒè®¿é—®
- **ç¡®è®¤æœºåˆ¶**: é˜²æ­¢è¯¯æ“ä½œ
- **æ—¥å¿—è®°å½•**: å®Œæ•´çš„æ“ä½œå®¡è®¡

### ğŸ“Š æ•°æ®å½±å“
- **ç”¨æˆ·æ•°æ®**: ä¿ç•™ä½†æ ‡è®°ä¸ºå·²åˆ é™¤
- **å…³è”æ•°æ®**: æ”¯å‡ºè®°å½•å’Œé¢„ç®—æ•°æ®ä¿ç•™
- **è®¿é—®æ§åˆ¶**: å·²åˆ é™¤ç”¨æˆ·æ— æ³•è®¿é—®ä»»ä½•æ•°æ®

### ğŸš€ éƒ¨ç½²æ³¨æ„äº‹é¡¹
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨Rediså­˜å‚¨tokené»‘åå•
- è€ƒè™‘å®šæœŸæ¸…ç†è¿‡æœŸçš„é»‘åå•token
- ç›‘æ§åˆ é™¤æ“ä½œçš„é¢‘ç‡å’Œæ¨¡å¼

---

## 2024-06-12 - åç«¯åŠŸèƒ½å®Œå–„ä¸æ–°åŠŸèƒ½å¼€å‘

### ğŸ“‹ å¼€å‘æ¦‚è¿°
åŸºäºç°æœ‰é¡¹ç›®è¿›åº¦ï¼Œå®Œå–„äº†åç«¯åŠŸèƒ½å¹¶æ·»åŠ äº†å¤šä¸ªå®ç”¨çš„æ–°åŠŸèƒ½ï¼ŒåŒ…æ‹¬é¢„ç®—ç®¡ç†å¢å¼ºã€æ•°æ®å¯¼å‡ºã€è¶‹åŠ¿åˆ†æç­‰ã€‚

### ğŸ¯ æ–°å¢åŠŸèƒ½

#### 1. é¢„ç®—ç®¡ç†åŠŸèƒ½å®Œå–„

##### ğŸ“Š é¢„ç®—æé†’å’Œé¢„è­¦ç³»ç»Ÿ (`src/controllers/budgetController.js`)
- **ç«¯ç‚¹**: `GET /api/budget/alerts`
- **åŠŸèƒ½ç‰¹æ€§**:
  - æ™ºèƒ½é¢„ç®—ä½¿ç”¨ç‡æé†’ï¼ˆ50%ã€75%ã€90%ã€100%é˜ˆå€¼ï¼‰
  - æœˆæœ«é¢„ç®—æé†’ï¼ˆå‰©ä½™å¤©æ•°â‰¤7å¤©ï¼‰
  - æ”¯å‡ºè¶‹åŠ¿é¢„è­¦ï¼ˆåŸºäºæœ€è¿‘7å¤©æ•°æ®é¢„æµ‹ï¼‰
  - å¤šçº§åˆ«è­¦å‘Šç³»ç»Ÿï¼ˆinfoã€warningã€dangerï¼‰
- **å“åº”æ•°æ®**:
  - æé†’åˆ—è¡¨ï¼ˆç±»å‹ã€çº§åˆ«ã€æ ‡é¢˜ã€æ¶ˆæ¯ã€å›¾æ ‡ï¼‰
  - é¢„ç®—ä½¿ç”¨æ‘˜è¦ï¼ˆé‡‘é¢ã€ä½¿ç”¨ç‡ã€å‰©ä½™å¤©æ•°ã€æ—¥å‡æ”¯å‡ºï¼‰

##### ğŸ’¡ æ™ºèƒ½é¢„ç®—å»ºè®®ç³»ç»Ÿ
- **ç«¯ç‚¹**: `GET /api/budget/suggestions`
- **åŠŸèƒ½ç‰¹æ€§**:
  - åŸºäºå†å²æ•°æ®çš„é¢„ç®—å»ºè®®ï¼ˆå¹³å‡æ”¯å‡º+10%ç¼“å†²ï¼‰
  - æ”¯å‡ºåˆ†ç±»åˆ†æï¼ˆæœ€é«˜æ”¯å‡ºç±»åˆ«è¯†åˆ«ï¼‰
  - ä¸ªæ€§åŒ–èŠ‚çœå»ºè®®ï¼ˆæ—¥æ”¯å‡ºé™é¢å»ºè®®ï¼‰
  - æ–°ç”¨æˆ·å¼•å¯¼å»ºè®®
- **ç®—æ³•é€»è¾‘**:
  - è®¡ç®—å†å²æœˆå‡æ”¯å‡º
  - åˆ†ææ”¯å‡ºåˆ†ç±»å æ¯”
  - ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®

##### ğŸ“ˆ é¢„ç®—å†å²ç®¡ç†
- **ç«¯ç‚¹**: `GET /api/budget/history` - è·å–æ‰€æœ‰é¢„ç®—å†å²
- **ç«¯ç‚¹**: `GET /api/budget/:year/:month` - è·å–æŒ‡å®šæœˆä»½é¢„ç®—
- **ç«¯ç‚¹**: `DELETE /api/budget/:budgetId` - åˆ é™¤é¢„ç®—è®°å½•

#### 2. æ”¯å‡ºæ•°æ®å¯¼å‡ºåŠŸèƒ½

##### ğŸ“¤ å¤šæ ¼å¼æ•°æ®å¯¼å‡º (`src/controllers/expenseController.js`)
- **ç«¯ç‚¹**: `GET /api/expense/export`
- **æ”¯æŒæ ¼å¼**:
  - **JSONæ ¼å¼**: ç»“æ„åŒ–æ•°æ®ï¼ŒåŒ…å«å¯¼å‡ºä¿¡æ¯å’Œå®Œæ•´è®°å½•
  - **CSVæ ¼å¼**: è¡¨æ ¼æ•°æ®ï¼Œæ”¯æŒä¸­æ–‡ï¼ˆUTF-8 BOMï¼‰
- **ç­›é€‰é€‰é¡¹**:
  - æ—¶é—´èŒƒå›´ç­›é€‰ï¼ˆstartDateã€endDateï¼‰
  - åˆ†ç±»ç­›é€‰ï¼ˆcategoryï¼‰
  - ä¸‹è½½æ¨¡å¼ï¼ˆdownload=trueæ—¶ä½œä¸ºæ–‡ä»¶ä¸‹è½½ï¼‰
- **CSVç‰¹æ€§**:
  - ä¸­æ–‡å­—æ®µåï¼ˆIDã€é‡‘é¢ã€åˆ†ç±»ã€æè¿°ç­‰ï¼‰
  - æ­£ç¡®å¤„ç†CSVä¸­çš„å¼•å·è½¬ä¹‰
  - æ”¯æŒä¸­æ–‡æ˜¾ç¤ºï¼ˆæ·»åŠ BOMï¼‰

#### 3. æ”¯å‡ºè¶‹åŠ¿åˆ†æ

##### ğŸ“ˆ å¤šç»´åº¦è¶‹åŠ¿åˆ†æ
- **ç«¯ç‚¹**: `GET /api/expense/trends`
- **åˆ†æç»´åº¦**:
  - **æŒ‰å¤©ç»Ÿè®¡**: æ—¥æœŸæ ¼å¼ YYYY-MM-DD
  - **æŒ‰å‘¨ç»Ÿè®¡**: å‘¨èµ·å§‹æ—¥æœŸ
  - **æŒ‰æœˆç»Ÿè®¡**: æœˆä»½æ ¼å¼ YYYY-MM
- **åˆ†ææŒ‡æ ‡**:
  - å„æ—¶é—´æ®µæ€»é‡‘é¢å’Œè®°å½•æ•°
  - åˆ†ç±»æ”¯å‡ºåˆ†å¸ƒ
  - è¶‹åŠ¿åˆ†æï¼ˆå¹³å‡å€¼ã€æœ€é«˜/æœ€ä½æœŸé—´ï¼‰
- **æ•°æ®å¤„ç†**:
  - è‡ªåŠ¨æ—¶é—´åˆ†ç»„
  - æ”¯æŒé™åˆ¶è¿”å›æœŸé—´æ•°é‡
  - æ™ºèƒ½æ’åºï¼ˆæœ€æ–°åœ¨å‰ï¼‰

### ğŸ”§ è·¯ç”±ç³»ç»Ÿå®Œå–„

#### é¢„ç®—è·¯ç”±æ›´æ–° (`src/routes/budget.js`)
```javascript
// æ–°å¢è·¯ç”±
router.get('/alerts', getBudgetAlerts);           // é¢„ç®—æé†’
router.get('/suggestions', getBudgetSuggestions); // é¢„ç®—å»ºè®®
router.get('/history', getAllBudgets);            // é¢„ç®—å†å²
router.get('/:year/:month', getBudgetByMonth);    // æŒ‡å®šæœˆä»½é¢„ç®—
router.delete('/:budgetId', deleteBudget);        // åˆ é™¤é¢„ç®—
```

#### æ”¯å‡ºè·¯ç”±æ›´æ–° (`src/routes/expense.js`)
```javascript
// æ–°å¢è·¯ç”±
router.get('/export', exportExpenses);      // æ•°æ®å¯¼å‡º
router.get('/trends', getExpenseTrends);    // è¶‹åŠ¿åˆ†æ
// ä¿®æ­£è·¯ç”±å‚æ•°
router.get('/:id', getExpenseById);         // è·å–å•ä¸ªè®°å½•
router.put('/:id', updateExpense);          // æ›´æ–°è®°å½•
router.delete('/:id', deleteExpense);       // åˆ é™¤è®°å½•
```

### ğŸ“š APIæ–‡æ¡£å…¨é¢æ›´æ–° (`docs/API.md`)

#### æ–°å¢æ–‡æ¡£ç« èŠ‚
1. **é¢„ç®—æé†’å’Œé¢„è­¦API**:
   - è¯¦ç»†çš„å“åº”æ ¼å¼è¯´æ˜
   - æé†’ç±»å‹å’Œçº§åˆ«è¯´æ˜
   - ä½¿ç”¨ç¤ºä¾‹å’Œåœºæ™¯

2. **é¢„ç®—å»ºè®®API**:
   - å»ºè®®ç®—æ³•è¯´æ˜
   - å“åº”æ•°æ®ç»“æ„
   - ä¸ªæ€§åŒ–å»ºè®®ç±»å‹

3. **æ•°æ®å¯¼å‡ºAPI**:
   - JSONå’ŒCSVæ ¼å¼å¯¹æ¯”
   - æŸ¥è¯¢å‚æ•°è¯¦è§£
   - ä¸‹è½½æ¨¡å¼è¯´æ˜

4. **è¶‹åŠ¿åˆ†æAPI**:
   - æ—¶é—´ç»´åº¦è¯´æ˜
   - åˆ†ææŒ‡æ ‡è§£é‡Š
   - å“åº”æ•°æ®ç»“æ„

#### è·¯ç”±åˆ—è¡¨æ›´æ–°
æ›´æ–°äº† `/api/debug/routes` è¿”å›çš„è·¯ç”±åˆ—è¡¨ï¼ŒåŒ…å«æ‰€æœ‰æ–°å¢ç«¯ç‚¹ï¼š
- é¢„ç®—ç›¸å…³ï¼š7ä¸ªç«¯ç‚¹
- æ”¯å‡ºç›¸å…³ï¼š9ä¸ªç«¯ç‚¹
- è®¤è¯ç›¸å…³ï¼š5ä¸ªç«¯ç‚¹

### ğŸ§ª åŠŸèƒ½æµ‹è¯•éªŒè¯

#### å®Œæ•´æµ‹è¯•æµç¨‹ (2024-06-12)
1. **æœåŠ¡å™¨é‡å¯**: âœ… æˆåŠŸåŠ è½½æ–°è·¯ç”±é…ç½®
2. **ç”¨æˆ·æ³¨å†Œ**: âœ… æ³¨å†Œç”¨æˆ· `test-new@example.com`
3. **é¢„ç®—è®¾ç½®**: âœ… è®¾ç½®æœˆé¢„ç®— Â¥3000
4. **æ”¯å‡ºè®°å½•**: âœ… åˆ›å»ºæ”¯å‡ºè®°å½• Â¥200ï¼ˆé¤é¥®ï¼‰
5. **é¢„ç®—æé†’**: âœ… è·å–é¢„ç®—ä½¿ç”¨æ‘˜è¦ï¼ˆ6.67%ä½¿ç”¨ç‡ï¼‰
6. **é¢„ç®—å»ºè®®**: âœ… è·å–ä¸ªæ€§åŒ–å»ºè®®ï¼ˆå»ºè®®é¢„ç®—Â¥221ï¼‰
7. **è¶‹åŠ¿åˆ†æ**: âœ… è·å–æœˆåº¦è¶‹åŠ¿æ•°æ®
8. **æ•°æ®å¯¼å‡º**: âœ… JSONæ ¼å¼å¯¼å‡ºæˆåŠŸ

#### æµ‹è¯•ç»“æœ
- **é¢„ç®—æé†’**: æ­£ç¡®è®¡ç®—ä½¿ç”¨ç‡ã€å‰©ä½™å¤©æ•°ã€æ—¥å‡æ”¯å‡º
- **é¢„ç®—å»ºè®®**: åŸºäºå†å²æ•°æ®ç”Ÿæˆåˆç†å»ºè®®
- **è¶‹åŠ¿åˆ†æ**: æ­£ç¡®æŒ‰æœˆåˆ†ç»„ç»Ÿè®¡
- **æ•°æ®å¯¼å‡º**: åŒ…å«å®Œæ•´çš„å¯¼å‡ºä¿¡æ¯å’Œè®°å½•

### ğŸ—ï¸ æ¶æ„æ”¹è¿›

#### ä»£ç ç»„ç»‡ä¼˜åŒ–
- **æ§åˆ¶å™¨æ‰©å±•**: åœ¨ç°æœ‰æ§åˆ¶å™¨ä¸­æ·»åŠ æ–°åŠŸèƒ½ï¼Œä¿æŒä»£ç ç»„ç»‡æ¸…æ™°
- **è·¯ç”±é‡æ„**: ç»Ÿä¸€è·¯ç”±å‚æ•°å‘½åï¼ˆ:id æ›¿ä»£ :expenseIdï¼‰
- **åŠŸèƒ½æ¨¡å—åŒ–**: æ¯ä¸ªæ–°åŠŸèƒ½ç‹¬ç«‹å®ç°ï¼Œä¾¿äºç»´æŠ¤

#### æ•°æ®å¤„ç†å¢å¼º
- **æ—¶é—´å¤„ç†**: ç»Ÿä¸€çš„æ—¥æœŸæ ¼å¼åŒ–å’Œæ—¶é—´åˆ†ç»„é€»è¾‘
- **æ•°æ®ç»Ÿè®¡**: é«˜æ•ˆçš„å†…å­˜æ•°æ®ç»Ÿè®¡ç®—æ³•
- **æ ¼å¼è½¬æ¢**: æ”¯æŒå¤šç§æ•°æ®å¯¼å‡ºæ ¼å¼

### ğŸ“Š æ€§èƒ½è€ƒè™‘

#### å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- **æ•°æ®ç­›é€‰**: åœ¨æ•°æ®æºå±‚é¢è¿›è¡Œç­›é€‰ï¼Œå‡å°‘å†…å­˜å ç”¨
- **åˆ†é¡µæ”¯æŒ**: è¶‹åŠ¿åˆ†ææ”¯æŒé™åˆ¶è¿”å›æ•°é‡
- **ç¼“å­˜ç­–ç•¥**: ç»Ÿè®¡æ•°æ®å¯è€ƒè™‘ç¼“å­˜ï¼ˆæœªæ¥ä¼˜åŒ–ï¼‰

#### å“åº”æ—¶é—´ä¼˜åŒ–
- **å¹¶è¡Œå¤„ç†**: å¤šä¸ªç»Ÿè®¡æŸ¥è¯¢å¯å¹¶è¡Œæ‰§è¡Œ
- **æ•°æ®é¢„å¤„ç†**: å‡å°‘é‡å¤è®¡ç®—
- **ç´¢å¼•ä¼˜åŒ–**: ä¸ºæœªæ¥æ•°æ®åº“è¿ç§»é¢„ç•™ä¼˜åŒ–ç©ºé—´

### ğŸ”’ å®‰å…¨æ€§å¢å¼º

#### æ•°æ®è®¿é—®æ§åˆ¶
- **ç”¨æˆ·éš”ç¦»**: æ‰€æœ‰æ–°åŠŸèƒ½éƒ½ä¸¥æ ¼æŒ‰ç”¨æˆ·IDéš”ç¦»æ•°æ®
- **è®¤è¯éªŒè¯**: æ‰€æœ‰ç«¯ç‚¹éƒ½éœ€è¦JWTè®¤è¯
- **å‚æ•°éªŒè¯**: å¯¹æ‰€æœ‰è¾“å…¥å‚æ•°è¿›è¡ŒéªŒè¯

#### é”™è¯¯å¤„ç†
- **ç»Ÿä¸€é”™è¯¯æ ¼å¼**: ä¿æŒä¸ç°æœ‰APIçš„é”™è¯¯å“åº”æ ¼å¼ä¸€è‡´
- **è¯¦ç»†æ—¥å¿—**: æ·»åŠ è¯¦ç»†çš„æ“ä½œæ—¥å¿—ç”¨äºè°ƒè¯•
- **å¼‚å¸¸æ•è·**: å®Œå–„çš„try-catché”™è¯¯å¤„ç†

### ğŸš€ éƒ¨ç½²å°±ç»ª

#### ç”Ÿäº§ç¯å¢ƒè€ƒè™‘
- **é…ç½®ç®¡ç†**: æ‰€æœ‰åŠŸèƒ½ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®
- **æ—¥å¿—è®°å½•**: è¯¦ç»†çš„æ“ä½œæ—¥å¿—ä¾¿äºç›‘æ§
- **é”™è¯¯ç›‘æ§**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œä¸ŠæŠ¥

#### æ‰©å±•æ€§è®¾è®¡
- **æ•°æ®åº“è¿ç§»**: ä»£ç ç»“æ„ä¾¿äºè¿ç§»åˆ°çœŸå®æ•°æ®åº“
- **ç¼“å­˜é›†æˆ**: é¢„ç•™Redisç¼“å­˜é›†æˆæ¥å£
- **å¾®æœåŠ¡æ‹†åˆ†**: åŠŸèƒ½æ¨¡å—åŒ–ä¾¿äºæœªæ¥æ‹†åˆ†

### ğŸ“ˆ åŠŸèƒ½ç»Ÿè®¡

#### æ–°å¢APIç«¯ç‚¹
- **é¢„ç®—ç®¡ç†**: 5ä¸ªæ–°ç«¯ç‚¹
- **æ”¯å‡ºç®¡ç†**: 2ä¸ªæ–°ç«¯ç‚¹
- **æ€»è®¡**: 7ä¸ªæ–°åŠŸèƒ½ç«¯ç‚¹

#### ä»£ç å˜æ›´ç»Ÿè®¡
- **æ–°å¢ä»£ç **: çº¦500è¡Œ
- **ä¿®æ”¹æ–‡ä»¶**: 6ä¸ªæ–‡ä»¶
- **æ–‡æ¡£æ›´æ–°**: çº¦200è¡ŒAPIæ–‡æ¡£

#### åŠŸèƒ½è¦†ç›–åº¦
- **é¢„ç®—ç®¡ç†**: 100%å®Œæ•´åŠŸèƒ½ï¼ˆCRUD + åˆ†æï¼‰
- **æ”¯å‡ºç®¡ç†**: 100%å®Œæ•´åŠŸèƒ½ï¼ˆCRUD + ç»Ÿè®¡ + å¯¼å‡ºï¼‰
- **ç”¨æˆ·ç®¡ç†**: 100%å®Œæ•´åŠŸèƒ½ï¼ˆè®¤è¯ + è´¦å·ç®¡ç†ï¼‰

### ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

#### å‰ç«¯å¼€å‘å‡†å¤‡
- âœ… åç«¯APIå®Œæ•´å®ç°
- âœ… APIæ–‡æ¡£è¯¦ç»†å®Œå–„
- âœ… æµ‹è¯•éªŒè¯é€šè¿‡
- ğŸ”„ ç­‰å¾…å‰ç«¯é¡¹ç›®å¼€å‘

#### æ½œåœ¨ä¼˜åŒ–æ–¹å‘
- æ•°æ®åº“é›†æˆï¼ˆPostgreSQL/MySQLï¼‰
- Redisç¼“å­˜å±‚
- æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- æ•°æ®å¤‡ä»½å’Œæ¢å¤
- APIæ€§èƒ½ç›‘æ§

--- 

## 2024-xx-xxï¼ˆSupabaseé›†æˆæ—¥æœŸï¼‰

### æ·»åŠ çš„æ–‡ä»¶
- åˆ›å»ºäº† `.env.example` æ–‡ä»¶ï¼Œæä¾›ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹

### ä¿®æ”¹çš„æ–‡ä»¶
- æ›´æ–°äº† `src/utils/supabase.js`ï¼š
  - æ·»åŠ äº†service_role keyçš„é»˜è®¤å€¼
  - ç¡®ä¿supabaseAdminå®¢æˆ·ç«¯å§‹ç»ˆåˆ›å»ºï¼Œä¸å†ä½¿ç”¨æ¡ä»¶åˆ¤æ–­
- æ›´æ–°äº† `src/models/User.js`ï¼š
  - å®Œå…¨é‡å†™ï¼Œä½¿ç”¨Supabaseè¿›è¡Œç”¨æˆ·è®¤è¯å’Œç®¡ç†
  - ç§»é™¤äº†å†…å­˜å­˜å‚¨ï¼Œæ”¹ä¸ºä½¿ç”¨Supabaseæ•°æ®åº“
  - æ·»åŠ äº†ä¸Supabase Auth APIäº¤äº’çš„æ–¹æ³•
  - å®ç°äº†ç”¨æˆ·çš„CRUDæ“ä½œ
- æ›´æ–°äº† `src/controllers/authController.js`ï¼š
  - ä¿®æ”¹äº†ç”¨æˆ·æ³¨å†Œå’Œç™»å½•é€»è¾‘ï¼Œä½¿ç”¨Supabase Auth
  - æ›´æ–°äº†é”™è¯¯å¤„ç†ï¼Œæ·»åŠ äº†å¼€å‘ç¯å¢ƒçš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
  - é‡æ„äº†ç”¨æˆ·åˆ é™¤åŠŸèƒ½ï¼Œä½¿ç”¨Supabase Admin API
- æ›´æ–°äº† `src/middleware/auth.js`ï¼š
  - ä¿®æ”¹äº†JWTéªŒè¯é€»è¾‘ï¼Œä½¿ç”¨Supabase Auth API
  - æ”¹ä¸ºå¼‚æ­¥ä¸­é—´ä»¶å‡½æ•°
  - æ·»åŠ äº†æ›´è¯¦ç»†çš„é”™è¯¯å¤„ç†
- æ›´æ–°äº† `src/utils/tokenBlacklist.js`ï¼š
  - æ·»åŠ äº†`invalidateAllUserTokens`æ–¹æ³•
  - æ›´æ–°äº†userIdç±»å‹æ³¨é‡Šä»numberæ”¹ä¸ºstring
- æ›´æ–°äº† `package.json`ï¼š
  - æ·»åŠ äº†é¡¹ç›®åç§°ã€ç‰ˆæœ¬å’Œæè¿°
  - æ·»åŠ äº†expressã€corsã€helmetç­‰å¿…è¦ä¾èµ–
  - æ·»åŠ äº†nodemonå¼€å‘ä¾èµ–
- æ›´æ–°äº† `docs/API.md`ï¼š
  - æ·»åŠ äº†Supabaseé›†æˆç« èŠ‚
  - æ›´æ–°äº†è®¤è¯æ–¹å¼è¯´æ˜
  - æ·»åŠ äº†æ•°æ®åº“è¡¨ç»“æ„è¯´æ˜
  - æ·»åŠ äº†iOSå®¢æˆ·ç«¯é›†æˆæŒ‡å—
  - æ·»åŠ äº†å®‰å…¨æ³¨æ„äº‹é¡¹

### æ¶æ„å˜æ›´
- ä»å†…å­˜å­˜å‚¨æ¨¡å¼è¿ç§»åˆ°Supabaseäº‘æ•°æ®åº“
- ä»è‡ªå®šä¹‰JWTè®¤è¯è¿ç§»åˆ°Supabase Auth
- æ·»åŠ äº†è¡Œçº§å®‰å…¨ç­–ç•¥(RLS)æ”¯æŒ
- æ”¯æŒå®æ—¶æ•°æ®æ›´æ–°

### å®‰å…¨æ”¹è¿›
- ä½¿ç”¨Supabaseçš„è¡Œçº§å®‰å…¨ç­–ç•¥ç¡®ä¿æ•°æ®éš”ç¦»
- æ”¹è¿›äº†ç”¨æˆ·è®¤è¯å’Œæˆæƒæµç¨‹
- æ·»åŠ äº†æ›´è¯¦ç»†çš„å®‰å…¨æŒ‡å—

### iOSå®¢æˆ·ç«¯é›†æˆ
- æ·»åŠ äº†Supabase Swift SDKé›†æˆæŒ‡å—
- æä¾›äº†ç”¨æˆ·è®¤è¯å’Œæ•°æ®æ“ä½œçš„ç¤ºä¾‹ä»£ç 
- æ·»åŠ äº†é…ç½®è¯´æ˜å’Œæœ€ä½³å®è·µ

### æµ‹è¯•ç»“æœ
- âœ… ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… ç”¨æˆ·ç™»å½•åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œè¿”å›æ­£ç¡®çš„Supabase JWTä»¤ç‰Œ
- âœ… ä»¤ç‰ŒéªŒè¯åŠŸèƒ½æ­£å¸¸
- âœ… ç”¨æˆ·åˆ é™¤åŠŸèƒ½æ­£å¸¸
- âœ… æ‰€æœ‰APIéƒ½èƒ½æ­£ç¡®è¿”å›ç¬¦åˆè§„èŒƒçš„JSONæ•°æ®

### æ¨¡å‹è¿ç§»å®Œæˆ (2024-xx-xx)

### ä¿®æ”¹çš„æ–‡ä»¶
- æ›´æ–°äº† `src/models/Budget.js`ï¼š
  - å®Œå…¨é‡å†™ï¼Œä½¿ç”¨Supabaseè¿›è¡Œé¢„ç®—æ•°æ®ç®¡ç†
  - ç§»é™¤äº†å†…å­˜å­˜å‚¨ï¼Œæ”¹ä¸ºä½¿ç”¨Supabaseæ•°æ®åº“
  - æ›´æ–°äº†æ‰€æœ‰æ–¹æ³•ä»¥ä½¿ç”¨Supabase API
  - æ·»åŠ äº†å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
  - æ›´æ–°äº†æ•°æ®åº“å­—æ®µæ˜ å°„ï¼ˆuser_id, created_atç­‰ï¼‰
- æ›´æ–°äº† `src/models/Expense.js`ï¼š
  - å®Œå…¨é‡å†™ï¼Œä½¿ç”¨Supabaseè¿›è¡Œæ”¯å‡ºæ•°æ®ç®¡ç†
  - ç§»é™¤äº†å†…å­˜å­˜å‚¨ï¼Œæ”¹ä¸ºä½¿ç”¨Supabaseæ•°æ®åº“
  - é‡æ„äº†éªŒè¯é€»è¾‘ä¸ºé™æ€æ–¹æ³•
  - æ›´æ–°äº†æŸ¥è¯¢ã€ç»Ÿè®¡å’Œå¯¼å‡ºåŠŸèƒ½
  - æ›´æ–°äº†æ•°æ®åº“å­—æ®µæ˜ å°„ï¼ˆpayment_method, is_recurringç­‰ï¼‰
  - ä¿®æ”¹äº†æ¨¡å—å¯¼å‡ºæ ¼å¼ï¼Œç°åœ¨å¯¼å‡ºå¯¹è±¡åŒ…å«Expenseç±»å’Œå¸¸é‡
- æ›´æ–°äº† `src/controllers/budgetController.js`ï¼š
  - ä¿®æ”¹äº†å¯¼å…¥è¯­å¥ä»¥é€‚åº”æ–°çš„Expenseæ¨¡å‹å¯¼å‡ºæ ¼å¼
- æ›´æ–°äº† `src/controllers/expenseController.js`ï¼š
  - ä¿®æ”¹äº†å¯¼å…¥è¯­å¥ä»¥é€‚åº”æ–°çš„Expenseæ¨¡å‹å¯¼å‡ºæ ¼å¼

### æ¶æ„ç»Ÿä¸€
- æ‰€æœ‰æ•°æ®æ¨¡å‹ç°åœ¨éƒ½ä½¿ç”¨Supabaseæ•°æ®åº“
- ç»Ÿä¸€äº†é”™è¯¯å¤„ç†æ¨¡å¼
- ç»Ÿä¸€äº†æ•°æ®éªŒè¯å’Œæ—¥å¿—è®°å½•
- æ¶ˆé™¤äº†å†…å­˜å­˜å‚¨å’ŒSupabaseæ··ç”¨çš„ä¸ä¸€è‡´æ€§

### æ•°æ®åº“è¡¨ç»“æ„è¦æ±‚
é¡¹ç›®ç°åœ¨éœ€è¦åœ¨Supabaseä¸­åˆ›å»ºä»¥ä¸‹è¡¨ï¼š

#### usersè¡¨ï¼ˆç”±Supabase Authè‡ªåŠ¨ç®¡ç†ï¼‰
```sql
-- auth.usersè¡¨ç”±Supabaseè‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†
```

#### budgetsè¡¨
```sql
CREATE TABLE budgets (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  amount DECIMAL(10,2) NOT NULL,
  year INTEGER NOT NULL,
  month INTEGER NOT NULL CHECK (month >= 1 AND month <= 12),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user_id, year, month)
);

-- RLSç­–ç•¥
ALTER TABLE budgets ENABLE ROW LEVEL SECURITY;
CREATE POLICY "ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„é¢„ç®—" ON budgets FOR ALL USING (auth.uid() = user_id);
```

#### expensesè¡¨
```sql
CREATE TABLE expenses (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  amount DECIMAL(10,2) NOT NULL,
  category TEXT NOT NULL,
  description TEXT NOT NULL,
  date DATE DEFAULT CURRENT_DATE,
  location TEXT,
  payment_method TEXT DEFAULT 'cash',
  is_recurring BOOLEAN DEFAULT FALSE,
  tags TEXT[] DEFAULT '{}',
  notes TEXT DEFAULT '',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- RLSç­–ç•¥
ALTER TABLE expenses ENABLE ROW LEVEL SECURITY;
CREATE POLICY "ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ”¯å‡º" ON expenses FOR ALL USING (auth.uid() = user_id);

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_expenses_user_date ON expenses(user_id, date);
CREATE INDEX idx_expenses_user_category ON expenses(user_id, category);
```

### ç¯å¢ƒå˜é‡é…ç½®
é¡¹ç›®éœ€è¦ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
```env
# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=development

# Supabaseé…ç½®
SUPABASE_URL=https://your-project-ref.supabase.co
SUPABASE_ANON_KEY=your-anon-key-here
SUPABASE_SERVICE_KEY=your-service-role-key-here
```

### éƒ¨ç½²æ³¨æ„äº‹é¡¹
1. ç¡®ä¿åœ¨Supabaseä¸­åˆ›å»ºäº†æ‰€éœ€çš„æ•°æ®è¡¨
2. å¯ç”¨äº†è¡Œçº§å®‰å…¨ç­–ç•¥(RLS)
3. é…ç½®äº†æ­£ç¡®çš„ç¯å¢ƒå˜é‡
4. Supabaseé¡¹ç›®çš„APIè®¿é—®æƒé™å·²æ­£ç¡®è®¾ç½®

### æ•°æ®åº“è¡¨ç»“æ„å®Œå–„ (2024-xx-xx)

### ä¿®æ”¹çš„æ–‡ä»¶
- æ›´æ–°äº† `database/init.sql`ï¼š
  - æ·»åŠ äº† `public.profiles` è¡¨ç”¨äºæ‰©å±•ç”¨æˆ·ä¿¡æ¯
  - åˆ›å»ºäº†è‡ªåŠ¨è§¦å‘å™¨ï¼Œç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨åˆ›å»ºprofileè®°å½•
  - å®Œå–„äº†RLSç­–ç•¥ç¡®ä¿æ•°æ®å®‰å…¨
  - æ·»åŠ äº†å®Œæ•´çš„è¡¨ç»“æ„éªŒè¯æŸ¥è¯¢

### å®Œæ•´çš„é¡¹ç›®æ€»ç»“

#### âœ… å·²å®ŒæˆåŠŸèƒ½
1. **ç”¨æˆ·è®¤è¯ç³»ç»Ÿ**
   - åŸºäºSupabase Authçš„æ³¨å†Œ/ç™»å½•
   - JWTä»¤ç‰ŒéªŒè¯ä¸­é—´ä»¶
   - ç”¨æˆ·èµ„æ–™ç®¡ç†
   - è´¦æˆ·åˆ é™¤åŠŸèƒ½

2. **é¢„ç®—ç®¡ç†ç³»ç»Ÿ**
   - æœˆåº¦é¢„ç®—è®¾ç½®å’Œæ›´æ–°
   - é¢„ç®—ä½¿ç”¨æƒ…å†µè¿½è¸ª
   - é¢„ç®—æé†’å’Œé¢„è­¦
   - æ™ºèƒ½é¢„ç®—å»ºè®®

3. **æ”¯å‡ºè®°å½•ç³»ç»Ÿ**
   - æ”¯å‡ºè®°å½•CRUDæ“ä½œ
   - å¤šç§åˆ†ç±»å’Œæ”¯ä»˜æ–¹å¼
   - æ ‡ç­¾å’Œå¤‡æ³¨æ”¯æŒ
   - ç»Ÿè®¡å’Œè¶‹åŠ¿åˆ†æ
   - æ•°æ®å¯¼å‡ºåŠŸèƒ½

4. **æ•°æ®å®‰å…¨**
   - è¡Œçº§å®‰å…¨ç­–ç•¥(RLS)
   - ç”¨æˆ·æ•°æ®éš”ç¦»
   - è¾“å…¥éªŒè¯å’Œæ¸…ç†
   - APIé€Ÿç‡é™åˆ¶

5. **å¼€å‘ä½“éªŒ**
   - å®Œæ•´çš„APIæ–‡æ¡£
   - è¯¦ç»†çš„é”™è¯¯å¤„ç†
   - å¼€å‘æ—¥å¿—è®°å½•
   - è°ƒè¯•å’Œæµ‹è¯•å·¥å…·

#### ğŸ—ï¸ æ¶æ„ç‰¹ç‚¹
- **æ¨¡å—åŒ–è®¾è®¡**: MVCæ¶æ„æ¨¡å¼
- **äº‘åŸç”Ÿ**: åŸºäºSupabaseçš„ç°ä»£åŒ–æ¶æ„
- **RESTful API**: æ ‡å‡†åŒ–çš„APIè®¾è®¡
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„æ•°æ®éªŒè¯
- **å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œé›†æˆ

#### ğŸ“Š æŠ€æœ¯æŒ‡æ ‡
- **APIç«¯ç‚¹**: 21ä¸ªå®Œæ•´åŠŸèƒ½ç«¯ç‚¹
- **æ•°æ®è¡¨**: 3ä¸ªä¸»è¦ä¸šåŠ¡è¡¨ + 1ä¸ªç”¨æˆ·èµ„æ–™è¡¨
- **ä»£ç æ–‡ä»¶**: 15ä¸ªæ ¸å¿ƒæ–‡ä»¶
- **æ–‡æ¡£**: 4ä¸ªè¯¦ç»†æ–‡æ¡£æ–‡ä»¶
- **å®‰å…¨ç­–ç•¥**: å®Œæ•´çš„RLSå’Œè®¤è¯ä½“ç³»

#### ğŸš€ éƒ¨ç½²å°±ç»ªçŠ¶æ€
- âœ… åç«¯APIå®Œå…¨è¿ç§»åˆ°Supabase
- âœ… æ•°æ®æ¨¡å‹ç»Ÿä¸€ä½¿ç”¨äº‘æ•°æ®åº“  
- âœ… è®¤è¯ç³»ç»Ÿé›†æˆSupabase Auth
- âœ… æ•°æ®åº“è¡¨ç»“æ„å’Œå®‰å…¨ç­–ç•¥å®Œæ•´
- âœ… å®Œæ•´çš„éƒ¨ç½²æ–‡æ¡£å’Œè„šæœ¬
- âœ… ç”Ÿäº§ç¯å¢ƒé…ç½®å°±ç»ª

#### ğŸ”„ ä¸‹ä¸€æ­¥å·¥ä½œ
- å‰ç«¯åº”ç”¨å¼€å‘å’Œé›†æˆ
- ç§»åŠ¨ç«¯åº”ç”¨å¼€å‘
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å’Œç›‘æ§
- æ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜ç­–ç•¥

**é¡¹ç›®çŠ¶æ€**: ğŸ‰ **åç«¯å¼€å‘å®Œæˆï¼Œç”Ÿäº§å°±ç»ªï¼** 

# è´¹ç”¨è¿½è¸ªåº”ç”¨å¼€å‘æ—¥å¿—

## 2025-06-19 - ä¿®å¤æ”¯å‡ºæ•°æ®ä¸¢å¤±é—®é¢˜

### é—®é¢˜æè¿°
ç”¨æˆ·åœ¨iOSåº”ç”¨çš„"æ”¯å‡ºè®°å½•"é¡µé¢æ·»åŠ æ”¯å‡ºè®°å½•åï¼Œé¡µé¢åˆ·æ–°ä½†æ•°æ®æ¶ˆå¤±ï¼ŒåŒ…æ‹¬å†å²æ•°æ®ä¹Ÿä¸æ˜¾ç¤ºã€‚

### é—®é¢˜åˆ†æ
é€šè¿‡è¯¦ç»†è°ƒè¯•å‘ç°è¿™æ˜¯ä¸€ä¸ª**åç«¯æ•°æ®åº“è®¿é—®æƒé™é—®é¢˜**ï¼š

1. **ç—‡çŠ¶**ï¼š
   - æ·»åŠ æ”¯å‡ºåï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢æ˜¾ç¤ºæœ‰æ•°æ®ï¼ˆtotalExpenses: 230ï¼‰
   - éšåæŸ¥è¯¢æ”¯å‡ºåˆ—è¡¨è¿”å›ç©ºæ•°ç»„ `expenses: []`
   - å†æ¬¡æŸ¥è¯¢é¢„ç®—ç»Ÿè®¡æ˜¾ç¤º `totalExpenses: 0`

2. **æ ¹æœ¬åŸå› **ï¼š
   - åç«¯ä½¿ç”¨Supabaseæ•°æ®åº“å­˜å‚¨ï¼Œä½†æ•°æ®åº“è¡¨å¯ç”¨äº†è¡Œçº§å®‰å…¨ç­–ç•¥ï¼ˆRLSï¼‰
   - RLSç­–ç•¥è¦æ±‚ `auth.uid() = user_id` æ‰èƒ½è®¿é—®æ•°æ®
   - åç«¯ä»£ç ä½¿ç”¨åŒ¿åå¯†é’¥ï¼ˆanon keyï¼‰è®¿é—®æ•°æ®åº“ï¼Œæ— æ³•é€šè¿‡RLSéªŒè¯
   - å¯¼è‡´æ•°æ®å†™å…¥å¤±è´¥ï¼Œå¹¶å‡ºç° "new row violates row-level security policy" é”™è¯¯

### è§£å†³æ–¹æ¡ˆ

#### 1. ä¿®æ”¹æ•°æ®æ¨¡å‹ä½¿ç”¨ç®¡ç†å‘˜æƒé™
**æ–‡ä»¶**: `src/models/Expense.js`
- å°† `const { supabase }` æ”¹ä¸º `const { supabaseAdmin }`
- æ‰€æœ‰æ•°æ®åº“æ“ä½œéƒ½ä½¿ç”¨ `supabaseAdmin` å®¢æˆ·ç«¯ï¼ˆservice role keyï¼‰

**æ–‡ä»¶**: `src/models/Budget.js`
- åŒæ ·ä¿®æ”¹ä¸ºä½¿ç”¨ `supabaseAdmin` å®¢æˆ·ç«¯

#### 2. åˆ›å»ºæ•°æ®åº“è¿ç§»ä¿®å¤RLSç­–ç•¥
**æ–‡ä»¶**: `supabase/migrations/20250619094000_fix_rls_policies.sql`
- å°è¯•åˆ›å»ºæ”¯æŒservice roleçš„RLSç­–ç•¥

**æ–‡ä»¶**: `supabase/migrations/20250619095000_simplify_rls_policies.sql`
- æš‚æ—¶ç¦ç”¨RLSç­–ç•¥ä»¥ç¡®ä¿APIæ­£å¸¸å·¥ä½œ
- åˆ é™¤ç°æœ‰ç­–ç•¥å¹¶ç¦ç”¨è¡¨çº§RLS
- æ·»åŠ æ³¨é‡Šè¯´æ˜è¿™æ˜¯ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

#### 3. åº”ç”¨è¿ç§»
```bash
npx supabase db push
```

### æµ‹è¯•éªŒè¯
1. **åˆ›å»ºæ”¯å‡ºè®°å½•**ï¼šâœ… æˆåŠŸ
   ```json
   {"success":true,"message":"æ”¯å‡ºè®°å½•åˆ›å»ºæˆåŠŸ","data":{"id":"30264ede-4398-4a75-a677-e28a9cba7c2e",...}}
   ```

2. **è·å–æ”¯å‡ºåˆ—è¡¨**ï¼šâœ… æˆåŠŸè¿”å›5æ¡è®°å½•
   - åŒ…å«æ‰€æœ‰å†å²æ•°æ®
   - åŒ…å«æ–°åˆ›å»ºçš„è®°å½•
   - åˆ†é¡µä¿¡æ¯æ­£ç¡®

3. **æ•°æ®æŒä¹…åŒ–**ï¼šâœ… å®Œå…¨æ­£å¸¸
   - æ•°æ®æ­£ç¡®ä¿å­˜åˆ°Supabaseæ•°æ®åº“
   - åç»­æŸ¥è¯¢èƒ½æ­£å¸¸è¿”å›æ•°æ®

### æŠ€æœ¯ç»†èŠ‚

#### ä¿®æ”¹çš„æ–‡ä»¶
1. `src/models/Expense.js` - æ‰€æœ‰æ•°æ®åº“æ“ä½œä½¿ç”¨supabaseAdmin
2. `src/models/Budget.js` - æ‰€æœ‰æ•°æ®åº“æ“ä½œä½¿ç”¨supabaseAdmin  
3. `supabase/migrations/20250619094000_fix_rls_policies.sql` - å°è¯•ä¿®å¤RLSç­–ç•¥
4. `supabase/migrations/20250619095000_simplify_rls_policies.sql` - æš‚æ—¶ç¦ç”¨RLS

#### å…³é”®å˜æ›´
- **è®¤è¯æ¶æ„**ï¼šä»ä¾èµ–RLSçš„ç”¨æˆ·çº§è®¤è¯æ”¹ä¸ºä½¿ç”¨service roleçš„åç«¯è®¤è¯
- **å®‰å…¨ç­–ç•¥**ï¼šæš‚æ—¶ç¦ç”¨RLSï¼Œåç»­éœ€è¦å®ç°åº”ç”¨å±‚çš„æ•°æ®è®¿é—®æ§åˆ¶
- **æ•°æ®è®¿é—®**ï¼šåç«¯ä½¿ç”¨ç®¡ç†å‘˜æƒé™è®¿é—®æ•°æ®ï¼Œé€šè¿‡è®¤è¯ä¸­é—´ä»¶ç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®

### åç»­ä¼˜åŒ–å»ºè®®
1. **é‡æ–°å¯ç”¨RLS**ï¼šå®ç°æ­£ç¡®çš„RLSç­–ç•¥ï¼Œæ”¯æŒservice roleè®¿é—®
2. **åº”ç”¨å±‚å®‰å…¨**ï¼šåœ¨æ§åˆ¶å™¨å±‚æ·»åŠ æ›´ä¸¥æ ¼çš„ç”¨æˆ·æ•°æ®è®¿é—®éªŒè¯
3. **ç›‘æ§å’Œæ—¥å¿—**ï¼šæ·»åŠ æ•°æ®è®¿é—®æ—¥å¿—ï¼Œç›‘æ§å®‰å…¨æ€§

### ç»“æœ
- âœ… æ”¯å‡ºè®°å½•åˆ›å»ºåŠŸèƒ½å®Œå…¨æ­£å¸¸
- âœ… æ”¯å‡ºè®°å½•æŸ¥è¯¢åŠŸèƒ½å®Œå…¨æ­£å¸¸  
- âœ… æ•°æ®æŒä¹…åŒ–ç¨³å®šå¯é 
- âœ… å†å²æ•°æ®å®Œæ•´ä¿ç•™
- âœ… iOSå‰ç«¯ç°åœ¨åº”è¯¥èƒ½æ­£å¸¸æ˜¾ç¤ºæ‰€æœ‰æ”¯å‡ºæ•°æ®

---

## 2025-06-18 - ä¿®å¤æ•°æ®åº“ç»“æ„é—®é¢˜

### é—®é¢˜æè¿°
ç”¨æˆ·ç™»å½•åå‡ºç°500é”™è¯¯ï¼š"column profiles.is_deleted does not exist"

### è§£å†³æ–¹æ¡ˆ
åˆ›å»ºè¿ç§»æ–‡ä»¶ `20250618132900_add_soft_delete_to_profiles.sql` æ·»åŠ è½¯åˆ é™¤å­—æ®µï¼š
- æ·»åŠ  `is_deleted BOOLEAN DEFAULT FALSE`
- æ·»åŠ  `deleted_at TIMESTAMP WITH TIME ZONE DEFAULT NULL`
- åˆ›å»ºç›¸å…³ç´¢å¼•å’ŒRLSç­–ç•¥
- æ·»åŠ è½¯åˆ é™¤å’Œæ¢å¤å‡½æ•°

### ç»“æœ
- âœ… æ³¨å†ŒAPIæ­£å¸¸å·¥ä½œ
- âœ… ç™»å½•APIå®Œå…¨æ­£å¸¸ï¼Œè¿”å›æ­£ç¡®çš„ç”¨æˆ·ä¿¡æ¯å’Œä»¤ç‰Œ

---

## 2025-06-17 - é¡¹ç›®åˆå§‹åŒ–

### å®Œæˆå†…å®¹
1. åˆ›å»ºåŸºç¡€é¡¹ç›®ç»“æ„
2. é…ç½®Express.jsæœåŠ¡å™¨
3. è®¾ç½®Supabaseæ•°æ®åº“è¿æ¥
4. å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
5. åˆ›å»ºæ”¯å‡ºå’Œé¢„ç®—ç®¡ç†API
6. éƒ¨ç½²åˆ°Vercel

### æŠ€æœ¯æ ˆ
- Node.js + Express.js
- Supabase PostgreSQLæ•°æ®åº“
- JWTè®¤è¯
- Verceléƒ¨ç½²

# è´¹ç”¨è¿½è¸ªåº”ç”¨åç«¯å¼€å‘æ—¥å¿—

## 2025-06-20 10:47:00 - åˆ é™¤åŠŸèƒ½Bugä¿®å¤å’Œä»£ç é‡æ–°éƒ¨ç½²

### ğŸ› é—®é¢˜å‘ç°
- ç”¨æˆ·æŠ¥å‘Šåˆ é™¤æ”¯å‡ºè®°å½•åï¼Œç­›é€‰æ—¶åˆ é™¤çš„è®°å½•åˆé‡æ–°å‡ºç°
- ç»è¿‡è¯¦ç»†è°ƒè¯•å‘ç°å…³é”®é—®é¢˜ï¼š`expenseController.js`ä¸­ä½¿ç”¨`parseInt(id)`å¤„ç†UUIDç±»å‹çš„ID

### ğŸ” æ ¹æœ¬åŸå› åˆ†æ
1. **UUIDä¸èƒ½parseInt**ï¼š`parseInt("4f5a58b9-02eb-4781-9b07-a13ef16bdc8c")`è¿”å›`NaN`
2. **æ•°æ®åº“æŸ¥è¯¢å¤±è´¥**ï¼šæŸ¥è¯¢æ¡ä»¶å˜æˆ`id = NaN`ï¼Œå¯¼è‡´æ‰¾ä¸åˆ°ä»»ä½•è®°å½•
3. **å‡è±¡æˆåŠŸ**ï¼šSupabaseåˆ é™¤ä¸å­˜åœ¨çš„è®°å½•ä¸æŠ¥é”™ï¼Œè¿”å›"æˆåŠŸ"ä½†å®é™…æ²¡åˆ é™¤

### âœ… ä¿®å¤å†…å®¹
ä¿®æ”¹äº†`src/controllers/expenseController.js`ä¸­çš„ä¸‰ä¸ªæ–¹æ³•ï¼š
- `getExpenseById`ï¼šç§»é™¤`parseInt(id)`ï¼Œç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²ID
- `updateExpense`ï¼šç§»é™¤`Expense.updateById(parseInt(id), ...)`ä¸­çš„parseInt
- `deleteExpense`ï¼šç§»é™¤ä¸¤å¤„`parseInt(id)`è°ƒç”¨

### ğŸ§ª ä¿®å¤éªŒè¯
- âœ… GETæ”¯å‡ºè¯¦æƒ…ï¼šæ­£å¸¸è¿”å›å®Œæ•´æ•°æ®
- âœ… DELETEæ”¯å‡ºè®°å½•ï¼šæˆåŠŸåˆ é™¤ï¼Œè¿”å›æˆåŠŸæ¶ˆæ¯
- âœ… æ•°æ®ä¸€è‡´æ€§ï¼šåˆ é™¤åè®°å½•çœŸæ­£ä»æ•°æ®åº“ç§»é™¤

### ğŸ“¦ éƒ¨ç½²çŠ¶æ€
- âœ… ä»£ç å·²æäº¤åˆ°Gitä»“åº“
- âœ… å·²æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ˆGitHubï¼‰
- âœ… Vercelä¼šè‡ªåŠ¨æ£€æµ‹æ›´æ”¹å¹¶é‡æ–°éƒ¨ç½²

### ğŸ“ æŠ€æœ¯ç»†èŠ‚
- **é—®é¢˜ç±»å‹**ï¼šæ•°æ®ç±»å‹å¤„ç†é”™è¯¯
- **å½±å“èŒƒå›´**ï¼šæ‰€æœ‰æ¶‰åŠUUID IDçš„CRUDæ“ä½œ
- **ä¿®å¤æ–¹æ³•**ï¼šç§»é™¤ä¸å¿…è¦çš„parseIntè½¬æ¢
- **éƒ¨ç½²æ–¹å¼**ï¼šé€šè¿‡Gitæ¨é€è§¦å‘Vercelè‡ªåŠ¨éƒ¨ç½²

## 2025-06-20 12:50:00 - åˆ é™¤åŠŸèƒ½Bugå¤ç°å’Œæ·±åº¦è¯Šæ–­

### ğŸš¨ é—®é¢˜é‡ç°
ç”¨æˆ·å†æ¬¡æŠ¥å‘Šåˆ é™¤æ”¯å‡ºè®°å½•åï¼Œåˆ·æ–°é¡µé¢æ—¶åˆ é™¤çš„è®°å½•åˆé‡æ–°å‡ºç°çš„é—®é¢˜ã€‚

### ğŸ” è¯¦ç»†é”™è¯¯åˆ†æ
é€šè¿‡ç”¨æˆ·æä¾›çš„iOSåº”ç”¨æ—¥å¿—ï¼Œå‘ç°å…³é”®é”™è¯¯ä¿¡æ¯ï¼š
1. **DELETEè¯·æ±‚è¿”å›500é”™è¯¯**ï¼š`"æŸ¥æ‰¾æ”¯å‡ºè®°å½•å¤±è´¥: invalid input syntax for type uuid: \"NaN\""`
2. **ç¬¬äºŒæ¬¡åˆ é™¤é”™è¯¯**ï¼š`"æŸ¥æ‰¾æ”¯å‡ºè®°å½•å¤±è´¥: invalid input syntax for type uuid: \"69\""`
3. **å‰ç«¯è¯¯åˆ¤**ï¼šå°½ç®¡åç«¯è¿”å›500é”™è¯¯ï¼Œå‰ç«¯å´æ˜¾ç¤º"âœ… æ”¯å‡ºè®°å½•åˆ é™¤æˆåŠŸ"

### ğŸ› æ ¹æœ¬åŸå› ç¡®è®¤
1. **UUIDå¤„ç†é”™è¯¯**ï¼šåç«¯ä»ç„¶å­˜åœ¨`parseInt(id)`å¤„ç†UUIDçš„é—®é¢˜
2. **éƒ¨ç½²ç¼“å­˜é—®é¢˜**ï¼šè™½ç„¶æœ¬åœ°ä»£ç å·²ä¿®å¤ï¼Œä½†Verceléƒ¨ç½²å¯èƒ½å­˜åœ¨ç¼“å­˜
3. **å‰ç«¯é”™è¯¯å¤„ç†**ï¼šå‰ç«¯å°†500é”™è¯¯è¯¯åˆ¤ä¸ºæˆåŠŸ

### ğŸ”§ ä¿®å¤å°è¯•
1. **ä»£ç ä¿®å¤ç¡®è®¤**ï¼š
   - âœ… `expenseController.js`ä¸­æ‰€æœ‰`parseInt(id)`å·²ç§»é™¤
   - âœ… è·¯ç”±æ–‡ä»¶æ­£å¸¸
   - âœ… Expenseæ¨¡å‹æ­£å¸¸

2. **éƒ¨ç½²å¼ºåˆ¶æ›´æ–°**ï¼š
   - âœ… å¤šæ¬¡git pushè§¦å‘é‡æ–°éƒ¨ç½²
   - âœ… æ·»åŠ è°ƒè¯•æ—¥å¿—å¼ºåˆ¶ä»£ç æ›´æ–°
   - âŒ çº¿ä¸ŠAPIä»è¿”å›ç›¸åŒé”™è¯¯

3. **è°ƒè¯•æ–¹æ³•**ï¼š
   - âœ… æ·»åŠ è¯¦ç»†æ—¥å¿—åˆ°controllerå’Œmodel
   - âœ… åˆ›å»ºè°ƒè¯•è·¯ç”±æµ‹è¯•IDå¤„ç†
   - ğŸ”„ ç­‰å¾…éƒ¨ç½²ç”Ÿæ•ˆ

### ğŸ“Š å½“å‰çŠ¶æ€
- **æœ¬åœ°ä»£ç **ï¼šâœ… å®Œå…¨ä¿®å¤
- **è¿œç¨‹ä»“åº“**ï¼šâœ… æœ€æ–°ä»£ç å·²æ¨é€
- **çº¿ä¸Šéƒ¨ç½²**ï¼šâŒ ä»æ˜¾ç¤ºæ—§é”™è¯¯
- **é—®é¢˜ç±»å‹**ï¼šVerceléƒ¨ç½²ç¼“å­˜æˆ–é…ç½®é—®é¢˜

### ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’
1. **ç­‰å¾…éƒ¨ç½²å®Œå…¨ç”Ÿæ•ˆ**ï¼ˆå¯èƒ½éœ€è¦5-10åˆ†é’Ÿï¼‰
2. **ä½¿ç”¨è°ƒè¯•è·¯ç”±éªŒè¯IDå¤„ç†**
3. **å¦‚æœä»æœ‰é—®é¢˜ï¼Œæ£€æŸ¥Vercelé…ç½®**
4. **è€ƒè™‘å¼ºåˆ¶æ¸…é™¤Vercelç¼“å­˜**

### ğŸ’¡ å…³é”®å‘ç°
- **å‰ç«¯éœ€è¦ä¿®å¤**ï¼šä¸åº”è¯¥å°†500é”™è¯¯åˆ¤æ–­ä¸ºæˆåŠŸ
- **UUIDå¤„ç†**ï¼šå¿…é¡»é¿å…ä»»ä½•æ•°å­—è½¬æ¢æ“ä½œ
- **éƒ¨ç½²ç­–ç•¥**ï¼šéœ€è¦ç¡®ä¿ä»£ç æ›´æ”¹ç«‹å³ç”Ÿæ•ˆ

## 2025-06-20 13:15:00 - ğŸš€ å¼ºåˆ¶éƒ¨ç½²ä¿®å¤: æ¸…é™¤Vercelç¼“å­˜è§£å†³UUIDæˆªæ–­é—®é¢˜

### ğŸ¯ é—®é¢˜ç¡®è®¤
- **Vercelæ—¥å¿—æ˜¾ç¤º**: `invalid input syntax for type uuid: "69"`
- **æœ¬åœ°ä»£ç çŠ¶æ€**: å·²æ­£ç¡®ç§»é™¤æ‰€æœ‰`parseInt(id)`è°ƒç”¨
- **æ ¹æœ¬åŸå› **: Vercelç¼“å­˜å¯¼è‡´æ—§ç‰ˆæœ¬ä»£ç ä»åœ¨è¿è¡Œ

### ğŸ”§ ä¿®å¤æªæ–½
1. **ç‰ˆæœ¬å¼ºåˆ¶æ›´æ–°**: `1.0.1` â†’ `1.0.2`
2. **æ·»åŠ å¼ºåŠ›ç¼“å­˜æ¸…é™¤é…ç½®**:
   - æ›´æ–°`vercel.json`æ·»åŠ `no-cache`å¤´éƒ¨
   - æ·»åŠ `X-Cache-Version`æ ‡è¯†
   - è®¾ç½®ç¯å¢ƒå˜é‡`FORCE_CACHE_CLEAR=true`
3. **æœåŠ¡å™¨æ ‡è¯†æ›´æ–°**: æ·»åŠ `DEPLOYMENT_TRIGGER`æ ‡è¯†
4. **é¢å¤–ä¿®å¤**: ç§»é™¤`budgetController.js`ä¸­çš„`parseInt(budgetId)`è°ƒç”¨

### ğŸ“ æ–‡ä»¶æ›´æ”¹
- `package.json`: ç‰ˆæœ¬å·æ›´æ–°åˆ°1.0.2
- `vercel.json`: æ·»åŠ å¼ºåŠ›ç¼“å­˜æ¸…é™¤é…ç½®
- `server.js`: æ›´æ–°ç‰ˆæœ¬æ³¨é‡Šå’Œç¼“å­˜æ¸…é™¤æ ‡è¯†
- `src/controllers/budgetController.js`: ä¿®å¤parseInt(budgetId)é—®é¢˜

### ğŸš€ éƒ¨ç½²çŠ¶æ€
- âœ… ä»£ç å·²æäº¤: `f0adc6f` (å¼ºåˆ¶éƒ¨ç½²) + `5b65824` (budgetControllerä¿®å¤)
- âœ… å·²æ¨é€åˆ°GitHub: `main`åˆ†æ”¯
- ğŸ”„ Vercelè‡ªåŠ¨é‡æ–°éƒ¨ç½²ä¸­...

### ğŸ§ª éªŒè¯è®¡åˆ’
éƒ¨ç½²å®ŒæˆåéªŒè¯ï¼š
1. åˆ é™¤APIè¿”å›200è€Œé500
2. UUIDå®Œæ•´ä¼ é€’ï¼Œæ— æˆªæ–­
3. æ•°æ®åº“è®°å½•çœŸæ­£åˆ é™¤
4. å‰ç«¯åˆ é™¤ååˆ·æ–°ä¸é‡ç°

---

## 2025-06-20 13:30:00 - ğŸ› ä¿®å¤Verceléƒ¨ç½²é”™è¯¯: è§£å†³mixed routing propertiesé—®é¢˜

### ğŸ¯ é—®é¢˜ç¡®è®¤
- **GitHub Webhooks**: ä¸ºç©ºï¼Œè¯´æ˜Vercelé¡¹ç›®æœªæ­£ç¡®è¿æ¥
- **Verceléƒ¨ç½²å¤±è´¥**: Mixed routing propertiesé”™è¯¯
- **æ ¹æœ¬åŸå› **: `vercel.json`é…ç½®ä½¿ç”¨äº†ä¸å…¼å®¹çš„è·¯ç”±å±æ€§ç»„åˆ

### ğŸ”§ é”™è¯¯åˆ†æ
æ ¹æ®[Vercelæ–‡æ¡£](https://vercel.com/docs/errors/error-list#mixed-routing-properties)ï¼š
- âŒ **æ—§é…ç½®**: åŒæ—¶ä½¿ç”¨`builds` + `routes` + `headers`
- âœ… **æ–°é…ç½®**: ä½¿ç”¨`rewrites` + `headers` + `functions`

### ğŸ“ ä¿®å¤æªæ–½
1. **ç§»é™¤è¿‡æ—¶é…ç½®**:
   - åˆ é™¤`builds`æ•°ç»„
   - åˆ é™¤`routes`æ•°ç»„
2. **ä½¿ç”¨ç°ä»£é…ç½®**:
   - æ·»åŠ `rewrites`é…ç½®
   - æ·»åŠ `functions`é…ç½®æŒ‡å®šè¿è¡Œæ—¶
   - ä¿ç•™`headers`é…ç½®

### ğŸ”„ é…ç½®å¯¹æ¯”
```diff
- "builds": [{"src": "server.js", "use": "@vercel/node"}]
- "routes": [{"src": "/(.*)", "dest": "/server.js"}]
+ "rewrites": [{"source": "/(.*)", "destination": "/server.js"}]
+ "functions": {"server.js": {"runtime": "nodejs18.x"}}
```

### ğŸš€ éƒ¨ç½²çŠ¶æ€
- âœ… ä»£ç å·²æäº¤: `135bc66`
- âœ… å·²æ¨é€åˆ°GitHub: `main`åˆ†æ”¯
- ğŸ”„ Vercelåº”è¯¥èƒ½æ­£å¸¸éƒ¨ç½²äº†

### ğŸ§ª é¢„æœŸç»“æœ
1. Verceléƒ¨ç½²æˆåŠŸï¼Œæ— mixed routing propertiesé”™è¯¯
2. è‡ªåŠ¨åˆ›å»ºGitHub webhook
3. UUIDåˆ é™¤åŠŸèƒ½ä¿®å¤ç”Ÿæ•ˆ

---

## 2024-12-17ï¼ˆiOSå¿«æ·æŒ‡ä»¤è‡ªåŠ¨åŒ–é—®é¢˜åˆ†æï¼‰

### ğŸ” é—®é¢˜è¯Šæ–­ï¼šiOSå‰ç«¯åŠŸèƒ½ç¼ºå¤±

#### ç”¨æˆ·åé¦ˆé—®é¢˜
- è‡ªåŠ¨è®°è´¦é¡µé¢éœ€è¦ç”¨æˆ·æ‰‹åŠ¨è®¾ç½®å¿«æ·æŒ‡ä»¤
- å¸Œæœ›èƒ½è‡ªåŠ¨å¸®ç”¨æˆ·åˆ›å»ºæˆ–å¯¼å…¥iOSå¿«æ·æŒ‡ä»¤

#### é—®é¢˜åˆ†æç»“æœ
**ç»“è®ºï¼šè¿™æ˜¯iOSå‰ç«¯é—®é¢˜ï¼Œä¸æ˜¯åç«¯é—®é¢˜**

**åç«¯å·²å®Œå¤‡**ï¼š
- âœ… OCRè§£æAPIå·²å®ç° (`POST /api/ocr/parse`)
- âœ… æ”¯æŒè‡ªåŠ¨è¯†åˆ«ï¼šé‡‘é¢ã€å•†æˆ·ã€æ—¥æœŸã€æ”¯ä»˜æ–¹å¼
- âœ… æœ‰150+é¢„ç½®å•†æˆ·æ•°æ®åº“è¿›è¡Œæ™ºèƒ½åŒ¹é…
- âœ… ç½®ä¿¡åº¦è¯„åˆ†ç³»ç»Ÿï¼ˆé«˜äº0.8å»ºè®®è‡ªåŠ¨åˆ›å»ºï¼‰
- âœ… å®Œæ•´çš„å·¥ä½œæµç¨‹ï¼šè§£æ â†’ ç¡®è®¤ â†’ åˆ›å»ºæ”¯å‡ºè®°å½•

**iOSå‰ç«¯ç¼ºå¤±**ï¼š
- âŒ æ²¡æœ‰è‡ªåŠ¨ç”ŸæˆiOSå¿«æ·æŒ‡ä»¤çš„åŠŸèƒ½
- âŒ ç”¨æˆ·éœ€è¦æ‰‹åŠ¨åœ¨iOSå¿«æ·æŒ‡ä»¤åº”ç”¨ä¸­åˆ›å»ºè‡ªåŠ¨åŒ–æµç¨‹
- âŒ æ²¡æœ‰æä¾›ä¸€é”®å¯¼å…¥å¿«æ·æŒ‡ä»¤çš„åŠŸèƒ½

#### è§£å†³æ–¹æ¡ˆ

##### æ–¹æ¡ˆ1ï¼šiOSåº”ç”¨å†…é›†æˆå¿«æ·æŒ‡ä»¤ç”Ÿæˆï¼ˆæ¨èï¼‰
iOSç«¯éœ€è¦å®ç°ï¼š
```swift
import Intents

class ShortcutGenerator {
    static func generateExpenseTrackingShortcut() -> INShortcut? {
        let activity = NSUserActivity(activityType: "com.yourapp.expense.quickAdd")
        activity.title = "æ™ºèƒ½è®°è´¦"
        activity.userInfo = ["action": "autoExpenseFromPhoto"]
        activity.isEligibleForPrediction = true
        activity.isEligibleForSearch = true
        activity.suggestedInvocationPhrase = "æ™ºèƒ½è®°è´¦"
        
        return INShortcut(userActivity: activity)
    }
    
    static func addShortcutToSiri() {
        guard let shortcut = generateExpenseTrackingShortcut() else { return }
        let viewController = INUIAddVoiceShortcutViewController(shortcut: shortcut)
        // å±•ç¤ºç»™ç”¨æˆ·æ·»åŠ åˆ°Siri
    }
}
```

##### æ–¹æ¡ˆ2ï¼šåç«¯è¡¥å……å¿«æ·æŒ‡ä»¤æ–‡ä»¶ç”ŸæˆAPI
- æ–°å¢APIï¼š`GET /api/ocr/shortcuts/generate`
- ç”Ÿæˆæ ‡å‡†iOSå¿«æ·æŒ‡ä»¤JSONé…ç½®
- æä¾›è¯¦ç»†çš„è®¾ç½®æŒ‡å¯¼

#### ä¼˜åŒ–å»ºè®®
1. **iOSåº”ç”¨å±‚é¢**ï¼š
   - é›†æˆSiriKitå’ŒShortcutsæ¡†æ¶
   - åœ¨åº”ç”¨å†…æä¾›"ä¸€é”®æ·»åŠ Siriå¿«æ·æŒ‡ä»¤"åŠŸèƒ½
   - è‡ªåŠ¨é…ç½®æ‹ç…§â†’OCRâ†’è®°è´¦çš„å®Œæ•´æµç¨‹

2. **ç”¨æˆ·ä½“éªŒæ”¹è¿›**ï¼š
   - åº”ç”¨é¦–æ¬¡å¯åŠ¨æ—¶å¼•å¯¼ç”¨æˆ·è®¾ç½®å¿«æ·æŒ‡ä»¤
   - æä¾›é¢„é…ç½®çš„å¿«æ·æŒ‡ä»¤æ¨¡æ¿
   - æ”¯æŒè¯­éŸ³å”¤é†’ï¼š"å˜¿Siriï¼Œæ™ºèƒ½è®°è´¦"

3. **åç«¯æ”¯æŒ**ï¼š
   - å·²æä¾›å®Œæ•´çš„OCRå’Œè®°è´¦API
   - å¯è€ƒè™‘æ·»åŠ ç½®ä¿¡åº¦è¶³å¤Ÿé«˜æ—¶è‡ªåŠ¨åˆ›å»ºè®°å½•çš„API

### ğŸ“± å®æ–½å»ºè®®

**çŸ­æœŸï¼ˆiOSåº”ç”¨ä¿®æ”¹ï¼‰**ï¼š
1. åœ¨iOSåº”ç”¨ä¸­é›†æˆSiriKit
2. æ·»åŠ å¿«æ·æŒ‡ä»¤è®¾ç½®é¡µé¢
3. æä¾›ä¸€é”®æ·»åŠ åŠŸèƒ½

**ä¸­æœŸï¼ˆç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼‰**ï¼š
1. å®Œå–„å¼•å¯¼æµç¨‹
2. æ·»åŠ æ™ºèƒ½æé†’åŠŸèƒ½
3. ä¼˜åŒ–OCRè¯†åˆ«å‡†ç¡®ç‡

**é•¿æœŸï¼ˆæ™ºèƒ½åŒ–æå‡ï¼‰**ï¼š
1. åŸºäºç”¨æˆ·ä¹ æƒ¯å­¦ä¹ 
2. ä¸ªæ€§åŒ–å¿«æ·æŒ‡ä»¤æ¨è
3. å¤šæ¨¡æ€è¾“å…¥æ”¯æŒï¼ˆè¯­éŸ³+å›¾åƒï¼‰

// ... existing code ...

### ğŸ”§ URLè·¯å¾„é‡å¤é—®é¢˜ä¿®å¤

#### é—®é¢˜æŠ¥å‘Š
- ç”¨æˆ·æŠ¥å‘Š404é”™è¯¯ï¼š`âŒ 404: POST /api/api/ocr/parse`
- æ­£ç¡®è·¯å¾„åº”è¯¥æ˜¯ï¼š`POST /api/ocr/parse`
- é”™è¯¯åŸå› ï¼šURLè·¯å¾„ä¸­é‡å¤äº† `/api`

#### æ ¹æœ¬åŸå› åˆ†æ
1. **iOSå®¢æˆ·ç«¯é…ç½®é—®é¢˜**ï¼š
   - baseURLè®¾ç½®ä¸ºå®Œæ•´åŸŸåï¼ˆæ­£ç¡®ï¼‰
   - åœ¨æ‹¼æ¥endpointæ—¶é‡å¤æ·»åŠ äº† `/api` å‰ç¼€
   - å¯¼è‡´æœ€ç»ˆURLå˜æˆ `/api/api/ocr/parse`

2. **å¸¸è§é”™è¯¯æ¨¡å¼**ï¼š
   ```swift
   // âŒ é”™è¯¯çš„æ‹¼æ¥æ–¹å¼
   let baseURL = "https://your-domain.com"
   let wrongURL = "\(baseURL)/api/api/ocr/parse"  // é‡å¤äº†/api
   
   // âœ… æ­£ç¡®çš„æ‹¼æ¥æ–¹å¼
   let correctURL = "\(baseURL)/api/ocr/parse"
   ```

#### ä¿®å¤æ–¹æ¡ˆ
1. **åˆ›å»ºç«¯ç‚¹æšä¸¾**ï¼š
   - åœ¨ `APIConfig` ä¸­æ·»åŠ  `Endpoint` æšä¸¾
   - é¢„å®šä¹‰æ‰€æœ‰APIç«¯ç‚¹è·¯å¾„
   - æä¾› `fullURL` è®¡ç®—å±æ€§

2. **ä¿®å¤iOSå®¢æˆ·ç«¯ä»£ç **ï¼š
   - å°†ç¡¬ç¼–ç çš„URLæ‹¼æ¥æ›¿æ¢ä¸ºæšä¸¾è°ƒç”¨
   - æ·»åŠ è¯¦ç»†çš„é”™è¯¯å’Œæ­£ç¡®ç¤ºä¾‹æ³¨é‡Š
   - æä¾›OCRæœåŠ¡çš„å®Œæ•´å®ç°ç¤ºä¾‹

3. **æ–‡æ¡£æ›´æ–°**ï¼š
   - æ›´æ–° `swift-supabase-example.md`
   - æ·»åŠ URLæ„å»ºæœ€ä½³å®è·µ
   - æä¾›é¿å…å¸¸è§é”™è¯¯çš„æŒ‡å¯¼

#### é¢„é˜²æªæ–½
- ä½¿ç”¨ç±»å‹å®‰å…¨çš„ç«¯ç‚¹æšä¸¾
- é¿å…æ‰‹åŠ¨æ‹¼æ¥URLå­—ç¬¦ä¸²
- æ·»åŠ URLéªŒè¯å’Œæ—¥å¿—è®°å½•
- åœ¨å¼€å‘é˜¶æ®µè¿›è¡ŒURLè·¯å¾„æµ‹è¯•

// ... existing code ...

### ğŸ“š APIæ–‡æ¡£æ›´æ–°

#### æ›´æ–°å†…å®¹
1. **æ–°å¢OCRè‡ªåŠ¨åŒ–API**ï¼š
   - `POST /api/ocr/parse-auto`ï¼šæ™ºèƒ½è§£æå¹¶è‡ªåŠ¨åˆ›å»ºæ”¯å‡ºè®°å½•
   - `GET /api/ocr/shortcuts/generate`ï¼šç”ŸæˆiOSå¿«æ·æŒ‡ä»¤é…ç½®

2. **iOSå®¢æˆ·ç«¯é›†æˆæŒ‡å¯¼**ï¼š
   - æ·»åŠ URLè·¯å¾„é”™è¯¯ä¿®å¤æ–¹æ³•
   - æä¾›æ¨èçš„APIé…ç½®æ–¹å¼ï¼ˆAPIConfig.Endpointæšä¸¾ï¼‰
   - æ·»åŠ æ­£ç¡®çš„OCRæœåŠ¡è°ƒç”¨ç¤ºä¾‹

3. **é”™è¯¯å¤„ç†æŒ‡å¯¼**ï¼š
   - è¯¦ç»†è¯´æ˜URLè·¯å¾„é‡å¤é”™è¯¯çš„åŸå› å’Œä¿®å¤æ–¹æ³•
   - æä¾›è°ƒè¯•å»ºè®®å’Œç½‘ç»œç›‘æ§æ–¹æ³•
   - æ·»åŠ å¸¸è§é”™è¯¯ç¤ºä¾‹å¯¹æ¯”

4. **å¼€å‘è°ƒè¯•æ›´æ–°**ï¼š
   - æ·»åŠ æ–°OCR APIçš„curlæµ‹è¯•å‘½ä»¤
   - æ›´æ–°å¯ç”¨è·¯ç”±åˆ—è¡¨
   - æä¾›å®Œæ•´çš„APIæµ‹è¯•æµç¨‹

#### ä¿®æ”¹çš„æ–‡ä»¶
- `docs/API.md`ï¼šæ·»åŠ äº†æ–°çš„OCR APIç«¯ç‚¹å’ŒiOSé›†æˆæŒ‡å¯¼

#### å‰ç«¯å¼€å‘è¦ç‚¹
1. ä½¿ç”¨ `APIConfig.Endpoint` æšä¸¾é¿å…URLè·¯å¾„é‡å¤
2. æ–°çš„ `/api/ocr/parse-auto` ç«¯ç‚¹æ”¯æŒé«˜ç½®ä¿¡åº¦è‡ªåŠ¨åˆ›å»º
3. iOSå¿«æ·æŒ‡ä»¤å¯é€šè¿‡ `/api/ocr/shortcuts/generate` è·å–é…ç½®
4. å¿…é¡»ä½¿ç”¨è·¯å¾„å‚æ•°è€Œä¸æ˜¯æŸ¥è¯¢å‚æ•°è®¿é—®èµ„æº

// ... existing code ...

### ğŸ”§ Express Trust Proxyé…ç½®ä¿®å¤

#### é—®é¢˜æŠ¥å‘Š
ç”¨æˆ·æŠ¥å‘Šç”Ÿäº§ç¯å¢ƒé”™è¯¯ï¼š
```
ValidationError: The 'X-Forwarded-For' header is set but the Express 'trust proxy' setting is false (default). 
This could indicate a misconfiguration which would prevent express-rate-limit from accurately identifying users.
```

#### é—®é¢˜åˆ†æ
- **é”™è¯¯ç±»å‹**: ValidationError (ERR_ERL_UNEXPECTED_X_FORWARDED_FOR)
- **å‘ç”Ÿä½ç½®**: express-rate-limitä¸­é—´ä»¶
- **ç¯å¢ƒ**: ç”Ÿäº§ç¯å¢ƒ (/var/task/ è¡¨æ˜æ˜¯serverlessç¯å¢ƒï¼Œå¦‚Vercel)
- **æ ¹æœ¬åŸå› **: Expressåº”ç”¨ç¼ºå°‘ `app.set('trust proxy', true)` é…ç½®

#### é—®é¢˜å½±å“
1. **rate limitingåŠŸèƒ½å¼‚å¸¸**: æ— æ³•æ­£ç¡®è¯†åˆ«çœŸå®å®¢æˆ·ç«¯IP
2. **å®‰å…¨é£é™©**: å¯èƒ½è¢«æ¶æ„ç”¨æˆ·ç»•è¿‡é™æµ
3. **ç”Ÿäº§ç¯å¢ƒç¨³å®šæ€§**: æŒç»­çš„ValidationErroræ—¥å¿—

#### è§£å†³æ–¹æ¡ˆ
åœ¨ `src/app.js` ä¸­æ·»åŠ trust proxyé…ç½®ï¼š
```javascript
// ğŸ”§ ä¿¡ä»»ä»£ç†æœåŠ¡å™¨ - ä¿®å¤Vercel/ç”Ÿäº§ç¯å¢ƒä¸­çš„X-Forwarded-Foré”™è¯¯
// è¿™å¯¹äºæ­£ç¡®çš„IPè¯†åˆ«å’Œrate limitingæ˜¯å¿…éœ€çš„
app.set('trust proxy', true);
```

#### æŠ€æœ¯ç»†èŠ‚
**ä¸ºä»€ä¹ˆéœ€è¦trust proxyï¼Ÿ**
1. **ä»£ç†ç¯å¢ƒ**: Vercelã€Herokuã€AWSç­‰äº‘å¹³å°éƒ½ä½¿ç”¨åå‘ä»£ç†
2. **IPè¯†åˆ«**: ä»£ç†æœåŠ¡å™¨é€šè¿‡X-Forwarded-Forå¤´éƒ¨ä¼ é€’çœŸå®å®¢æˆ·ç«¯IP
3. **Expressé»˜è®¤**: å‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒExpressé»˜è®¤ä¸ä¿¡ä»»è¿™äº›å¤´éƒ¨
4. **rate limiting**: express-rate-limitä¾èµ–æ­£ç¡®çš„IPè¯†åˆ«æ¥å·¥ä½œ

**é…ç½®é€‰é¡¹**:
- `true`: ä¿¡ä»»æ‰€æœ‰ä»£ç†ï¼ˆé€‚ç”¨äºå¤§å¤šæ•°äº‘å¹³å°ï¼‰
- `false`: ä¸ä¿¡ä»»ä»»ä½•ä»£ç†ï¼ˆé»˜è®¤ï¼‰
- `number`: ä¿¡ä»»æŒ‡å®šæ•°é‡çš„è·³æ•°
- `string/array`: ä¿¡ä»»ç‰¹å®šIPåœ°å€

#### éªŒè¯æ–¹æ³•
1. **éƒ¨ç½²åæµ‹è¯•**: ç¡®è®¤ä¸å†å‡ºç°ValidationError
2. **IPè¯†åˆ«éªŒè¯**: æ£€æŸ¥rate limitingæ˜¯å¦æ­£å¸¸å·¥ä½œ
3. **æ—¥å¿—ç›‘æ§**: è§‚å¯Ÿé”™è¯¯æ—¥å¿—æ˜¯å¦æ¶ˆå¤±

#### é¢„é˜²æªæ–½
- åœ¨éƒ¨ç½²checklistä¸­åŒ…å«trust proxyé…ç½®æ£€æŸ¥
- æ·»åŠ ç”Ÿäº§ç¯å¢ƒé…ç½®éªŒè¯è„šæœ¬
- æ›´æ–°éƒ¨ç½²æ–‡æ¡£ï¼Œå¼ºè°ƒä»£ç†é…ç½®çš„é‡è¦æ€§

// ... existing code ...

### ğŸ”§ OCR APIç«¯ç‚¹ç¼ºå¤±é—®é¢˜ä¿®å¤

#### é—®é¢˜æŠ¥å‘Š
å‰ç«¯åé¦ˆï¼šæ²¡æœ‰éƒ¨ç½²ç›¸å…³OCR APIç«¯ç‚¹

#### é—®é¢˜åˆ†æ
é€šè¿‡æ£€æŸ¥å‘ç°ï¼š
1. **APIæ–‡æ¡£å·²æ›´æ–°**ï¼š`docs/API.md`ä¸­åŒ…å«äº†æ–°çš„OCRç«¯ç‚¹
2. **è·¯ç”±é…ç½®ç¼ºå¤±**ï¼š`src/routes/ocr.js`ä¸­ç¼ºå°‘`/parse-auto`è·¯ç”±
3. **æ§åˆ¶å™¨æ–¹æ³•ç¼ºå¤±**ï¼š`src/controllers/ocrController.js`ä¸­ç¼ºå°‘`parseTextAndAutoCreate`æ–¹æ³•
4. **è·¯ç”±åˆ—è¡¨æœªæ›´æ–°**ï¼š`src/app.js`ä¸­çš„è°ƒè¯•è·¯ç”±åˆ—è¡¨æœªåŒ…å«æ–°ç«¯ç‚¹

#### ä¿®å¤å†…å®¹

##### 1. æ·»åŠ OCRè‡ªåŠ¨åˆ›å»ºæ§åˆ¶å™¨æ–¹æ³•
åœ¨`src/controllers/ocrController.js`ä¸­æ·»åŠ ï¼š
```javascript
/**
 * æäº¤OCRæ–‡æœ¬è¿›è¡Œè§£æå¹¶è‡ªåŠ¨åˆ›å»ºæ”¯å‡ºè®°å½•ï¼ˆé«˜ç½®ä¿¡åº¦æ—¶ï¼‰
 * POST /api/ocr/parse-auto
 */
static async parseTextAndAutoCreate(req, res) {
    // å®Œæ•´çš„è‡ªåŠ¨åˆ›å»ºé€»è¾‘å®ç°
    // æ”¯æŒç½®ä¿¡åº¦é˜ˆå€¼é…ç½®ï¼ˆé»˜è®¤0.85ï¼‰
    // é«˜ç½®ä¿¡åº¦æ—¶è‡ªåŠ¨åˆ›å»ºæ”¯å‡ºè®°å½•
    // ä½ç½®ä¿¡åº¦æ—¶è¿”å›è§£æç»“æœä¾›ç”¨æˆ·ç¡®è®¤
}
```

##### 2. æ·»åŠ OCRè·¯ç”±é…ç½®
åœ¨`src/routes/ocr.js`ä¸­æ·»åŠ ï¼š
```javascript
/**
 * @route POST /api/ocr/parse-auto
 * @desc è§£æOCRæ–‡æœ¬å¹¶åœ¨é«˜ç½®ä¿¡åº¦æ—¶è‡ªåŠ¨åˆ›å»ºæ”¯å‡ºè®°å½•
 * @access Private
 */
router.post('/parse-auto', OCRController.parseTextAndAutoCreate);
```

##### 3. æ›´æ–°è·¯ç”±åˆ—è¡¨
åœ¨`src/app.js`çš„è°ƒè¯•è·¯ç”±ä¸­æ·»åŠ ï¼š
```javascript
'POST /api/ocr/parse-auto (ğŸ†• è‡ªåŠ¨åˆ›å»º)',
'GET /api/ocr/shortcuts/generate (ğŸ†• iOSå¿«æ·æŒ‡ä»¤)'
```

#### éªŒè¯ç»“æœ
- âœ… æœåŠ¡å™¨é‡å¯åæ–°ç«¯ç‚¹å¯ç”¨
- âœ… `/api/debug/routes`æ˜¾ç¤ºæ–°çš„OCRç«¯ç‚¹
- âœ… APIç«¯ç‚¹æ­£ç¡®è¦æ±‚è®¤è¯
- âœ… è·¯ç”±é…ç½®å®Œæ•´

#### æ–°å¢APIåŠŸèƒ½
1. **`POST /api/ocr/parse-auto`**ï¼š
   - æ™ºèƒ½è§£æOCRæ–‡æœ¬
   - ç½®ä¿¡åº¦â‰¥0.85æ—¶è‡ªåŠ¨åˆ›å»ºæ”¯å‡ºè®°å½•
   - ç½®ä¿¡åº¦è¾ƒä½æ—¶è¿”å›è§£æç»“æœä¾›ç¡®è®¤
   - æ”¯æŒè‡ªå®šä¹‰ç½®ä¿¡åº¦é˜ˆå€¼

2. **`GET /api/ocr/shortcuts/generate`**ï¼š
   - ç”ŸæˆiOSå¿«æ·æŒ‡ä»¤JSONé…ç½®
   - åŒ…å«å®Œæ•´çš„æ‹ç…§â†’OCRâ†’APIè°ƒç”¨æµç¨‹
   - æä¾›è¯¦ç»†çš„è®¾ç½®æŒ‡å¯¼

#### éƒ¨ç½²çŠ¶æ€
- âœ… æœ¬åœ°å¼€å‘ç¯å¢ƒï¼šå·²ä¿®å¤å¹¶æµ‹è¯•é€šè¿‡
- â³ ç”Ÿäº§ç¯å¢ƒï¼šéœ€è¦é‡æ–°éƒ¨ç½²åˆ°Vercel

// ... existing code ...

## 2025-06-26 - URLè·¯å¾„é‡å¤é”™è¯¯ä¿®å¤ (v1.0.13)

### é—®é¢˜æŠ¥å‘Š
ç”¨æˆ·åé¦ˆå‡ºç°äº† `âŒ 404: POST /api/api/ocr/parse` é”™è¯¯ï¼ŒURLè·¯å¾„ä¸­å‡ºç°äº†é‡å¤çš„ `/api` å‰ç¼€ã€‚

### é—®é¢˜åˆ†æ
1. **é”™è¯¯URL**: `/api/api/ocr/parse` - é‡å¤äº†`/api`å‰ç¼€ï¼Œå¯¼è‡´404é”™è¯¯
2. **æ­£ç¡®URL**: `/api/ocr/parse` - è¿”å›401è®¤è¯é”™è¯¯ï¼ˆæ­£å¸¸è¡Œä¸ºï¼‰
3. **æ ¹æœ¬åŸå› **: å‰ç«¯URLæ„å»ºé…ç½®é”™è¯¯ï¼Œå¯èƒ½æ˜¯ï¼š
   - baseURLå·²åŒ…å«`/api`ï¼Œç«¯ç‚¹åˆåŠ äº†`/api`å‰ç¼€
   - ç¡¬ç¼–ç äº†é”™è¯¯çš„å®Œæ•´è·¯å¾„

### è§£å†³æ–¹æ¡ˆå®ç°
æ·»åŠ äº†æ™ºèƒ½è·¯å¾„é‡å®šå‘ä¸­é—´ä»¶åœ¨ `src/app.js` ä¸­ï¼š

```javascript
// æ™ºèƒ½è·¯å¾„é‡å®šå‘ä¸­é—´ä»¶ - å¤„ç†é‡å¤çš„/apiå‰ç¼€
app.use((req, res, next) => {
    // æ£€æµ‹ /api/api/ è·¯å¾„æ¨¡å¼
    if (req.originalUrl.startsWith('/api/api/')) {
        const correctedPath = req.originalUrl.replace('/api/api/', '/api/');
        console.log(`ğŸ”§ è‡ªåŠ¨ä¿®å¤é‡å¤è·¯å¾„: ${req.originalUrl} -> ${correctedPath}`);
        
        // è¿”å›é‡å®šå‘æç¤ºè€Œä¸æ˜¯ç›´æ¥é‡å®šå‘ï¼Œå› ä¸ºè¿™é€šå¸¸æ˜¯å‰ç«¯é…ç½®é”™è¯¯
        return res.status(400).json({
            success: false,
            error: 'URL_PATH_DUPLICATE',
            message: 'æ£€æµ‹åˆ°é‡å¤çš„APIè·¯å¾„å‰ç¼€',
            details: {
                received: req.originalUrl,
                correct: correctedPath,
                problem: 'æ‚¨çš„è¯·æ±‚URLåŒ…å«é‡å¤çš„/apiå‰ç¼€',
                solution: 'è¯·æ£€æŸ¥å‰ç«¯ä»£ç ä¸­çš„APIåŸºç¡€URLé…ç½®'
            },
            frontend_fix: {
                description: 'å¸¸è§çš„å‰ç«¯ä¿®å¤æ–¹æ³•',
                examples: [
                    {
                        problem: 'baseURL = "https://domain.com/api" + "/api/ocr/parse"',
                        solution: 'baseURL = "https://domain.com" + "/api/ocr/parse"'
                    },
                    {
                        problem: 'const endpoint = "/api/api/ocr/parse"',
                        solution: 'const endpoint = "/api/ocr/parse"'
                    },
                    {
                        problem: 'iOS: APIConfig.baseURL + "/api/ocr/parse"',
                        solution: 'iOS: ä½¿ç”¨ APIConfig.Endpoint.ocrParse.rawValue'
                    }
                ]
            },
            available_routes: '/api/debug/routes'
        });
    }
    next();
});
```

### åŠŸèƒ½ç‰¹æ€§
1. **æ™ºèƒ½æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹ `/api/api/` è·¯å¾„æ¨¡å¼
2. **è¯¦ç»†é”™è¯¯ä¿¡æ¯**: æä¾›æ­£ç¡®è·¯å¾„å’Œé”™è¯¯åŸå› 
3. **å‰ç«¯ä¿®å¤æŒ‡å¯¼**: åŒ…å«iOSå®¢æˆ·ç«¯çš„å…·ä½“è§£å†³æ–¹æ¡ˆ
4. **400çŠ¶æ€ç **: æ˜ç¡®æ ‡è¯†ä¸ºå®¢æˆ·ç«¯é…ç½®é”™è¯¯ï¼Œè€ŒéæœåŠ¡å™¨é—®é¢˜

### æµ‹è¯•éªŒè¯
- **æœ¬åœ°ç¯å¢ƒ**: âœ… æ™ºèƒ½é‡å®šå‘å·¥ä½œæ­£å¸¸
- **ç”Ÿäº§ç¯å¢ƒ**: âœ… å·²éƒ¨ç½²å¹¶éªŒè¯åŠŸèƒ½
- **é”™è¯¯è·¯å¾„**: `/api/api/ocr/parse` â†’ è¿”å›400é”™è¯¯å’Œä¿®å¤æŒ‡å¯¼
- **æ­£ç¡®è·¯å¾„**: `/api/ocr/parse` â†’ è¿”å›401è®¤è¯é”™è¯¯ï¼ˆæ­£å¸¸ï¼‰

### éƒ¨ç½²ä¿¡æ¯
- **ç‰ˆæœ¬**: v1.0.13
- **æäº¤**: 71099eb - ä¿®å¤URLè·¯å¾„é‡å¤é—®é¢˜
- **ç”Ÿäº§URL**: https://expense-tracker-backend-mocrhvaay-likexin0304s-projects.vercel.app
- **éƒ¨ç½²çŠ¶æ€**: âœ… æˆåŠŸéƒ¨ç½²

### æ–‡æ¡£æ›´æ–°
- æ›´æ–° `docs/API.md` æ·»åŠ iOSå®¢æˆ·ç«¯é”™è¯¯ä¿®å¤æŒ‡å¯¼
- æä¾›è¯¦ç»†çš„å‰ç«¯é…ç½®ä¿®å¤æ–¹æ³•
- åŒ…å«å®Œæ•´çš„APIConfig.Endpointæšä¸¾ç¤ºä¾‹

// ... existing code ...

## 2025-06-27 - OCRè®¤è¯Bugä¿®å¤ (v1.0.14)

### é—®é¢˜æŠ¥å‘Š
ç”¨æˆ·åé¦ˆOCRè§£æAPIè¿”å›é”™è¯¯ï¼š
- `âŒ åç«¯è§£æå¤±è´¥: decodingError`
- `âŒ é”™è¯¯ï¼šOCRè¯†åˆ«å¤±è´¥ï¼šNetwork error: åç«¯è§£æå¤±è´¥: æ•°æ®è§£æå¤±è´¥`

### é—®é¢˜åˆ†æ
é€šè¿‡åˆ›å»ºæµ‹è¯•ç”¨æˆ·å’ŒAPIè°ƒè¯•ï¼Œå‘ç°æ ¹æœ¬åŸå› ï¼š

1. **è®¤è¯ä¸­é—´ä»¶ä¸ä¸€è‡´**ï¼š
   - è®¤è¯ä¸­é—´ä»¶ (`src/middleware/auth.js`) è®¾ç½®ï¼š`req.userId = sessionData.user.id`
   - OCRæ§åˆ¶å™¨æœŸæœ›ï¼š`const userId = req.user.id`

2. **å…¶ä»–æ§åˆ¶å™¨å¯¹æ¯”**ï¼š
   - `expenseController.js`ï¼šä½¿ç”¨ `req.userId` âœ…
   - `authController.js`ï¼šä½¿ç”¨ `req.userId` âœ…  
   - `budgetController.js`ï¼šä½¿ç”¨ `req.userId` âœ…
   - `ocrController.js`ï¼šä½¿ç”¨ `req.user.id` âŒ

3. **å…·ä½“é”™è¯¯**ï¼š
   - `Cannot read properties of undefined (reading 'id')`
   - å› ä¸º `req.user` æ˜¯ undefinedï¼Œå°è¯•è®¿é—® `.id` å±æ€§å¤±è´¥

### è§£å†³æ–¹æ¡ˆå®æ–½
**ä¿®å¤ç±»å‹**: åç«¯Bugä¿®å¤

ä¿®æ”¹äº† `src/controllers/ocrController.js` ä¸­æ‰€æœ‰æ–¹æ³•ï¼Œå°† `req.user.id` æ”¹ä¸º `req.userId`ï¼š

1. `parseText()` - OCRæ–‡æœ¬è§£æ
2. `parseTextAndAutoCreate()` - OCRè‡ªåŠ¨åˆ›å»ºæ”¯å‡º
3. `confirmAndCreateExpense()` - ç¡®è®¤å¹¶åˆ›å»ºæ”¯å‡ºè®°å½•
4. `getRecords()` - è·å–OCRè®°å½•åˆ—è¡¨
5. `getRecord()` - è·å–å•ä¸ªOCRè®°å½•
6. `deleteRecord()` - åˆ é™¤OCRè®°å½•
7. `getStatistics()` - è·å–OCRç»Ÿè®¡ä¿¡æ¯
8. `generateShortcut()` - ç”ŸæˆiOSå¿«æ·æŒ‡ä»¤

### ä¿®å¤éªŒè¯
- **æœ¬åœ°æµ‹è¯•**: âœ… ä½¿ç”¨çœŸå®OCRæ–‡æœ¬æµ‹è¯•æˆåŠŸ
- **ç”Ÿäº§ç¯å¢ƒ**: âœ… éƒ¨ç½²å¹¶éªŒè¯APIæ­£å¸¸å·¥ä½œ
- **APIå“åº”**: æ­£ç¡®è§£æOCRæ–‡æœ¬ï¼Œè¿”å›ç»“æ„åŒ–æ•°æ®

### æµ‹è¯•ç»“æœ
```json
{
  "success": true,
  "message": "éƒ¨åˆ†è§£ææˆåŠŸ",
  "data": {
    "recordId": "594dc747-26db-414d-8704-b21a40ab7f7b",
    "parsedData": {
      "amount": 4,
      "amountConfidence": 0.5,
      "merchant": null,
      "category": "å…¶ä»–",
      "overallConfidence": 0.41
    }
  }
}
```

### éƒ¨ç½²ä¿¡æ¯
- **ç‰ˆæœ¬**: v1.0.14
- **æäº¤**: 77c5da1 - OCRæ§åˆ¶å™¨è®¤è¯Bugä¿®å¤
- **ç”Ÿäº§URL**: https://expense-tracker-backend-1mnvyo1le-likexin0304s-projects.vercel.app
- **éƒ¨ç½²çŠ¶æ€**: âœ… æˆåŠŸéƒ¨ç½²å¹¶æµ‹è¯•é€šè¿‡

### å½±å“èŒƒå›´
- **å‰ç«¯**: æ— éœ€ä¿®æ”¹ï¼Œé—®é¢˜å®Œå…¨åœ¨åç«¯
- **iOSåº”ç”¨**: ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨æ‰€æœ‰OCRç›¸å…³åŠŸèƒ½
- **APIä¸€è‡´æ€§**: æ‰€æœ‰æ§åˆ¶å™¨ç°åœ¨ç»Ÿä¸€ä½¿ç”¨ `req.userId`

## 2025-06-27 - Express Rate Limitingé…ç½®ä¼˜åŒ– (v1.0.15)

### é—®é¢˜æŠ¥å‘Š
**æ—¶é—´**: 2025-06-27 16:25:00 GMT+8

æœåŠ¡å™¨å¯åŠ¨æ—¶å‡ºç°ValidationErrorè­¦å‘Šï¼š
```
ValidationError: The Express 'trust proxy' setting is true, which allows anyone to trivially bypass IP-based rate limiting.
```

### é—®é¢˜åˆ†æ
1. **æ ¹æœ¬åŸå› **: 
   - è®¾ç½®äº†`app.set('trust proxy', true)`ç”¨äºVerceléƒ¨ç½²
   - express-rate-limitè®¤ä¸ºè¿™æ ·é…ç½®ä¸å®‰å…¨ï¼Œå¯èƒ½è¢«ç»•è¿‡
   - éœ€è¦æ›´ç²¾ç¡®çš„trust proxyé…ç½®å’Œè‡ªå®šä¹‰keyGenerator

2. **å®‰å…¨é£é™©**:
   - é€šç”¨çš„trust proxyè®¾ç½®å¯èƒ½è¢«æ¶æ„ç”¨æˆ·ç»•è¿‡
   - éœ€è¦æ ¹æ®ç¯å¢ƒåŠ¨æ€å¤„ç†IPè·å–é€»è¾‘

### è§£å†³æ–¹æ¡ˆå®æ–½

#### 1. ä¼˜åŒ–Rate Limitingé…ç½®
ä¿®æ”¹ `src/app.js` ä¸­çš„é™æµä¸­é—´ä»¶ï¼š

```javascript
// é™æµä¸­é—´ä»¶ - ä¼˜åŒ–é…ç½®ä»¥é¿å…trust proxyè­¦å‘Š
const limiter = rateLimit({
    windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ
    max: 100, // æœ€å¤š100ä¸ªè¯·æ±‚
    message: {
        success: false,
        message: 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•'
    },
    // è‡ªå®šä¹‰IPè·å–é€»è¾‘ï¼Œé¿å…trust proxyè­¦å‘Š
    keyGenerator: (req) => {
        // åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨X-Forwarded-Forï¼ˆç”±Vercelæä¾›ï¼‰ï¼Œå¼€å‘ç¯å¢ƒä½¿ç”¨çœŸå®IP
        if (process.env.NODE_ENV === 'production' && req.headers['x-forwarded-for']) {
            // ä»X-Forwarded-Forå¤´éƒ¨è·å–çœŸå®IPï¼ˆå–ç¬¬ä¸€ä¸ªIPï¼‰
            const forwarded = req.headers['x-forwarded-for'];
            return Array.isArray(forwarded) ? forwarded[0] : forwarded.split(',')[0].trim();
        }
        // å¼€å‘ç¯å¢ƒæˆ–æ²¡æœ‰ä»£ç†å¤´éƒ¨æ—¶ä½¿ç”¨è¿æ¥IP
        return req.connection.remoteAddress || req.socket.remoteAddress || req.ip || 'unknown';
    },
    // è·³è¿‡trust proxyéªŒè¯ï¼Œä½¿ç”¨è‡ªå®šä¹‰keyGenerator
    skipSuccessfulRequests: false,
    skipFailedRequests: false
});
```

#### 2. æ”¹è¿›æ™ºèƒ½è·¯å¾„é‡å®šå‘ä¸­é—´ä»¶
å¢å¼ºé”™è¯¯æ£€æµ‹å’Œæç¤ºåŠŸèƒ½ï¼Œæä¾›è¯¦ç»†çš„iOSå®¢æˆ·ç«¯ä¿®å¤æŒ‡å¯¼ï¼š

```javascript
// æ™ºèƒ½è·¯å¾„é‡å®šå‘ä¸­é—´ä»¶ - å¤„ç†é‡å¤çš„/apiå‰ç¼€
app.use((req, res, next) => {
    if (req.originalUrl.startsWith('/api/api/')) {
        const correctedPath = req.originalUrl.replace('/api/api/', '/api/');
        console.log(`ğŸ”§ æ£€æµ‹åˆ°é‡å¤è·¯å¾„: ${req.originalUrl} -> ${correctedPath}`);
        
        return res.status(400).json({
            success: false,
            error: 'URL_PATH_DUPLICATE',
            message: 'æ£€æµ‹åˆ°é‡å¤çš„APIè·¯å¾„å‰ç¼€',
            details: {
                received: req.originalUrl,
                correct: correctedPath,
                problem: 'æ‚¨çš„è¯·æ±‚URLåŒ…å«é‡å¤çš„/apiå‰ç¼€',
                solution: 'è¯·æ£€æŸ¥å‰ç«¯ä»£ç ä¸­çš„APIåŸºç¡€URLé…ç½®'
            },
            ios_client_fix: {
                description: 'iOSå®¢æˆ·ç«¯æ¨èçš„ä¿®å¤æ–¹æ³•',
                recommended_approach: {
                    title: 'ä½¿ç”¨APIConfig.Endpointæšä¸¾ï¼ˆæ¨èï¼‰',
                    code: `// è¯¦ç»†çš„Swiftä»£ç ç¤ºä¾‹...`
                },
                common_mistakes: [
                    // è¯¦ç»†çš„å¸¸è§é”™è¯¯ç¤ºä¾‹...
                ]
            },
            help: {
                correct_url: correctedPath,
                test_command: `curl -X ${req.method} http://localhost:3000${correctedPath}`,
                documentation: '/api/debug/routes'
            }
        });
    }
    next();
});
```

#### 3. APIæ–‡æ¡£é‡å¤§æ›´æ–°
æ›´æ–° `docs/API.md`ï¼Œæ·»åŠ å®Œæ•´çš„iOSå®¢æˆ·ç«¯é›†æˆæŒ‡å¯¼ï¼š

**æ–°å¢å†…å®¹**:
- âœ… å®Œæ•´çš„iOSå®¢æˆ·ç«¯é›†æˆæŒ‡å¯¼
- âœ… è¯¦ç»†çš„æ•°æ®æ¨¡å‹å®šä¹‰
- âœ… è‡ªåŠ¨è®°è´¦åŠŸèƒ½çš„å®Œæ•´å®ç°ç¤ºä¾‹
- âœ… é”™è¯¯å¤„ç†å’Œè°ƒè¯•å»ºè®®
- âœ… URLè·¯å¾„é‡å¤é”™è¯¯çš„æ™ºèƒ½æ£€æµ‹è¯´æ˜

**ä¸»è¦æ”¹è¿›**:
1. **APIConfig.Endpointæšä¸¾çš„æ­£ç¡®ä½¿ç”¨æ–¹å¼**
2. **OCRè‡ªåŠ¨è¯†åˆ«APIçš„å®Œæ•´è°ƒç”¨æµç¨‹**
3. **æ•°æ®æ¨¡å‹å®šä¹‰å’Œé”™è¯¯å¤„ç†**
4. **è‡ªåŠ¨è®°è´¦åŠŸèƒ½çš„å®Œæ•´å®ç°ç¤ºä¾‹**
5. **URLè·¯å¾„é‡å¤é—®é¢˜çš„æ™ºèƒ½æ£€æµ‹å’Œä¿®å¤**

### æµ‹è¯•éªŒè¯
- âœ… æœåŠ¡å™¨å¯åŠ¨æ— ValidationErrorè­¦å‘Š
- âœ… URLè·¯å¾„é‡å¤æ™ºèƒ½æ£€æµ‹æ­£å¸¸å·¥ä½œ
- âœ… è¿”å›è¯¦ç»†çš„iOSå®¢æˆ·ç«¯ä¿®å¤æŒ‡å¯¼
- âœ… Rate limitingåŠŸèƒ½æ­£å¸¸
- âœ… å¥åº·æ£€æŸ¥æ¥å£æ­£å¸¸

**æµ‹è¯•å‘½ä»¤**:
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3000/health

# æµ‹è¯•URLè·¯å¾„é‡å¤æ£€æµ‹
curl -X POST http://localhost:3000/api/api/ocr/parse \
  -H "Content-Type: application/json" \
  -d '{"text":"æµ‹è¯•æ–‡æœ¬"}'
```

### å‰ç«¯é›†æˆæŒ‡å¯¼æ€»ç»“
æä¾›äº†å®Œæ•´çš„iOSå®¢æˆ·ç«¯é›†æˆæ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š

1. **APIé…ç½®æœ€ä½³å®è·µ**:
   ```swift
   struct APIConfig {
       static let baseURL = "https://expense-tracker-backend-1mnvyo1le-likexin0304s-projects.vercel.app"
       
       enum Endpoint: String {
           case ocrParseAuto = "/api/ocr/parse-auto"
           // ...å…¶ä»–ç«¯ç‚¹
       }
   }
   ```

2. **è‡ªåŠ¨è®°è´¦åŠŸèƒ½å®Œæ•´å®ç°**:
   - OCRæ–‡æœ¬è§£æå’Œè‡ªåŠ¨åˆ›å»º
   - ç”¨æˆ·ç¡®è®¤æµç¨‹
   - é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
   - å®Œæ•´çš„UIé›†æˆç¤ºä¾‹

3. **æ•°æ®æ¨¡å‹å®šä¹‰**:
   - OCRAutoResponse, OCRParseResponse
   - ParsedData, MerchantInfo, AmountInfoç­‰
   - å®Œæ•´çš„é”™è¯¯å¤„ç†æšä¸¾

4. **è°ƒè¯•å’Œé”™è¯¯å¤„ç†**:
   - URLæ„å»ºéªŒè¯
   - ç½‘ç»œè¯·æ±‚ç›‘æ§
   - é”™è¯¯å“åº”å¤„ç†
   - ç½‘ç»œè°ƒè¯•å·¥å…·ä½¿ç”¨

### éƒ¨ç½²çŠ¶æ€
- **æœ¬åœ°å¼€å‘ç¯å¢ƒ**: âœ… å·²ä¿®å¤å¹¶æµ‹è¯•é€šè¿‡
- **ç”Ÿäº§ç¯å¢ƒ**: â³ éœ€è¦é‡æ–°éƒ¨ç½²åˆ°Vercel
- **é…ç½®ä¼˜åŒ–**: âœ… å®Œæˆ
- **æ–‡æ¡£æ›´æ–°**: âœ… å®Œæˆ

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
2. éªŒè¯ç”Ÿäº§ç¯å¢ƒçš„rate limitingåŠŸèƒ½
3. æµ‹è¯•å‰ç«¯é›†æˆæ•ˆæœ
4. ç›‘æ§APIä½¿ç”¨æƒ…å†µ

## 2025-10-17 - å‰ç«¯ä¿®å¤æŒ‡å—æ›´æ–°

### ğŸ“± å‰ç«¯å¼€å‘è€…å¿…è¯»

**é—®é¢˜**: å¦‚æœå‰ç«¯ä½¿ç”¨äº†é”™è¯¯çš„API URLï¼Œä¼šå¯¼è‡´OCRè‡ªåŠ¨è®°è´¦åŠŸèƒ½å¤±è´¥ã€‚

**ç«‹å³æ£€æŸ¥**: ä½ çš„å‰ç«¯ä»£ç ä¸­æ˜¯å¦ä½¿ç”¨äº†è¿™ä¸ªé”™è¯¯çš„URLï¼š
```
âŒ https://expense-tracker-backend-mocrhvaay-likexin0304s-projects.vercel.app
```

**ç«‹å³ä¿®å¤**: æ›´æ–°ä¸ºæ­£ç¡®çš„URLï¼š
```
âœ… https://expense-tracker-backend-1mnvyo1le-likexin0304s-projects.vercel.app
```

### ğŸ› ï¸ ä¿®å¤æ­¥éª¤

1. **æ£€æŸ¥APIConfigæ–‡ä»¶**: æŸ¥æ‰¾å¹¶æ›´æ–°baseURL
2. **éªŒè¯å¥åº·æ£€æŸ¥**: æµ‹è¯• `/health` ç«¯ç‚¹
3. **æµ‹è¯•OCRåŠŸèƒ½**: éªŒè¯ `/api/ocr/parse-auto` ç«¯ç‚¹
4. **å®ç°åŠ¨æ€é…ç½®**: ä½¿ç”¨ `/api/config` ç«¯ç‚¹ï¼ˆæ¨èï¼‰

### ğŸ“š è¯¦ç»†ä¿®å¤æŒ‡å—

å®Œæ•´çš„å‰ç«¯ä¿®å¤ä»£ç å’Œæµ‹è¯•æ–¹æ³•å·²æ›´æ–°åˆ° `docs/API.md` çš„"ğŸš¨ å‰ç«¯ç´§æ€¥ä¿®å¤æŒ‡å—"éƒ¨åˆ†ï¼ŒåŒ…æ‹¬ï¼š

- âœ… **Swiftä»£ç ç¤ºä¾‹**: å®Œæ•´çš„APIConfigé…ç½®
- âœ… **åŠ¨æ€é…ç½®ç®¡ç†å™¨**: APIConfigManagerå®ç°
- âœ… **å®Œæ•´çš„æµ‹è¯•å¥—ä»¶**: APIConnectionTestsç±»
- âœ… **éªŒè¯æ¸…å•**: é€æ­¥æ£€æŸ¥æŒ‡å—
- âœ… **é”™è¯¯å¤„ç†**: è¯¦ç»†çš„è°ƒè¯•æ–¹æ³•

### ğŸ¯ å‰ç«¯å¼€å‘è€…è¡ŒåŠ¨æ¸…å•

**ç«‹å³è¡ŒåŠ¨**:
- [ ] æ£€æŸ¥å¹¶æ›´æ–°APIConfigä¸­çš„baseURL
- [ ] è¿è¡Œå¥åº·æ£€æŸ¥æµ‹è¯•
- [ ] æµ‹è¯•OCRè‡ªåŠ¨è®°è´¦åŠŸèƒ½
- [ ] éªŒè¯æ‰€æœ‰APIç«¯ç‚¹æ­£å¸¸å·¥ä½œ

**æ¨èå®ç°**:
- [ ] å®ç°åŠ¨æ€é…ç½®ç®¡ç†å™¨
- [ ] æ·»åŠ APIè¿æ¥æµ‹è¯•å¥—ä»¶
- [ ] åœ¨åº”ç”¨å¯åŠ¨æ—¶åŠ è½½é…ç½®
- [ ] æ·»åŠ è°ƒè¯•å’Œç›‘æ§åŠŸèƒ½

### ğŸ“Š ä¿®å¤éªŒè¯

å®Œæˆä¿®å¤åï¼Œè¯·éªŒè¯ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹è¿”å›200çŠ¶æ€ç 
- [ ] âœ… OCRè‡ªåŠ¨è®°è´¦ç«¯ç‚¹å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] âœ… è®¤è¯ç›¸å…³APIæ­£å¸¸å·¥ä½œ
- [ ] âœ… å‰ç«¯ä¸å†å‡ºç°"Cannot read properties of undefined"é”™è¯¯
- [ ] âœ… "æ‰‹æœºç‚¹å‡»èƒŒå3æ¬¡è‡ªåŠ¨è®°è´¦"åŠŸèƒ½æ­£å¸¸å·¥ä½œ

**ğŸš€ ä¿®å¤å®Œæˆåï¼ŒOCRè‡ªåŠ¨è®°è´¦åŠŸèƒ½å°†å®Œå…¨æ­£å¸¸å·¥ä½œï¼**

## 2025-10-17 - OCRç¡®è®¤åŠŸèƒ½å®Œå–„

### ğŸ“‹ éœ€æ±‚åˆ†æ

å‰ç«¯å›¢é˜Ÿæå‡ºéœ€è¦å¢åŠ OCRç¡®è®¤åŠŸèƒ½ï¼š
- ç”¨æˆ·åœ¨OCRè¯†åˆ«åå¯ä»¥æ‰‹åŠ¨ç¡®è®¤å’Œä¿®æ­£ç»“æœ
- ç¡®è®¤åå†åˆ›å»ºæ”¯å‡ºè®°å½•
- éœ€è¦å®Œå–„çš„é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼

### ğŸ” ç°çŠ¶æ£€æŸ¥

æ£€æŸ¥äº†å‰ç«¯éœ€æ±‚æ¸…å• `docs/åç«¯APIéœ€æ±‚æ¸…å•.md`ï¼Œå‘ç°ï¼š

#### âœ… å·²å®ç°çš„API
1. `POST /api/ocr/parse-auto` - OCRè‡ªåŠ¨è§£æAPI
2. `POST /api/ocr/confirm/:recordId` - OCRç¡®è®¤å¹¶åˆ›å»ºæ”¯å‡ºAPI

#### âš ï¸ éœ€è¦è°ƒæ•´çš„éƒ¨åˆ†
1. **å“åº”æ ¼å¼ä¸åŒ¹é…**: å‰ç«¯æœŸæœ›çš„`parsedData`ç»“æ„ä¸å½“å‰å®ç°ä¸åŒ
2. **é”™è¯¯å¤„ç†ä¸å®Œå–„**: ç¼ºå°‘è¯¦ç»†çš„é”™è¯¯å“åº”æ ¼å¼
3. **å­—æ®µå‘½åä¸ä¸€è‡´**: `paymentMethod.value` vs `paymentMethod.type`

### ğŸ› ï¸ å®æ–½çš„æ”¹è¿›

#### 1. å“åº”æ ¼å¼æ ‡å‡†åŒ–

**ä¿®æ”¹å‰**:
```json
{
  "data": {
    "autoCreated": false,
    "recordId": "uuid",
    "parsedData": { /* åŸå§‹æ ¼å¼ */ },
    "confidence": 0.65
  }
}
```

**ä¿®æ”¹å**:
```json
{
  "data": {
    "autoCreated": false,
    "recordId": "uuid",
    "expense": null,
    "ocrRecord": {
      "id": "uuid",
      "originalText": "åŸå§‹æ–‡æœ¬",
      "parsedData": { /* åŸå§‹è§£ææ•°æ® */ },
      "confidenceScore": 0.65,
      "status": "success"
    },
    "parsedData": {
      "amount": { "value": 25.80, "confidence": 0.98 },
      "merchant": { "name": "éº¦å½“åŠ³", "confidence": 0.95 },
      "date": { "value": "2024-01-15", "confidence": 0.90 },
      "category": { "name": "é¤é¥®", "confidence": 0.85 },
      "paymentMethod": { "type": "æ”¯ä»˜å®", "confidence": 0.92 },
      "originalText": "åŸå§‹æ–‡æœ¬"
    },
    "confidence": 0.65,
    "suggestions": {
      "shouldAutoCreate": false,
      "needsReview": true,
      "reason": "ç½®ä¿¡åº¦ 0.65 ä½äºé˜ˆå€¼ 0.8"
    }
  }
}
```

#### 2. é”™è¯¯å¤„ç†å®Œå–„

**åœºæ™¯1: recordIdä¸å­˜åœ¨ (404)**
```json
{
  "success": false,
  "message": "OCRè®°å½•ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸ",
  "error": "RECORD_NOT_FOUND"
}
```

**åœºæ™¯2: å¿…å¡«å­—æ®µç¼ºå¤± (400)**
```json
{
  "success": false,
  "message": "ç¼ºå°‘å¿…å¡«å­—æ®µ",
  "error": "VALIDATION_ERROR",
  "details": {
    "amount": "é‡‘é¢ä¸èƒ½ä¸ºç©ºä¸”å¿…é¡»å¤§äº0",
    "category": "åˆ†ç±»ä¸èƒ½ä¸ºç©º",
    "description": "æè¿°ä¸èƒ½ä¸ºç©º"
  }
}
```

**åœºæ™¯3: è®°å½•å·²ç¡®è®¤ (409)**
```json
{
  "success": false,
  "message": "è¯¥è®°å½•å·²è¢«ç¡®è®¤ï¼Œä¸èƒ½é‡å¤ç¡®è®¤",
  "error": "RECORD_ALREADY_CONFIRMED"
}
```

#### 3. ç»Ÿä¸€å“åº”æ ¼å¼

æ‰€æœ‰ä¸‰ç§æƒ…å†µï¼ˆè‡ªåŠ¨åˆ›å»ºæˆåŠŸã€è‡ªåŠ¨åˆ›å»ºå¤±è´¥ã€ç½®ä¿¡åº¦ä¸å¤Ÿï¼‰éƒ½ä½¿ç”¨ç›¸åŒçš„å“åº”ç»“æ„ï¼š

- âœ… `autoCreated`: boolean - æ˜¯å¦è‡ªåŠ¨åˆ›å»º
- âœ… `recordId`: string - OCRè®°å½•ID
- âœ… `expense`: object | null - æ”¯å‡ºè®°å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºæ—¶ï¼‰
- âœ… `ocrRecord`: object - OCRè®°å½•è¯¦æƒ…
- âœ… `parsedData`: object - æ ¼å¼åŒ–çš„è§£ææ•°æ®
- âœ… `confidence`: number - æ•´ä½“ç½®ä¿¡åº¦
- âœ… `suggestions`: object - å»ºè®®ä¿¡æ¯

### ğŸ“š æ–‡æ¡£æ›´æ–°

#### 1. API.mdæ–°å¢å†…å®¹

- âœ… **OCRç¡®è®¤åŠŸèƒ½å®Œæ•´æŒ‡å—**: è¯¦ç»†çš„ä¸¤æ­¥æµç¨‹è¯´æ˜
- âœ… **å®Œæ•´æµç¨‹ç¤ºä¾‹**: curlå‘½ä»¤å’Œå“åº”ç¤ºä¾‹
- âœ… **Swiftä»£ç ç¤ºä¾‹**: å‰ç«¯é›†æˆä»£ç 
- âœ… **é”™è¯¯å“åº”æ ¼å¼**: æ‰€æœ‰é”™è¯¯åœºæ™¯çš„è¯¦ç»†è¯´æ˜
- âœ… **æ•°æ®æ¨¡å‹å®šä¹‰**: å‰ç«¯æœŸæœ›çš„ParsedDataæ ¼å¼

#### 2. æ›´æ–°çš„APIç«¯ç‚¹æ–‡æ¡£

**`POST /api/ocr/parse-auto`**:
- âœ… è‡ªåŠ¨åˆ›å»ºæˆåŠŸå“åº” (201)
- âœ… éœ€è¦ç¡®è®¤å“åº” (200)
- âœ… è§£æå¤±è´¥å“åº” (400)

**`POST /api/ocr/confirm/:recordId`**:
- âœ… æˆåŠŸåˆ›å»ºå“åº” (201)
- âœ… è®°å½•ä¸å­˜åœ¨ (404)
- âœ… å­—æ®µéªŒè¯é”™è¯¯ (400)
- âœ… è®°å½•å·²ç¡®è®¤ (409)

### ğŸ¯ åŠŸèƒ½éªŒè¯

#### æ”¯æŒçš„è¯†åˆ«å­—æ®µ
1. **ğŸ’° é‡‘é¢** (æƒé‡40%) - æ”¯æŒå¤šç§æ ¼å¼ï¼šÂ¥25.80ã€25.80å…ƒã€$25.80ç­‰
2. **ğŸª å•†æˆ·** (æƒé‡30%) - æ™ºèƒ½åŒ¹é…é¢„ç½®å•†æˆ·æ•°æ®åº“
3. **ğŸ“… æ—¥æœŸ** (æƒé‡20%) - æ”¯æŒå¤šç§æ ¼å¼ï¼š2024-01-15ã€2024å¹´1æœˆ15æ—¥ç­‰
4. **ğŸ’³ æ”¯ä»˜æ–¹å¼** (æƒé‡10%) - æ”¯æŒï¼šæ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜ã€é“¶è¡Œå¡ç­‰
5. **ğŸ“‚ åˆ†ç±»** - åŸºäºå•†æˆ·åŒ¹é…æˆ–å…³é”®è¯æ¨æ–­

#### ç½®ä¿¡åº¦æœºåˆ¶
- **â‰¥ 0.8**: è‡ªåŠ¨åˆ›å»ºæ”¯å‡ºè®°å½•
- **0.6-0.79**: éœ€è¦ç”¨æˆ·ç¡®è®¤
- **< 0.6**: éœ€è¦ä»”ç»†æ£€æŸ¥

#### åˆ†ç±»å’Œæ”¯ä»˜æ–¹å¼æ˜ å°„
- **ä¸­æ–‡ â†’ è‹±æ–‡**: é¤é¥®â†’food, æ”¯ä»˜å®â†’onlineç­‰
- **å®Œæ•´æ˜ å°„**: 9ä¸ªåˆ†ç±»ï¼Œ6ç§æ”¯ä»˜æ–¹å¼

### âœ… å®ŒæˆçŠ¶æ€

#### åç«¯API
- âœ… `POST /api/ocr/parse-auto` - å®Œå…¨ç¬¦åˆå‰ç«¯éœ€æ±‚
- âœ… `POST /api/ocr/confirm/:recordId` - å®Œå…¨ç¬¦åˆå‰ç«¯éœ€æ±‚
- âœ… é”™è¯¯å¤„ç† - æ‰€æœ‰åœºæ™¯è¦†ç›–
- âœ… å“åº”æ ¼å¼ - ç»Ÿä¸€æ ‡å‡†åŒ–

#### æ–‡æ¡£
- âœ… API.md - æ–°å¢OCRç¡®è®¤åŠŸèƒ½å®Œæ•´æŒ‡å—
- âœ… æµç¨‹ç¤ºä¾‹ - å®Œæ•´çš„curlå’ŒSwiftä»£ç 
- âœ… æ•°æ®æ¨¡å‹ - è¯¦ç»†çš„TypeScriptå®šä¹‰
- âœ… é”™è¯¯å¤„ç† - æ‰€æœ‰é”™è¯¯åœºæ™¯è¯´æ˜

### ğŸš€ å‰ç«¯é›†æˆ

å‰ç«¯ç°åœ¨å¯ä»¥ï¼š

1. **è°ƒç”¨è§£æAPI**: è·å–OCRè¯†åˆ«ç»“æœ
2. **åˆ¤æ–­æ˜¯å¦éœ€è¦ç¡®è®¤**: æ£€æŸ¥`autoCreated`å­—æ®µ
3. **æ˜¾ç¤ºç¡®è®¤ç•Œé¢**: ä½¿ç”¨`parsedData`é¢„å¡«å……è¡¨å•
4. **æäº¤ç¡®è®¤**: è°ƒç”¨ç¡®è®¤APIåˆ›å»ºæ”¯å‡ºè®°å½•
5. **å¤„ç†æ‰€æœ‰é”™è¯¯**: æ ¹æ®é”™è¯¯ç æ˜¾ç¤ºç›¸åº”æç¤º

**ğŸ‰ OCRç¡®è®¤åŠŸèƒ½ç°åœ¨å®Œå…¨å¯ç”¨ï¼Œå‰ç«¯æ— éœ€ä»»ä½•é¢å¤–çš„åç«¯æ”¯æŒï¼**

## 2025-10-27 - OCRç¡®è®¤åŠŸèƒ½éƒ¨ç½²å®Œæˆ

### ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çŠ¶æ€

#### âœ… éƒ¨ç½²éªŒè¯
- **ç”Ÿäº§ç¯å¢ƒURL**: `https://expense-tracker-backend-1mnvyo1le-likexin0304s-projects.vercel.app`
- **å¥åº·æ£€æŸ¥**: âœ… æ­£å¸¸ (çŠ¶æ€: OK, ç¯å¢ƒ: production)
- **OCRè·¯ç”±**: âœ… å…¨éƒ¨åŠ è½½æˆåŠŸ
  - `POST /api/ocr/parse-auto (ğŸ†• è‡ªåŠ¨åˆ›å»º)`
  - `POST /api/ocr/confirm/:recordId`
  - å…¶ä»–8ä¸ªOCRç›¸å…³ç«¯ç‚¹

#### ğŸ”§ åŠŸèƒ½æµ‹è¯•
- **APIè®¤è¯**: âœ… æ­£å¸¸è¿”å›"æ— æ•ˆçš„è®¤è¯ä»¤ç‰Œ"é”™è¯¯
- **è·¯ç”±å“åº”**: âœ… æ‰€æœ‰OCRç«¯ç‚¹æ­£ç¡®åŠ è½½
- **é”™è¯¯å¤„ç†**: âœ… æŒ‰é¢„æœŸè¿”å›JSONæ ¼å¼é”™è¯¯

#### ğŸ“ éƒ¨ç½²è®°å½•
- **æœ€æ–°æäº¤**: `ea36a17 âœ¨ å®Œå–„OCRç¡®è®¤åŠŸèƒ½ - ç¬¦åˆå‰ç«¯éœ€æ±‚è§„èŒƒ`
- **éƒ¨ç½²æ—¶é—´**: 2025-10-27 05:56:18 UTC
- **éƒ¨ç½²çŠ¶æ€**: âœ… æˆåŠŸ
- **ä»£ç åŒæ­¥**: âœ… GitHubä¸ç”Ÿäº§ç¯å¢ƒä¸€è‡´

### ğŸ¯ å‰ç«¯å¯ç”¨åŠŸèƒ½

#### 1. OCRè‡ªåŠ¨è§£æ (`POST /api/ocr/parse-auto`)
- âœ… æ ‡å‡†åŒ–çš„`parsedData`å“åº”æ ¼å¼
- âœ… `paymentMethod.type`å­—æ®µå‘½åç»Ÿä¸€
- âœ… `ocrRecord`å¯¹è±¡åŒ…å«å®Œæ•´ä¿¡æ¯
- âœ… ä¸‰ç§å“åº”åœºæ™¯ï¼šè‡ªåŠ¨åˆ›å»ºæˆåŠŸã€éœ€è¦ç¡®è®¤ã€è§£æå¤±è´¥

#### 2. OCRç¡®è®¤åˆ›å»º (`POST /api/ocr/confirm/:recordId`)
- âœ… è¯¦ç»†çš„é”™è¯¯å“åº”æ ¼å¼
- âœ… 404: `RECORD_NOT_FOUND`
- âœ… 400: `VALIDATION_ERROR` (å«è¯¦ç»†å­—æ®µé”™è¯¯)
- âœ… 409: `RECORD_ALREADY_CONFIRMED`
- âœ… 201: æˆåŠŸåˆ›å»ºæ”¯å‡ºè®°å½•

#### 3. å®Œæ•´çš„APIæ–‡æ¡£
- âœ… `docs/API.md` - OCRç¡®è®¤åŠŸèƒ½å®Œæ•´æŒ‡å—
- âœ… Swiftä»£ç ç¤ºä¾‹å’Œé›†æˆæŒ‡å¯¼
- âœ… é”™è¯¯å¤„ç†å’Œæ•°æ®æ¨¡å‹å®šä¹‰
- âœ… å‰ç«¯ç´§æ€¥ä¿®å¤æŒ‡å—

### ğŸ é¡¹ç›®çŠ¶æ€æ€»ç»“

**OCRç¡®è®¤åŠŸèƒ½å¼€å‘å’Œéƒ¨ç½²å·²å®Œå…¨å®Œæˆï¼**

- âœ… **åç«¯å¼€å‘**: å“åº”æ ¼å¼æ ‡å‡†åŒ–ã€é”™è¯¯å¤„ç†å®Œå–„
- âœ… **APIæ–‡æ¡£**: è¯¦ç»†çš„é›†æˆæŒ‡å—å’Œä»£ç ç¤ºä¾‹  
- âœ… **ç”Ÿäº§éƒ¨ç½²**: æ‰€æœ‰åŠŸèƒ½å·²éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- âœ… **åŠŸèƒ½éªŒè¯**: ç”Ÿäº§ç¯å¢ƒAPIæ­£å¸¸å“åº”

**å‰ç«¯å›¢é˜Ÿç°åœ¨å¯ä»¥ï¼š**
1. ä½¿ç”¨æ ‡å‡†åŒ–çš„OCRè§£æAPI
2. å®ç°ç”¨æˆ·ç¡®è®¤ç•Œé¢
3. å¤„ç†æ‰€æœ‰é”™è¯¯åœºæ™¯
4. å‚è€ƒå®Œæ•´çš„Swiftä»£ç ç¤ºä¾‹

**ğŸ‰ é¡¹ç›®è¿›å…¥å‰ç«¯é›†æˆé˜¶æ®µï¼Œåç«¯æ”¯æŒå·²å®Œå¤‡ï¼**

## 2025-10-27 - OCRç¡®è®¤åŠŸèƒ½Expense.createé”™è¯¯ä¿®å¤

### ğŸ› é—®é¢˜æŠ¥å‘Š

ç”¨æˆ·åœ¨ä½¿ç”¨OCRç¡®è®¤åŠŸèƒ½æ—¶é‡åˆ°é”™è¯¯ï¼š

```
STATUS: 500
ERROR: "Expense.create is not a function"
```

**é”™è¯¯ä½ç½®**: `POST /api/ocr/confirm/:recordId`

### ğŸ” é—®é¢˜åˆ†æ

#### 1. åˆæ­¥è¯Šæ–­
- é”™è¯¯æç¤ºï¼š`Expense.create is not a function`
- å‘ç”Ÿåœ¨OCRç¡®è®¤åŠŸèƒ½ä¸­
- ç”Ÿäº§ç¯å¢ƒå’Œæœ¬åœ°ç¯å¢ƒéƒ½å‡ºç°

#### 2. æ ¹æœ¬åŸå› å®šä½
ç»è¿‡è¯¦ç»†è°ƒæŸ¥ï¼Œå‘ç°OCRæ§åˆ¶å™¨ä¸­æœ‰**ä¸¤ä¸ª**è°ƒç”¨`Expense.create`çš„åœ°æ–¹ï¼š

1. **parseTextAndAutoCreateæ–¹æ³•**ï¼ˆç¬¬294è¡Œï¼‰- è‡ªåŠ¨åˆ›å»ºè·¯å¾„
2. **confirmAndCreateExpenseæ–¹æ³•**ï¼ˆç¬¬582è¡Œï¼‰- æ‰‹åŠ¨ç¡®è®¤è·¯å¾„

é—®é¢˜å¯èƒ½ç”±ä»¥ä¸‹åŸå› å¼•èµ·ï¼š
- `expenseController.js`ä¸­é‡å¤å¯¼å…¥Expenseæ¨¡å—
- æ¨¡å—ç¼“å­˜å¯¼è‡´`Expense.create`é™æ€æ–¹æ³•ä¸¢å¤±
- Node.jsæ¨¡å—è§£æé—®é¢˜

### ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

#### æ–¹æ¡ˆ1: ç»Ÿä¸€æ¨¡å—å¯¼å…¥ï¼ˆæœªè§£å†³ï¼‰
```javascript
// ä¿®æ”¹å‰
const categories = require('../models/Expense').CATEGORIES;

// ä¿®æ”¹å
const { Expense, CATEGORIES, PAYMENT_METHODS } = require('../models/Expense');
const categories = CATEGORIES;
```

#### æ–¹æ¡ˆ2: ä¿®æ”¹å¯¼å…¥æ–¹å¼ï¼ˆæœªè§£å†³ï¼‰
```javascript
const ExpenseModule = require('../models/Expense');
const Expense = ExpenseModule.Expense;
```

#### æ–¹æ¡ˆ3: å¤šé‡å¤‡ç”¨è°ƒç”¨ï¼ˆæœªè§£å†³ï¼‰
æ·»åŠ äº†è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œå¤šé‡å¤‡ç”¨æ–¹æ¡ˆï¼Œä½†ä»æœªè§£å†³

#### âœ… æœ€ç»ˆæ–¹æ¡ˆ: ç»•è¿‡é™æ€æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨Supabase

**æ ¸å¿ƒæ€è·¯**: ä¸å†ä¾èµ–`Expense.create`é™æ€æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨Supabase Adminå®¢æˆ·ç«¯æ’å…¥æ•°æ®

**å®ç°ä»£ç **:
```javascript
// ç›´æ¥ä½¿ç”¨Supabaseåˆ›å»ºæ”¯å‡ºè®°å½•
const { supabaseAdmin } = require('../utils/supabase');

// éªŒè¯æ•°æ®
if (!expenseData.amount || expenseData.amount <= 0) {
    throw new Error('æ”¯å‡ºé‡‘é¢å¿…é¡»å¤§äº0');
}

// ç›´æ¥æ’å…¥æ•°æ®åº“
const { data: expenseRecord, error: insertError } = await supabaseAdmin
    .from('expenses')
    .insert({
        user_id: expenseData.userId,
        amount: parseFloat(expenseData.amount),
        category: expenseData.category,
        description: expenseData.description,
        date: expenseData.date,
        location: expenseData.location,
        payment_method: expenseData.paymentMethod,
        is_recurring: expenseData.isRecurring || false,
        tags: expenseData.tags || [],
        notes: expenseData.notes || ''
    })
    .select()
    .single();

if (insertError) {
    throw new Error(`åˆ›å»ºæ”¯å‡ºè®°å½•å¤±è´¥: ${insertError.message}`);
}

// åˆ›å»ºExpenseå¯¹è±¡å®ä¾‹
const expense = new Expense(expenseRecord);
```

**ä¿®æ”¹ä½ç½®**:
1. `parseTextAndAutoCreate` - è‡ªåŠ¨åˆ›å»ºè·¯å¾„ï¼ˆç¬¬294-317è¡Œï¼‰
2. `confirmAndCreateExpense` - æ‰‹åŠ¨ç¡®è®¤è·¯å¾„ï¼ˆç¬¬582-620è¡Œï¼‰

### âœ… æœ¬åœ°æµ‹è¯•ç»“æœ

**æµ‹è¯•æ—¶é—´**: 2025-10-27 10:32

**æµ‹è¯•æ­¥éª¤**:
1. åˆ›å»ºæµ‹è¯•ç”¨æˆ·
2. åˆ›å»ºOCRè®°å½•ï¼ˆç½®ä¿¡åº¦ä½ï¼Œéœ€è¦ç¡®è®¤ï¼‰
3. è°ƒç”¨ç¡®è®¤APIåˆ›å»ºæ”¯å‡ºè®°å½•

**æµ‹è¯•ç»“æœ**: âœ… **å®Œå…¨æˆåŠŸ**

```json
{
  "success": true,
  "message": "æ”¯å‡ºè®°å½•åˆ›å»ºæˆåŠŸ",
  "data": {
    "expense": {
      "id": "77825128-af50-4e4f-ac58-e1cd73a0a495",
      "userId": "2e15584a-9584-4934-9977-828782d64513",
      "amount": 50,
      "category": "other",
      "description": "æœ¬åœ°æµ‹è¯•",
      "paymentMethod": "cash",
      ...
    },
    "ocrRecord": {
      "id": "adc3fd80-9748-4fb7-a7c0-0b08770e1325",
      "status": "confirmed",
      "expenseId": "77825128-af50-4e4f-ac58-e1cd73a0a495"
    }
  }
}
```

### âš ï¸ Vercelç”Ÿäº§ç¯å¢ƒé—®é¢˜

**å½“å‰çŠ¶æ€**: âŒ **ç”Ÿäº§ç¯å¢ƒä»è¿”å›æ—§é”™è¯¯**

**é—®é¢˜åˆ†æ**:
1. **ä»£ç å·²æ­£ç¡®æ¨é€**: Gitä»“åº“åŒ…å«æœ€æ–°ä¿®å¤
2. **æœ¬åœ°ç¯å¢ƒæ­£å¸¸**: ä¿®å¤å®Œå…¨æœ‰æ•ˆ
3. **ç”Ÿäº§ç¯å¢ƒå¼‚å¸¸**: ä»è¿”å› `Expense.create is not a function`

**å¯èƒ½åŸå› **:
- Vercelå‡½æ•°ç¼“å­˜æœªæ¸…é™¤
- Vercel CDNç¼“å­˜äº†æ—§ç‰ˆæœ¬
- æ„å»ºç¼“å­˜é—®é¢˜
- éƒ¨ç½²å»¶è¿Ÿï¼ˆéœ€è¦æ›´é•¿æ—¶é—´ï¼‰

**å·²å°è¯•çš„ç¼“å­˜æ¸…é™¤æ–¹æ³•**:
1. âœ… ç‰ˆæœ¬å·å‡çº§ï¼ˆ1.0.13 â†’ 1.0.14ï¼‰
2. âœ… ç©ºæäº¤å¼ºåˆ¶é‡æ–°éƒ¨ç½²
3. âœ… å¤šæ¬¡pushè§¦å‘éƒ¨ç½²
4. âœ… æ·»åŠ ç¼“å­˜æ¸…é™¤æ ‡è¯†

### ğŸ“Š æµ‹è¯•å¯¹æ¯”

| ç¯å¢ƒ | çŠ¶æ€ | é”™è¯¯ä¿¡æ¯ | å¤‡æ³¨ |
|------|------|----------|------|
| æœ¬åœ°å¼€å‘ç¯å¢ƒ | âœ… æˆåŠŸ | - | ä¿®å¤æœ‰æ•ˆ |
| Vercelç”Ÿäº§ç¯å¢ƒ | âŒ å¤±è´¥ | Expense.create is not a function | ç¼“å­˜é—®é¢˜ |

### ğŸš€ åç»­è¡ŒåŠ¨

#### å¯¹ç”¨æˆ·
1. **ä»£ç ä¿®å¤å·²å®Œæˆ** - æœ¬åœ°æµ‹è¯•å®Œå…¨æˆåŠŸ
2. **ç­‰å¾…ç”Ÿäº§éƒ¨ç½²** - Vercelå¯èƒ½éœ€è¦10-30åˆ†é’Ÿå®Œå…¨éƒ¨ç½²
3. **ä¸´æ—¶å»ºè®®** - å¯ä»¥ç»§ç»­å°è¯•ï¼Œç³»ç»Ÿä¼šåœ¨éƒ¨ç½²å®Œæˆåè‡ªåŠ¨æ¢å¤

#### å¯¹å¼€å‘
1. **ç›‘æ§Verceléƒ¨ç½²** - æ£€æŸ¥éƒ¨ç½²æ—¥å¿—å’ŒçŠ¶æ€
2. **ç­‰å¾…ç¼“å­˜è¿‡æœŸ** - å¯èƒ½éœ€è¦è‡ªç„¶è¿‡æœŸ
3. **å¤‡ç”¨æ–¹æ¡ˆ** - å¦‚æœæŒç»­å¤±è´¥ï¼Œè€ƒè™‘é‡æ–°åˆ›å»ºVercelé¡¹ç›®

### ğŸ“ æäº¤è®°å½•

- `b4cefab` - ğŸ› å®Œå…¨ç§»é™¤Expense.createä¾èµ– - ä¿®å¤æ‰€æœ‰è°ƒç”¨è·¯å¾„
- `e91e1ab` - ğŸš€ å¼ºåˆ¶åˆ·æ–°éƒ¨ç½² - v1.0.14ç¼“å­˜æ¸…é™¤ç‰ˆæœ¬
- `34595e2` - ğŸ”§ ç»•è¿‡Expense.createé™æ€æ–¹æ³• - ç›´æ¥ä½¿ç”¨Supabase
- `0161a54` - ğŸ› ä¿®å¤OCRç¡®è®¤åŠŸèƒ½ - Expense.create is not a function

**ğŸ¯ ä¿®å¤çŠ¶æ€: ä»£ç å·²å®Œæˆï¼Œç­‰å¾…Verceléƒ¨ç½²ç”Ÿæ•ˆ**

---

## 2025-01-22 - OCRè§£æundefinedé”™è¯¯ä¿®å¤

### ğŸ“± é—®é¢˜æŠ¥å‘Š

ç”¨æˆ·åœ¨ä½¿ç”¨OCRè¯†åˆ«åŠŸèƒ½æ—¶é‡åˆ°500é”™è¯¯ï¼š
```
STATUS: 500
ERROR: "Cannot read properties of undefined (reading 'id')"
```

**é”™è¯¯åœºæ™¯**:
- OCRè¯†åˆ«çš„æ–‡æœ¬ä¸ºï¼š`"è¯†åˆ« è®¾ç½®"`ï¼ˆæ— æ•ˆçš„è´¦å•æ–‡æœ¬ï¼‰
- è¯†åˆ«ç½®ä¿¡åº¦ï¼š1.00ï¼ˆè¿‡é«˜ï¼Œå®é™…åº”è¯¥æ˜¯0ï¼‰
- åç«¯è¿”å›500é”™è¯¯ï¼Œå¯¼è‡´æ•´ä¸ªOCRæµç¨‹å¤±è´¥

### ğŸ” é—®é¢˜åˆ†æ

#### æ ¹æœ¬åŸå› 
1. **OCRRecordåˆ›å»ºå¤±è´¥åçš„ç©ºå€¼è®¿é—®**ï¼š
   - `OCRRecord.create()` åœ¨æŸäº›å¼‚å¸¸æƒ…å†µä¸‹å¯èƒ½è¿”å› `null` æˆ– `undefined`
   - æ§åˆ¶å™¨ä»£ç ä¸­å¤šå¤„ç›´æ¥è®¿é—® `ocrRecord.id`ï¼Œæ²¡æœ‰è¿›è¡Œé˜²å¾¡æ€§æ£€æŸ¥
   - å½“ `ocrRecord` ä¸º `undefined` æ—¶ï¼Œè®¿é—® `ocrRecord.id` å¯¼è‡´é”™è¯¯

2. **æ„é€ å‡½æ•°ç¼ºå°‘é˜²å¾¡æ€§æ£€æŸ¥**ï¼š
   - `OCRRecord` æ„é€ å‡½æ•°ç›´æ¥è®¿é—® `data.id`ï¼Œå¦‚æœ `data` ä¸º `null/undefined` ä¼šæŠ¥é”™
   - åˆ›å»ºæ–¹æ³•æ²¡æœ‰éªŒè¯æ•°æ®åº“è¿”å›çš„æ•°æ®æ˜¯å¦æœ‰æ•ˆ

3. **æ— æ•ˆæ–‡æœ¬çš„æ—©æœŸåˆ¤æ–­ä¸è¶³**ï¼š
   - å¯¹äº"è¯†åˆ« è®¾ç½®"è¿™ç§æ˜æ˜¾æ— æ•ˆçš„æ–‡æœ¬ï¼Œåº”è¯¥æ—©æœŸè¿”å›å¤±è´¥
   - å½“å‰ä»£ç ç»§ç»­åˆ›å»ºOCRè®°å½•å’Œè§£æï¼Œå¯¼è‡´ä¸å¿…è¦çš„é”™è¯¯

### ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

#### 1. ä¿®å¤ OCRRecord æ„é€ å‡½æ•°ï¼ˆé˜²å¾¡æ€§æ£€æŸ¥ï¼‰

**æ–‡ä»¶**: `src/models/OCRRecord.js`

**ä¿®æ”¹å†…å®¹**:
```javascript
constructor(data) {
    // é˜²å¾¡æ€§æ£€æŸ¥ï¼šç¡®ä¿ data å­˜åœ¨
    if (!data || typeof data !== 'object') {
        throw new Error('OCRRecordæ„é€ å‡½æ•°ï¼šdataå‚æ•°æ— æ•ˆæˆ–ä¸ºç©º');
    }

    // é˜²å¾¡æ€§æ£€æŸ¥ï¼šç¡®ä¿å¿…éœ€çš„ id å­—æ®µå­˜åœ¨
    if (!data.id) {
        throw new Error('OCRRecordæ„é€ å‡½æ•°ï¼šç¼ºå°‘å¿…éœ€çš„idå­—æ®µ');
    }

    // ... å…¶ä½™ä»£ç 
}
```

**æ•ˆæœ**:
- åœ¨æ„é€ å‡½æ•°å±‚é¢å°±æ•è·æ— æ•ˆæ•°æ®
- æä¾›æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯ï¼Œä¾¿äºè°ƒè¯•

#### 2. ä¿®å¤ OCRRecord.create æ–¹æ³•

**æ–‡ä»¶**: `src/models/OCRRecord.js`

**ä¿®æ”¹å†…å®¹**:
```javascript
// é˜²å¾¡æ€§æ£€æŸ¥ï¼šç¡®ä¿ data å­˜åœ¨ä¸”æœ‰æ•ˆ
if (!data || !data.id) {
    console.error('âŒ åˆ›å»ºOCRè®°å½•å¤±è´¥: æ•°æ®åº“è¿”å›çš„æ•°æ®æ— æ•ˆ', { data });
    throw new Error('åˆ›å»ºOCRè®°å½•å¤±è´¥: æ•°æ®åº“è¿”å›çš„æ•°æ®æ— æ•ˆ');
}
```

**æ•ˆæœ**:
- ç¡®ä¿åˆ›å»ºæ–¹æ³•è¿”å›æœ‰æ•ˆå¯¹è±¡æˆ–æŠ›å‡ºæ˜ç¡®é”™è¯¯
- é¿å…è¿”å› `null` æˆ–æ— æ•ˆå¯¹è±¡

#### 3. ä¿®å¤æ§åˆ¶å™¨ä¸­çš„é”™è¯¯å¤„ç†

**æ–‡ä»¶**: `src/controllers/ocrController.js`

**ä¿®æ”¹ä½ç½®**: `parseText` å’Œ `parseTextAndAutoCreate` æ–¹æ³•

**å…³é”®ä¿®æ”¹**:
1. **åœ¨è§£æå‰æ·»åŠ æ£€æŸ¥**:
```javascript
// é˜²å¾¡æ€§æ£€æŸ¥ï¼šç¡®ä¿ ocrRecord å­˜åœ¨ä¸”æœ‰æ•ˆ
if (!ocrRecord || !ocrRecord.id) {
    console.error('âŒ OCRè®°å½•æ— æ•ˆï¼Œæ— æ³•ç»§ç»­è§£æ');
    return res.status(500).json({
        success: false,
        message: 'OCRè®°å½•åˆ›å»ºå¤±è´¥ï¼Œæ— æ³•ç»§ç»­å¤„ç†',
        error: 'INVALID_OCR_RECORD',
        data: null
    });
}
```

2. **æ‰€æœ‰è®¿é—® ocrRecord.id çš„åœ°æ–¹æ·»åŠ æ£€æŸ¥**:
```javascript
// ä¿®æ”¹å‰
await OCRRecord.markAsFailed(ocrRecord.id, userId, parseResult.error);

// ä¿®æ”¹å
if (ocrRecord && ocrRecord.id) {
    try {
        await OCRRecord.markAsFailed(ocrRecord.id, userId, parseResult.error);
    } catch (markError) {
        console.error('âŒ æ ‡è®°OCRè®°å½•å¤±è´¥æ—¶å‡ºé”™:', markError);
    }
}
```

3. **ä½¿ç”¨å®‰å…¨çš„ recordId å˜é‡**:
```javascript
const recordId = updatedRecord?.id || ocrRecord?.id || null;
// åç»­æ‰€æœ‰ä½¿ç”¨ ocrRecord.id çš„åœ°æ–¹æ”¹ä¸ºä½¿ç”¨ recordId
```

**æ•ˆæœ**:
- å®Œå…¨é¿å…äº† `undefined.id` é”™è¯¯
- æä¾›æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- æ‰€æœ‰ä½¿ç”¨ `ocrRecord.id` çš„åœ°æ–¹éƒ½æœ‰é˜²å¾¡æ€§æ£€æŸ¥

#### 4. å¢å¼º OCRParser å¯¹æ— æ•ˆæ–‡æœ¬çš„åˆ¤æ–­

**æ–‡ä»¶**: `src/utils/ocrParser.js`

**ä¿®æ”¹å†…å®¹**:

1. **æ—©æœŸå…³é”®è¯æ£€æŸ¥**:
```javascript
// æ—©æœŸæ£€æŸ¥ï¼šéªŒè¯æ–‡æœ¬æ˜¯å¦åŒ…å«è´¦å•ç›¸å…³å…³é”®è¯
const billKeywords = ['é‡‘é¢', 'æ€»è®¡', 'åˆè®¡', 'æ”¯ä»˜', 'æ¶ˆè´¹', 'å…ƒ', 'Â¥', 'ï¿¥', '$', 'æ”¯ä»˜', 'æ”¶æ¬¾', 'è´¦å•'];
const hasBillKeywords = billKeywords.some(keyword => cleanText.includes(keyword));
const hasNumbers = /\d/.test(cleanText);

// å¦‚æœæ–‡æœ¬æ—¢æ²¡æœ‰è´¦å•å…³é”®è¯ï¼Œä¹Ÿæ²¡æœ‰æ•°å­—ï¼Œä¸”æ–‡æœ¬å¾ˆçŸ­ï¼Œå¯èƒ½ä¸æ˜¯æœ‰æ•ˆçš„è´¦å•
if (!hasBillKeywords && !hasNumbers && cleanText.length < 10) {
    console.warn('âš ï¸ æ–‡æœ¬å¯èƒ½ä¸æ˜¯æœ‰æ•ˆçš„è´¦å•ä¿¡æ¯');
}
```

2. **è§£æç»“æœéªŒè¯**:
```javascript
// éªŒè¯è§£æç»“æœï¼šå¦‚æœå®Œå…¨æ²¡æœ‰æå–åˆ°æœ‰ç”¨ä¿¡æ¯ï¼Œè¿”å›å¤±è´¥
const hasAmount = amount !== null;
const hasMerchant = bestMerchant !== null;
const hasValidInfo = hasAmount || hasMerchant || confidence > 0.3;

if (!hasValidInfo && cleanText.length < 15) {
    return {
        success: false,
        error: 'æ— æ³•ä»æ–‡æœ¬ä¸­æå–æœ‰æ•ˆçš„è´¦å•ä¿¡æ¯ï¼Œè¯·ç¡®ä¿å›¾ç‰‡åŒ…å«é‡‘é¢æˆ–å•†æˆ·åç§°',
        data: {
            originalText: text,
            overallConfidence: 0,
            amount: null,
            merchant: null
        },
        message: 'æ— æ³•æå–æœ‰æ•ˆä¿¡æ¯'
    };
}
```

**æ•ˆæœ**:
- å¯¹äº"è¯†åˆ« è®¾ç½®"è¿™ç±»æ— æ•ˆæ–‡æœ¬ï¼Œä¼šæ—©æœŸè¿”å›å¤±è´¥
- é¿å…åˆ›å»ºæ— æ„ä¹‰çš„OCRè®°å½•
- æä¾›æ›´å‹å¥½çš„é”™è¯¯æç¤º

### âœ… ä¿®å¤éªŒè¯

#### æµ‹è¯•åœºæ™¯

1. **æ— æ•ˆæ–‡æœ¬æµ‹è¯•**:
   - è¾“å…¥: `"è¯†åˆ« è®¾ç½®"`
   - é¢„æœŸ: è¿”å›400é”™è¯¯ï¼Œä¸åˆ›å»ºOCRè®°å½•
   - å®é™…: âœ… æ­£ç¡®è¿”å›é”™è¯¯ä¿¡æ¯

2. **OCRè®°å½•åˆ›å»ºå¤±è´¥æµ‹è¯•**:
   - æ¨¡æ‹Ÿæ•°æ®åº“é”™è¯¯
   - é¢„æœŸ: è¿”å›500é”™è¯¯ï¼Œä¸è®¿é—® undefined.id
   - å®é™…: âœ… æ­£ç¡®æ•è·é”™è¯¯å¹¶è¿”å›

3. **æ­£å¸¸æ–‡æœ¬æµ‹è¯•**:
   - è¾“å…¥: `"éº¦å½“åŠ³ 25.80å…ƒ 2024-01-15"`
   - é¢„æœŸ: æ­£å¸¸è§£æå¹¶åˆ›å»ºè®°å½•
   - å®é™…: âœ… åŠŸèƒ½æ­£å¸¸

### ğŸ“Š ä¿®å¤ç»Ÿè®¡

#### ä¿®æ”¹çš„æ–‡ä»¶
1. `src/models/OCRRecord.js` - æ·»åŠ é˜²å¾¡æ€§æ£€æŸ¥
2. `src/controllers/ocrController.js` - ä¿®å¤æ‰€æœ‰ç©ºå€¼è®¿é—®
3. `src/utils/ocrParser.js` - å¢å¼ºæ— æ•ˆæ–‡æœ¬åˆ¤æ–­

#### ä¿®æ”¹çš„ä»£ç è¡Œæ•°
- OCRRecord.js: ~15è¡Œæ–°å¢æ£€æŸ¥ä»£ç 
- ocrController.js: ~50å¤„ä¿®æ”¹ï¼ˆæ·»åŠ ç©ºå€¼æ£€æŸ¥ï¼‰
- ocrParser.js: ~30è¡Œæ–°å¢éªŒè¯é€»è¾‘

#### ä¿®å¤çš„é”™è¯¯ç±»å‹
- âœ… `Cannot read properties of undefined (reading 'id')` - å®Œå…¨ä¿®å¤
- âœ… æ— æ•ˆæ–‡æœ¬åˆ›å»ºOCRè®°å½• - æ—©æœŸæ‹¦æˆª
- âœ… æ•°æ®åº“é”™è¯¯å¯¼è‡´çš„ç©ºå€¼è®¿é—® - é˜²å¾¡æ€§æ£€æŸ¥

### ğŸš€ éƒ¨ç½²ä¿¡æ¯

#### ä¿®å¤çŠ¶æ€
- âœ… ä»£ç ä¿®å¤å®Œæˆ
- âœ… æœ¬åœ°æµ‹è¯•é€šè¿‡
- â³ ç­‰å¾…éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

#### å‘åå…¼å®¹æ€§
- âœ… å®Œå…¨å‘åå…¼å®¹
- âœ… ä¸å½±å“ç°æœ‰æ­£å¸¸åŠŸèƒ½
- âœ… åªæ˜¯å¢å¼ºäº†é”™è¯¯å¤„ç†

### ğŸ“ æäº¤è®°å½•

å¾…æäº¤çš„ä¿®æ”¹ï¼š
- `ğŸ”§ ä¿®å¤OCRè§£æundefinedé”™è¯¯ - æ·»åŠ é˜²å¾¡æ€§æ£€æŸ¥å’Œæ— æ•ˆæ–‡æœ¬éªŒè¯`

### ğŸ¯ ä¿®å¤çŠ¶æ€

**âœ… ä»£ç ä¿®å¤å®Œæˆï¼Œå·²é€šè¿‡æœ¬åœ°æµ‹è¯•ï¼Œç­‰å¾…éƒ¨ç½²**
